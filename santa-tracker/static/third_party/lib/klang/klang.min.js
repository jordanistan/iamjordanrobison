!function(t){"use strict";function e(t){t(i)}var i;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,function(t){i=t()}(function(){var t={};return t.version=t.versionNumber=3,t.context=null,t.engineVersion="N/A",t.progressCallback=null,t.readyCallback=null,t.browser=null,t.os=null,t.isMobile=null,t.isIOS=null,t.fallback=null,t.loggingEnabled=!1,t.useMonoBuffers=!1,t.Panner=null,t.safari=!1,t.Model={},t}),e(function(){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext}),e(function(t){return t.Model.Data=function(t,e){this.data=t.data,this._name=e}}),e(function(t){return t.core={}}),e(function(t){!function(t){function e(){var t=window.document.createElement("audio");if(!t.canPlayType)return!1;var e=[];return t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")&&e.push(".ogg"),t.canPlayType("audio/aac").replace(/no/,"")&&e.push(".m4a"),t.canPlayType("audio/mpeg;").replace(/no/,"")&&e.push(".mp3"),e}function i(t){n=n||e();for(var i=0;i<n.length;i++)if(n[i]===t)return!0;return!1}var n;t.canPlayAudioSuffix=i,t.browser=function(){var t,e=navigator.userAgent,i=e.match(/(edge(?=\/))\/?\s*(\d+)/i)||[];return 0==i.length&&(i=e.match(/(edge|opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[]),/trident/i.test(i[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],{name:"IE",version:t[1]||"unknown"}):"Chrome"===i[1]&&null!==(t=e.match(/\bOPR\/(\d+)/))?{name:"Opera",version:t[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(t=e.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),{name:i[0],version:parseInt(i[1])})}()}(t.detector||(t.detector={}));var e=t.detector;return t.core.detector=e}),e(function(t){!function(e){function i(t){var e=document.createElement("a");e.href=t;var i=document.createElement("a");return i.href=location.href,""!=e.hostname&&(e.port!=i.port||e.protocol!=i.protocol||e.hostname!=i.hostname)}function n(e,i,n,s){var o;if(e.type=e.type||"GET","MSIE"==t.detector.browser.name&&t.detector.browser.version<10)o=new window.XDomainRequest,o.onload=function(){setTimeout(function(){i&&i(o.responseText)},10)},o.onprogress=n||function(){},o.onerror=s||function(){},o.open(e.type,e.url,!0);else{if(!window.XMLHttpRequest)throw"Error - browser does not support XDomain/XMLHttp Requests";o=new XMLHttpRequest,o.open(e.type,e.url,!0),o.onreadystatechange=function(){try{if(4==o.readyState&&200==o.status){if(i){var t=o.responseText;i(t)}}else 0!=o.status&&200!=o.status&&s&&s({status:o.status})}catch(t){throw t}}}o&&o.send(null)}e.isCrossDomain=i,e.request=n}(t.network||(t.network={}));var e=t.network;return t.core.network=e}),e(function(t){function e(){this.memUsage=0,this._decoding=!1,this._files={},this._bufferQue=[],this._groups={},this._lastSentPercent=-1,this.deferDecoding=!1,this.stremingFileIds=[]}return e.inst=null,Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.prototype.sendProgressCallback=function(t){var e=this._groups[t];if(e.progressCallback&&!e.loadInterrupted){var i=0;e.progress.readyAudioFiles>=e.progress.totalAudioFiles&&(i=Math.floor((e.progress.loadedBytes+e.progress.bufferedFiles)/(e.progress.totalBytes+e.progress.totalFiles)*(100-(e.progress.totalFiles-e.progress.convertedFiles)))),this._lastSentPercent!==i&&e.progressCallback(i),this._lastSentPercent=i}},e.prototype.updateProgress=function(t,e){var i=t.load_group;if(!t.sizeReceived){t.sizeReceived=!0;var n=1;e.lengthComputable&&(n=e.total,t.loadedBytes=0),t.totalBytes=n,this._groups[i].progress.totalBytes+=n,this._groups[i].progress.readyAudioFiles++}if(void 0!==t.loadedBytes){var s=e.loaded-t.loadedBytes;t.loadedBytes=e.loaded,this._groups[i].progress.loadedBytes+=s,this.sendProgressCallback(i)}},e.prototype.decodeBufferQue=function(){var e=this;if(this._bufferQue.length){var i=this._bufferQue.pop(),n=i.data,s=i.info,o=i.callback;this._decoding=!0,t.context.decodeAudioData(n,function(n){var r=e._groups[s.load_group];if(e._decoding=!1,t.useMonoBuffers){var a=n.length,u=t.context.createBuffer(1,a,t.context.sampleRate),c=n.getChannelData(0),h=u.getChannelData(0);if("function"==typeof h.set)h.set(c);else{for(var l=0;l<a;l++)h[l]=c[l];n=u}}t.downSample&&t.downSample!==t.context.sampleRate&&(n=t.Util.downSample(n,t.downSample)),e.memUsage+=n.length*n.numberOfChannels*Float32Array.BYTES_PER_ELEMENT;e.memUsage;e.addFile(s,n),r.progress.convertedFiles++,i.data=null,e._bufferQue.length?e.decodeBufferQue():o&&o()},function(e){t.log("Klang warning: unable to load file '"+(this._baseURL||"")+s.url+"'")})}},e.prototype.decode=e.prototype.decodeBufferQue,e.prototype.loadAudioBuffer=function(e,i){var n=this,s=new XMLHttpRequest,o=".mp3";"Firefox"!==t.detector.browser.name&&"Chrome"!==t.detector.browser.name||(o=".ogg");var r=(e.external?"":this._baseURL)+e.url+o;s.open("GET",r,!0),s.responseType="arraybuffer",s.sizeReceived=!1,s.load_group=e.load_group,s.onprogress=function(t){n.updateProgress(s,t)},s.onload=function(t){var o=n._groups[e.load_group],r={data:s.response,load_group:o,info:e,callback:i};if(n._bufferQue.push(r),s.loadedBytes){var a=s.totalBytes-s.loadedBytes;o.progress.loadedBytes+=a}else o.progress.loadedBytes+=1;n.updateProgress(s,t),n.deferDecoding?(r.callback&&r.callback(),++r.load_group.progress.bufferedFiles===r.load_group.progress.totalFiles&&r.load_group.filesLoadedCallback(!0,r.load_group._loadedFiles)):n.decodeBufferQue();try{s.response=null}catch(t){}s=null},s.onreadystatechange=function(){4==s.readyState&&200==s.status||200!=s.status&&(n._groups[e.load_group].loadInterrupted=!0,n._groups[e.load_group].loadFailedCallback&&n._groups[e.load_group].loadFailedCallback())},s.send(),this._groups[e.load_group].progress.totalAudioFiles++},e.prototype.loadMidiFile=function(t,e){var i=this;loadRemote(this._baseURL+t.url,function(t,e){i.updateProgress(t,e)},function(n){i.addFile(t,readMidiFile(n)),e&&e()})},e.prototype.loadMidiString=function(t){var e=this,i=new XMLHttpRequest;i.open("GET",this._baseURL+t.url),i.onprogress=function(t){e.updateProgress(i,t)},i.onreadystatechange=function(){4==this.readyState&&200==this.status&&e.addFile(t,readMidiString(i.response))},i.send()},e.prototype.loadFiles=function(t,e,i,n){"string"==typeof t&&(t=[t]);for(var s=t.length,o=function(){0===--s&&e&&e.apply(this,arguments)},r={},a=function(t){if(i){r[this.name]=t;var e=0,n=0;for(var s in r)r.hasOwnProperty(s)&&(e++,n+=r[s]);n/=e,i(n)}},u=function(){o()},c=0,h=t.length;c<h;c++)r[t[c]]=0,this._groups[t[c]]={},this._groups[t[c]]._loadedFiles=[],this._groups[t[c]].filesLoadedCallback=o,this._groups[t[c]].progressCallback=a.bind(this._groups[t[c]]),this._groups[t[c]].loadFailedCallback=u,this._groups[t[c]].loadInterrupted=!1,this._groups[t[c]].name=t[c],this._groups[t[c]].progress={totalBytes:0,loadedBytes:0,totalFiles:0,totalAudioFiles:0,readyAudioFiles:0,bufferedFiles:0,convertedFiles:0};this.checkStreaming();for(var c=0,h=this._fileInfo.length;c<h;c++){var l=this._fileInfo[c],p=t.indexOf(l.load_group);if(p!=-1&&!this._files[l.id]&&!l.only_audio_tag){switch(l.file_type){case"audio":if(this.stremingFileIds.indexOf(l.id)!==-1)continue;this.loadAudioBuffer(l);break;case"midi":this.loadMidiFile(l);break;case"midistring":this.loadMidiString(l)}this._groups[t[p]].progress.totalFiles++}}for(var c=0,h=t.length;c<h;c++)0==this._groups[t[c]].progress.totalFiles&&this._groups[t[c]].filesLoadedCallback&&!this._groups[t[c]]._loadInterrupted&&this._groups[t[c]].filesLoadedCallback(!0,this._groups[t[c]]._loadedFiles)},e.prototype.checkStreaming=function(){var e=t.core.Core.instance._objectTable;for(var i in e){var n=e[i];if(n instanceof t.Model.StreamingAudioSource){var s=n._fileId;this.stremingFileIds.push(s)}}},e.prototype.prepareFile=function(t){this._fileInfo.push(t)},e.prototype.prepareFiles=function(t){var e,i;for(e=0,i=t.length;e<i;e++)this.prepareFile(t[e])},e.prototype.addFile=function(t,e){this._files[t.id]=e,this._groups[t.load_group].progress.bufferedFiles++,this._groups[t.load_group]._loadedFiles=this._groups[t.load_group]._loadedFiles||[],this._groups[t.load_group]._loadedFiles.push(t),this.sendProgressCallback(t.load_group),this._groups[t.load_group].progress.bufferedFiles!=this._groups[t.load_group].progress.totalFiles||this._groups[t.load_group].loadInterrupted||this._groups[t.load_group].filesLoadedCallback&&this._groups[t.load_group].filesLoadedCallback(!0,this._groups[t.load_group]._loadedFiles||[])},e.prototype.freeSoundFiles=function(t){"string"==typeof t&&(t=[t]);for(var e=0,i=this._fileInfo.length;e<i;e++){var n=this._fileInfo[e];t.indexOf(n.load_group)!=-1&&(this._files[n.id]=null)}},e.prototype.freeSoundFile=function(t){this._files[t]&&(this._files[t]=null)},e.prototype.getLoadGroups=function(){var t,e=this._fileInfo||[],i={},n=[];for(t=0;t<e.length;t++){var s=e[t];i[s.load_group]=s.load_group}for(t in i)n.push(t);return n},e.prototype.getFile=function(t){return this._files[t]||null},e.prototype.getFilesForLoadgroup=function(t){for(var e=[],i=0,n=this._fileInfo.length;i<n;i++)this._fileInfo[i].load_group==t&&e.push(this._fileInfo[i]);return e},e.prototype.getFileInfo=function(t){for(var e=0,i=this._fileInfo.length;e<i;e++)if(this._fileInfo[e].id==t)return this._fileInfo[e]},e.prototype.preloadFiles=function(t){},Object.defineProperty(e.prototype,"progress",{get:function(){return this._groups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseURL",{set:function(t){this._baseURL=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileInfo",{set:function(t){this._fileInfo=t},enumerable:!0,configurable:!0}),t.core.FileHandler=e}),e(function(t){function e(){this._updateTime=100,this._lookAHead=2*this._updateTime,this._callbacks=[]}return e.prototype.scheduleClose=function(e){var i=e.targetTime-t.context.currentTime;setTimeout(function(){e.func.apply(e.ctx)},1e3*i)},e.prototype.runScheduler=function(){if(this._callbacks.length>0){for(var e=t.context.currentTime,i=0;i<this._callbacks.length;i++){var n=this._callbacks[i];e+this._lookAHead>=n.targetTime&&(this.scheduleClose(n),this._callbacks.splice(i,1),i--)}this._lastTime=e;var s=this;this._scheduler=setTimeout(function(){s.runScheduler()},s._updateTime)}else this.stop()},e.prototype.start=function(){this._started=!0,this._lastTime=t.context.currentTime,clearTimeout(this._scheduler),this.runScheduler()},e.prototype.stop=function(){this._started=!1,clearTimeout(this._scheduler),this._scheduler=null},e.prototype.delay=function(e,i,n){return this.at(t.context.currentTime+e,i,n)},e.prototype.at=function(e,i,n){return e<t.context.currentTime?this:(this._callbacks.push({ctx:n||this,func:i,targetTime:e}),this._started||this.start(),this)},e.prototype.cancel=function(t){for(var e=0;e<this._callbacks.length;e++)if(this._callbacks[e].func&&this._callbacks[e].func===t){this._callbacks.splice(e,1);break}return this},t.core.Scheduler=e}),e(function(t){function e(){this._callbacks=[]}return e.inst=null,Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.prototype.startScheduler=function(){if(this._callbacks.length>0){for(var e=t.context.currentTime,i=e-this._lastTime,n=0;n<this._callbacks.length;n++){var s=this._callbacks[n];s.timePassed+=i,s.timePassed>=s.targetTime&&(s.obj[s.func](),this._callbacks.splice(n,1),n--)}this._lastTime=e;var o=this;this._scheduler=setTimeout(function(){o.startScheduler()},t.core.Core.settings.timehandler_lookahead)}else this.stop()},e.prototype.start=function(){this._started=!0,this._lastTime=t.context.currentTime,clearTimeout(this._scheduler),this.startScheduler()},e.prototype.stop=function(){this._started=!1,clearTimeout(this._scheduler),this._scheduler=null},e.prototype.registerMethodCallback=function(t,e,i){return this._callbacks.push({obj:t,func:e,timePassed:0,targetTime:i}),this._started||this.start(),this},e.prototype.removeMethodCallback=function(t,e){for(var i=0,n=this._callbacks.length;i<n;i++){var s=this._callbacks[i];if(s.obj==t&&s.func==e)return void this._callbacks.splice(i,1)}return this},t.core.TimeHandler=e}),e(function(t){var e;return function(e){function i(e,i,n){e.setValueAtTime(i,n||t.context.currentTime)}function n(e,i,n){e.setValueAtTime(e.value+i,n||t.context.currentTime)}function s(e,i,n,s,o){s=s||t.context.currentTime;var r=e.value;void 0!==o&&"Firefox"==t.detector.browser.name&&(r=o),e.setValueAtTime(r,s),e.linearRampToValueAtTime(i,t.context.currentTime+n)}function o(i,n,s,o,r){o=o||t.context.currentTime;var a=i.value;void 0!==r&&"Firefox"==t.detector.browser.name&&(a=r),i.setValueAtTime(0==a?e.EXP_MIN_VALUE:a,o),i.exponentialRampToValueAtTime(n,t.context.currentTime+s)}function r(i,n,s,o){o=o||t.context.currentTime,i.setValueCurveAtTime(e.CUSTOM_CURVES[n],o,s)}function a(i){for(var n in i){var s=i[n];if(s instanceof Array)for(var o=new Float32Array(s.length),r=0,a=s.length;r<a;r++)o[r]=s[r];else{s.curve_type||t.warn("Modulation: Curve type not specified"),s.resolution||(s.resolution=1024),s.amplitude||(s.amplitude=1),s.amplitude_offset||(s.amplitude_offset=0),s.phase_offset||(s.phase_offset=0),s.length||(s.length=1);var o=new Float32Array(s.resolution);if("sine"==s.curve_type)for(var u=s.phase_offset*Math.PI*2,c=s.length*Math.PI*2,r=0,a=o.length;r<a;r++)o[r]=s.amplitude_offset+Math.sin(u+r/a*c)*s.amplitude;else if("saw"==s.curve_type)for(var r=0,a=o.length;r<a;r++)o[r]=s.amplitude_offset+(a-r)/a*s.amplitude;else if("inverse-saw"==s.curve_type)for(var r=0,a=o.length;r<a;r++)o[r]=s.amplitude_offset+r/a*s.amplitude;else t.warn("Modulation: Unrecognized curve type");e.CUSTOM_CURVES[n]=o}}}function u(t,e){return Math.floor(e+(1+t-e)*Math.random())}function c(t,e){return e+(t-e)*Math.random()}function h(t,e,i){var n=document.createElement("script");n.async=!0,n.onload=function(){e&&e(),n.onload=null},n.onerror=function(t){i&&i(t),n.onerror=null},n.src=t,document.getElementsByTagName("head")[0].appendChild(n)}function l(t,e,i){return void 0===i&&(i=3),t-(t-e)/i}function p(){return"webaudio"==t.engineVersion?t.context.currentTime:0}function _(e,i){for(var n=i/t.context.sampleRate,s=Math.floor(1/n),o=Math.floor(e.length*n),r=Math.floor(t.context.sampleRate*n),a=t.context.createBuffer(e.numberOfChannels,o,r),u=0;u<e.numberOfChannels;u++)for(var c=e.getChannelData(u),h=a.getChannelData(u),l=0,p=0;p<c.length;p+=s){for(var _=0,l=0;l<s;l++)_+=c[p+l];h[p/s]=_/s}return a}function d(t){var e=Math.pow(2,1/12);return Math.pow(e,t)}function f(t){return 440*Math.pow(2,(t-69)/12)}function g(t){return 69+12*Math.log(t/440)/Math.log(2)}function y(t){return void 0===t?"lowpass":t}function m(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function v(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function b(e){t.core.Core.instance.blurFadeOut=e}function T(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function S(i,n,s,o,r,a,u,c,h){var l=0,s=s||120,r=r||2,p=[];if(!n)return e.now();if(i&&!Array.isArray(i)&&(i=[i]),i){var _;for(l=0;l<i.length;l++)(i[l].playing||i[l].scheduledToPlay())&&(_=_&&_.scheduledToPlay()&&i[l].playing?i[l]:_||i[l],i[l]._stopping||i[l]===n||p.push(i[l]));i=_}if(i===n&&!i._stopping)return e.now();if(!i)return n.play(e.now(),0,!1),e.now();var d=60/s,f=s/60,g=i?i.position:0;g=g||0;var y=g*f,o=o||4,m=o-y%o;for(m<.5&&(m+=o);c&&m<r*f;)m+=o;var v=m*d;i.playing||(v=0);var b=e.now()+v,T=0;u&&(T=i.position+v),h&&(T=h),a?n.fadeInAndPlay(a,b,T):n.play(b,T,!1);var S=c?b-r:b;for(c&&S<t.context.currentTime&&(r=b-t.context.currentTime),l=0;l<p.length;l++)p[l].fadeOutAndStop(r,S);return b}function P(t,e,i,n){var e=e||120,t=t,n=n||0;if(Array.isArray(t)){for(var s,o=0;o<t.length;o++)if(t[o].playing){s=t[o];break}t=s}if(t){var r=60/e,a=e/60,u=t.position;u=u||0,t._loopStart>0&&(u<t._loopStart?u=0:u-=t._loopStart);var c=u*a,i=i||4,h=i-c%i;h+=n;var l=h*r;return t.playing||(l=0),l}}function O(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];for(var n=[{beat:0,fadeOut:2}],s=e.length-1;s>=0;s--){"Pattern"==t.core.Core.instance.findInstance(e[s]).type&&n.push(e[s])}var o=t.core.Core.instance._objectTable;for(var r in t.core.Core.instance._objectTable){var a=o[r];"AudioSource"==a._type&&e.indexOf(r)==-1?a.loop&&a.playing&&a.fadeOutAndStop(1):"Sequencer"==a._type?a.stopAll.apply(a,n):"AdvancedProcess"==a._type&&a.started&&e.indexOf(r)==-1&&a.stop()}}function A(t){for(var e,i,n=t.length;n--;)i=Math.random()*n|0,e=t[n],t[n]=t[i],t[i]=e;return t}function C(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)e[i]=C(t[i]);return e}function w(t){if(0==t)return 0;var e=20;0==e&&(e=.01);var i=t,n=e,s=Math.log(n),o=Math.log(2e4),r=(o-s)/(2e4-n);return Math.exp(s+r*(i-n))}function x(t){for(var e="";e.length<t;)e+="0";return(e+(Math.random()*Math.pow(36,t)<<0).toString(36)).slice(-t)}if(e.setParam=i,e.adjustParam=n,e.curveParamLin=s,e.curveParamExp=o,e.curveParam=r,e.CUSTOM_CURVES={},e.createCurves=a,navigator.userAgent.indexOf("MSIE")!=-1){var E,M=navigator.userAgent,k=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=k.exec(M)&&(E=parseInt(RegExp.$1)),E<9&&(Object.defineProperty=Object.oldDefineProperty,delete Object.oldDefineProperty)}e.ROOT12=1.059463094359295,e.NYQUIST_FREQUENCY=22050,e.PITCH_SHIFT_FFT=2048,e.EXP_MIN_VALUE=1e-4,e.OSC_START_DELAY=.005,e.LOG_TIME_COLOR="#999999",e.LOG_EVENT_COLOR="#54CBDD",e.LOG_UNIMPLEMENTED_EVENT_COLOR="#E075A9",e.LOG_LOAD_COLOR="#333333",e.LOG_WARN_COLOR="DarkOrange",e.LOG_ERROR_COLOR="Red",e.lastEvent=void 0,e.clamp=function(t,e,i){return Math.max(e,Math.min(i,t))},e.clamp01=function(t){return e.clamp(t,0,1)},e.vars={},e.random=u,e.randomFloat=c,e.loadScriptFile=h,e.ease=l,e.now=p,e.downSample=_,e.semitonesToPlaybackRate=d,e.midiNoteToFrequency=f,e.frequencyToMidiNote=g,e.safeFilterType=y,e.checkMobile=m,e.checkIOS=v,e.setBlurFadeOut=b,e.getParameterByName=T,e.transition=S,e.getTimeToBeat=P,e.stopPlayingExcept=O,e.shuffle=A,e.cloneObject=C,e.logFreq=w,e.generateIdString=x,e.MidiHandler={midiAccess:null,midiIn:null,midiOut:null,inputs:[],outputs:[],init:function(t){this.MIDIUtils.initUtils();var e=this;window.navigator.requestMIDIAccess().then(function(i){e.onMIDIStarted(i),t&&t()},this.onMIDISystemError)},onMIDISystemError:function(t){console.log("Error encountered:",t)},onMIDIStarted:function(t){if(e.MidiHandler.midiAccess=t,t.inputs.forEach(function(t){e.MidiHandler.inputs.push(t)}),t.outputs.forEach(function(t){e.MidiHandler.outputs.push(t)}),!e.MidiHandler.inputs.length)return void console.error("No midi inputs found");e.MidiHandler.midiIn=e.MidiHandler.inputs[0],e.MidiHandler.midiIn.onmidimessage=e.MidiHandler.midiMessageReceived,e.MidiHandler.midiOut=e.MidiHandler.outputs[0]},midiMessageReceived:function(t){var i=t.data[0],n=t.data[0]>>4,s=15&t.data[0],o=t.data[1],r=t.data[2];e.MidiHandler.handleMidiData(i,n,s,o,r)},handleMidiData:function(t,e,i,n,s){},changeMidi:function(t){this.midiOut=this.outputs[t],this.midiIn=this.inputs[t]},MIDIUtils:{noteMap:{},noteNumberMap:[],notes:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],initUtils:function(t){for(var e=0;e<127;e++){var i=e,n=this.notes[i%12],s=(i/12|0)-1;1===n.length&&(n+="-"),n+=s,this.noteMap[n]=e,this.noteNumberMap[e]=n}},getBaseLog:function(t,e){return Math.log(t)/Math.log(e)},noteNameToNoteNumber:function(t){return this.noteMap[t]},noteNumberToFrequency:function(t){return 440*Math.pow(2,(t-69)/12)},noteNumberToName:function(t){return this.noteNumberMap[t]},frequencyToNoteNumber:function(t){return Math.round(12*this.getBaseLog(t/440,2)+69)}},play:function(t,e,i){void 0===i&&(i=100),this.midiOut.send([144,t,i]),console.log("On"),this.midiOut.send([128,t,0],window.performance.now()+e)},panic:function(){for(var t=1;t<128;++t)this.midiOut.send([128,t,0])}}}(e||(e={})),e.__extends=function(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i},t.Util=e}),e(function(t){function e(){}return e.prototype.on=function(t,e,i){return this._events=this._events||{},(this._events[t]||(this._events[t]=[])).push({callback:e,ctxArg:i,context:i||this}),this},e.prototype.off=function(t,e,i){var n,s,o,r;if(!this._events||!this._events[t])return this;t||e||i||(this._events={});var a=this._events[t];if(a){if(r=[],e&&i)for(n=0,s=a.length;n<s;n++)o=a[n],e!==o.callback&&i!==o.ctxArg&&r.push(a[n]);else if(e)for(n=0,s=a.length;n<s;n++)o=a[n],e!==o.callback&&r.push(a[n]);else if(i)for(n=0,s=a.length;n<s;n++)o=a[n],i!==o.ctxArg&&r.push(a[n]);this._events[t]=r}return this._events[t].length||delete this._events[t],this},e.prototype.trigger=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];if(!this._events||!this._events[t])return this;var n,s,o;for(o=this._events[t],e=[].splice.call(arguments,1),n=o.length-1;n>=0;n--)s=o[n],s.callback.apply(s.context,e);return this},t.core.internalEventBus=new e,t.core.EventEmitter=e}),e(function(t){function e(){this._initComplete=!1,this._blurFadeOut=!1,this._masterBusId=null,this._preLoadInitStack=[],this._postLoadInitStack=[],this._connectStack=[],this._superMasterOutput=t.context?t.context.createGain():null,this.scheduler=new t.core.Scheduler,t.Util.getParameterByName("klang_log")&&(t.loggingEnabled=!0)}return e.debugSettings={},e.inst=null,e.isInited=function(){return null!=e.inst&&e.inst._initComplete},Object.defineProperty(e.prototype,"initComplete",{get:function(){return this._initComplete},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.prototype.setCallbacks=function(t){this._callbacks=t},Object.defineProperty(e,"callbacks",{get:function(){return e.instance._callbacks},enumerable:!0,configurable:!0}),e.deinit=function(){e.inst=null},e.prototype.stopAll=function(){window.KlangVisual&&KlangVisual.stop();for(var t in this._objectTable)if(this._objectTable[t].stop)try{this._objectTable[t].stop()}catch(t){}},e.prototype.getPlaying=function(){var e=[];for(var i in this._objectTable){var n=this._objectTable[i];n instanceof t.Model.AudioSource&&n.playing?e.push(n):n instanceof t.Model.AudioGroup&&n.playing&&n.latestPlayed&&e.push(n.latestPlayed)}return e},e.prototype.loadJSON=function(i,n,s,o){if(this._readyCallback=n,this._progressCallback=s||function(){},"object"==typeof i){t.log("Loading config (editor)");var r=this.createConfigNode(i);e.settings=r.settings,e.instance.initContent(r,null,o),window.KlangVisual&&KlangVisual.init(i)}else{if("string"!=typeof i)throw"Klang exception: unrecognized options: '"+i+"'";t.log("Loading config (client)");var a=new XMLHttpRequest;a.open("GET",i,!0);var u=this;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var t=a.responseText,n=u.parseConfigJSON(t);e.settings=n.settings,e.instance.initContent(n,null,i),window.KlangVisual&&KlangVisual.init(JSON.parse(t))}else{if(404==a.status)throw"Klang exception: config file not found: '"+i+"'";if(200!=a.status)throw"Klang exception: unable to load config file: '"+i+"'"}},a.send(null)}},e.prototype.parseConfigJSON=function(e){if("string"==typeof e)return JSON.parse(e,function(e,i){return i&&"object"==typeof i&&"string"==typeof i.type?t.Model[i.type]?new t.Model[i.type](i,e):(t.warn("Core: Type not found: "+i.type),null):i});for(var i in Object.keys(e)){var n=e[i];return t.Model[n.type]?new t.Model[n.type](n,i):(t.warn("Core: Type not found: "+n.type),null)}},e.prototype.createConfigNode=function(e){if("object"==typeof e)for(var i in e){var n=e[i];if("object"==typeof n&&"string"==typeof n.type){if(t.Model[n.type]||t.warn("Core: Type not found: "+n.type),"channel"==n.type)continue;e[i]=this.createConfigNode(n),e[i]=new t.Model[n.type](n,i)}else e[i]=this.createConfigNode(n)}return e},e.prototype.createObject=function(e,i,n){if(n||(n={}),!t.Model[i.type])return void t.warn("Core: Type not found: "+i.type);!n.excludeFromTable&&this._objectTable[e]&&t.warn("Core: Duplicate object: "+e);var s=new t.Model[i.type](i,e);if(n.excludeFromTable||(this._objectTable[e]=s),!n.noInit&&s.init&&s.init(),!n.noConnect&&s.destinationName&&s.connect)if("$OUT"==s.destinationName)s.connect(this._superMasterOutput);else{var o=this.findInstance(s.destinationName);o||t.warn("Core: Destination not found: "+s.destinationName),"Bus"!=o._type&&t.warn("Core: Destination is not a bus: "+s.destinationName),s.connect(o.input)}return s},e.prototype.updateObject=function(t,e){var i="string"==typeof t?this._objectTable[t]:t;if("SimpleProcess"==i._type&&"AdvancedProcess"==e.type){var n=newAdvancedProcess(e,t);n.init(),this._objectTable[t]=n}else if("AdvancedProcess"==i._type&&"SimpleProcess"==e.type){var s=newSimpleProcess(e,t);s.init(),this._objectTable[t]=s}else i.setData&&i.setData(e)},e.prototype.createEvent=function(e,i){this._eventTable[e]&&t.warn("Core: Duplicate event: "+e),this._eventTable[e]=i},e.prototype.visChange=function(e){this.isHidden()?this._blurFadeOut&&t.Util.curveParamLin(this._superMasterOutput.gain,0,e):t.Util.curveParamLin(this._superMasterOutput.gain,1,e)},e.prototype.initContent=function(i,n,s){var o,r=i.settings.relative_path,a=i.settings.file_path||"";r&&s.lastIndexOf("/")!=-1?(o=s.substring(0,s.lastIndexOf("/")),"/"!==o.charAt(o.length-1)&&(o+="/"),o+=a):o=a,t.log("Initializing core");t.context.currentTime;if(i.settings.blur_fade_time!=-1){this._blurFadeOut=!0;var u=i.settings.blur_fade_time||.5;u<0&&u!=-1&&t.warn("Core: Invalid blur_fade_time value. Must be -1 or >= 0.");var c=this;if(this.getHiddenProp()){document.addEventListener("visibilitychange",function(){c.visChange(u)})}}this.maxSimultaneousSounds=i.settings.max_simultaneous_sounds,t.core.FileHandler.instance.fileInfo=(void 0!==n&&null!==n?n:i.files)||[],this._eventTable=i.events||{},this._objectTable={};for(var h in i.audio)this._objectTable[h]=i.audio[h];for(var h in i.busses)this._objectTable[h]=i.busses[h];for(var h in i.sequencers)this._objectTable[h]=i.sequencers[h];for(var h in i.processes)this._objectTable[h]=i.processes[h];for(var h in i.synths)this._objectTable[h]=i.synths[h];for(var h in i.lfos)this._objectTable[h]=i.lfos[h];for(var h in i.automations)this._objectTable[h]=i.automations[h];for(var h in i.data)this._objectTable[h]=i.data[h];this.setVars(i.vars),this._masterBusId=i.masterBus,this._exportedSymbols=i.exportedSymbols||{},this._logIgnore=i.debug.log_ignore||i.log_ignore||{},t.Util.createCurves(i.curves),this._loadStartTimestamp=(new Date).getTime(),i.debug&&(t.debugData.ignoredEvents=i.debug.ignored_events||t.debugData.ignoredEvents,t.debugData.logToConsole=i.debug.log_to_console||t.debugData.logToConsole),t.log("Pre load initialization started");for(var l=0,p=this._preLoadInitStack.length;l<p;l++){var _=this._preLoadInitStack[l];_.init&&_.init()}t.log("Pre load initialization finished"),t.log("Connecting nodes"),this._superMasterOutput.connect(t.context.destination);for(var l=0,p=this._connectStack.length;l<p;l++){var _=this._connectStack[l];switch(_.destinationName){case"$OUT":_.connect(this._superMasterOutput);break;case"$PARENT":break;default:var d=this.findInstance(_.destinationName);d||t.warn("Core: Destination not found: "+_.destinationName),"Bus"!=d._type&&t.warn("Core: Destination is not a bus: "+_.destinationName),_.connect(d.input)}}t.log("Nodes connected"),this._preLoadInitStack=null,this._connectStack=null,this._timeHandler=new t.core.TimeHandler,this._initComplete=!0,t.log("Core initialized"),t.core.FileHandler.instance.baseURL=o,!t.initOptions||t.initOptions&&!t.initOptions.noAutoLoad?t.core.FileHandler.instance.loadFiles("auto",e.soundsLoaded,this._progressCallback):setTimeout(e.soundsLoaded,4)},e.prototype.isHidden=function(){var t=this.getHiddenProp();return!!t&&document[t]},e.prototype.getHiddenProp=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null},e.prototype.setVars=function(e){if(e){for(var i in e)if("string"==typeof e[i]&&e[i].indexOf("me.")>-1)e[i]=this.findInstance(e[i].split("me.")[1]);else if("object"==typeof e[i]){var n=e[i];for(var s in n)n.hasOwnProperty(s)&&"string"==typeof n[s]&&n[s].indexOf("me.")>-1&&(n[s]=this.findInstance(n[s].split("me.")[1]))}t.Util.vars=e}},e.prototype.loadSoundFiles=function(e,i,n,s){var o=(new Date).getTime();n&&(this._progressCallback=n);var r=this;t.core.FileHandler.instance.loadFiles(e,function(e,n){for(var s=0;s<n.length;s++){var a=n[s].id;for(var u in r._objectTable)if(r._objectTable.hasOwnProperty(u)){var c=r._objectTable[u];"AudioSource"===c._type&&c._fileId===a&&c.init()}}var h=(new Date).getTime(),l=h-o;t.log("Execution time for loadgroup: "+l),i&&i(!0)},this._progressCallback,s)},e.prototype.freeSoundFiles=function(e){var i=t.core.FileHandler.instance.getLoadGroups();"string"==typeof e&&(e=[e]);for(var n=0;n<e.length;n++){var s=!1;i.includes(e[n])&&(t.core.FileHandler.instance.freeSoundFiles(e[n]),s=!0,t.log("freeing loadgroup!",e[n]));for(var o in this._objectTable){var r=this._objectTable[o];if("AudioSource"==r._type){var a=t.core.FileHandler.instance.getFileInfo(r._fileId);s?a&&a.load_group==e[n]&&r.freeBuffer():r.editorName===e[n]&&(t.core.FileHandler.instance.freeSoundFile(r._fileId),r.freeBuffer(),t.log("freeing buffer!",e[n]))}}}},e.soundsLoaded=function(){t.log("Post load initialization started");for(var i=e.instance,n=0,s=i._postLoadInitStack.length;n<s;n++)i._postLoadInitStack[n].init();t.log("Post load initialization finished"),i._postLoadInitStack=null,i._readyCallback&&i._readyCallback(!0)},e.prototype.pushToPreLoadInitStack=function(t){return!!this._preLoadInitStack&&(this._preLoadInitStack.push(t),!0)},e.prototype.pushToPostLoadInitStack=function(t){return!!this._postLoadInitStack&&(this._postLoadInitStack.push(t),!0)},e.prototype.pushToConnectStack=function(t){return!!this._connectStack&&(this._connectStack.push(t),!0)},e.prototype.findInstance=function(e){var i=this._objectTable[e];return i||t.warn("Core: Unknown reference: '"+e+"'"),i},e.prototype.triggerEvent=function(e){for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];if(t.Util.lastEvent=e,!t.debugData.ignoredEvents[e]){if(!this._eventTable)return void t.logc("Klang Core: eventTable is undefined");this._eventTable[e]?t.debugData.logToConsole&&!this._logIgnore[e]&&t.logc("Klang Core: Incoming sound event: '"+e+"', "+i,t.Util.LOG_EVENT_COLOR):t.debugData.logToConsole&&!this._logIgnore[e]&&t.logc("Klang Core: Incoming sound event: '"+e+"', "+i,t.Util.LOG_UNIMPLEMENTED_EVENT_COLOR);var s=this._eventTable[e];if("string"==typeof s)this._objectTable[s]||t.warn("Core: Unknown process: '"+s+"'"),"SimpleProcess"!=this._objectTable[s]._type&&"AdvancedProcess"!=this._objectTable[s]._type&&t.warn("Core: Object is not a process: '"+s+"'"),this._objectTable[s].start(i[0]);else if(s instanceof Array)for(var o=0,r=s.length;o<r;o++)this._objectTable[s[o]]||t.warn("Core: Unknown process: '"+s[o]+"'"),"SimpleProcess"!=this._objectTable[s[o]]._type&&"AdvancedProcess"!=this._objectTable[s[o]]._type&&t.warn("Core: Object is not a process: '"+s+"'"),this._objectTable[s[o]].start(i[0])}},e.prototype.getSymbolId=function(t){return this._exportedSymbols[t]},e.prototype.resumeAudio=function(){t.context.createBufferSource().start(0),t.core.internalEventBus.trigger("INIT_IOS"),t.context.resume()},Object.defineProperty(e.prototype,"timeHandler",{get:function(){return this._timeHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._superMasterOutput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurFadeOut",{get:function(){return this._blurFadeOut},set:function(t){this._blurFadeOut=t},enumerable:!0,configurable:!0}),t.core.Core=e}),e(function(t){function e(t){m=m||{},m[t]=arguments}function i(e){
for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];if(t.core.Core.isInited)if("webaudio"===t.engineVersion){if(!t.context)return;t.core.Core.instance.triggerEvent(e,i)}else"audiotag"===t.engineVersion&&t.audioTagHandler&&t.audioTagHandler.triggerEvent(e,i)}function n(e){var i=t.core.Core.instance.findInstance(t.getEvents()[e]);return i?i.destination():null}function s(){if(m){for(var e in m)m.hasOwnProperty(e)&&t.triggerEvent.apply(t,m[e]);m=null}}function o(e,i,n,o,r){var a=(new Date).getTime();if(t.initOptions=r=r||{},t.isMobile=t.Util.checkMobile(),t.isIOS=t.Util.checkIOS(),r.useMonoBuffers&&(t.useMonoBuffers=r.useMonoBuffers),"object"==typeof e&&e.settings&&e.settings.force_logging&&(t.loggingEnabled=!0),t.klangInited)return void t.warn("Klang already initialized");t.klangInited=!0,t.readyState=t.READY_STATE_NOT_INITIATED;var u="webaudio"===r.forceMode||!r.forceMode&&void 0!==window.AudioContext;"audiotag"===r.forceMode||!r.forceMode&&window.AudioContext;if(!u){if(t.engineVersion="audiotag","string"==typeof e&&e.indexOf(".json")===-1&&e.indexOf(".js")>1){var c=window.KLANGCONFIG;t.Util.loadScriptFile(e,function(){var o=window.KLANG_CONFIG;window.KLANG_CONFIG=c,t.audioTagHandler=new t.AudioTagHandler(o,function(e){t.readyState=t.READY_STATE_LOADED,i&&i(e),s()},n,e)},function(){})}else t.audioTagHandler=new t.AudioTagHandler(e,function(e){t.readyState=t.READY_STATE_LOADED,i&&i(e);var n=(new Date).getTime(),o=n-a;t.log("Execution time: "+o),s()},n,e);return!0}if(t.context||(t.context=t.engines.webAudio.Util.createAudioContext()),t.engineVersion="webaudio",t.core.Core.isInited()&&t.warn("Klang already initialized"),"string"==typeof e&&e.indexOf(".json")===-1&&e.indexOf(".js")>1){var c=window.KLANG_CONFIG;t.Util.loadScriptFile(e,function(){var o=window.KLANG_CONFIG;window.KLANG_CONFIG=c,t.core.Core.instance.loadJSON(o,function(e){t.readyState=t.READY_STATE_LOADED,i&&i(e),s()},n,e)},function(){})}else t.core.Core.instance.loadJSON(e,function(e){t.readyState=t.READY_STATE_LOADED,i&&i(e),s();var n=(new Date).getTime(),o=n-a;t.log("Execution time: "+o)},n,e);return!0}function r(e){"webaudio"==t.engineVersion?t.core.Core.instance.resumeAudio():"audiotag"==t.engineVersion&&t.isMobile&&t.audioTagHandler.resumeAudio()}function a(){var e,i=[];if("webaudio"===t.engineVersion)e=t.core.FileHandler.instance;else{if("audiotag"!==t.engineVersion)return[];e=t.audioTagHandler}i=e.getLoadGroups();var n=i.indexOf("auto");return n!==-1&&i.splice(n,1),i}function u(){return t.Util}function c(){return t.Model}function h(e,i){return"webaudio"!==t.engineVersion?(t.err("Schedule only availible in WebAudio version"),this):("number"==typeof e&&"function"==typeof i?t.core.Core.instance.scheduler.at(e,i):t.err(".schedule requires arg0 - time in seconds and arg1 - a callback function"),this)}function l(t,e){if(!Model[t])throw new Error("No such object");return new Model[t](e)}function p(e,i){t.core.Core.debugSettings[e]=i}function _(e,i,n,s){t.logc("Klang: Loading: '"+e+"'",t.Util.LOG_LOAD_COLOR),"webaudio"==t.engineVersion?t.core.Core.instance.loadSoundFiles(e,i,n,s):"audiotag"==t.engineVersion?t.audioTagHandler.loadSoundFiles(e,i,n,s):(n&&n(1),i&&i(!1))}function d(e){t.logc("Klang: Freeing: '"+e+"'",t.Util.LOG_LOAD_COLOR),"webaudio"==t.engineVersion?t.core.Core.instance.freeSoundFiles(e):t.engineVersion}function f(){return FileHandler.instance.progress}function g(){"webaudio"==t.engineVersion?t.core.Core.isInited()&&t.core.Core.instance.stopAll():"audiotag"==t.engineVersion&&t.audioTagHandler.stopAll()}function y(e,i){if("webaudio"==t.engineVersion){if(t.core.Core.isInited()){if(0===e.indexOf(".")){var n=e.substring(1),s=[],o=t.getCoreInstance()._objectTable;for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];a._type===n&&s.push(a)}return s}var u=t.core.Core.instance.getSymbolId(e);return t.core.Core.instance.findInstance(u)}}else if("audiotag"==t.engineVersion){if(0===e.indexOf(".")){var s=[],n=e.substring(1);for(var c in t.audioTagHandler._audio){var h=t.audioTagHandler._audio[c];h.constructor.name.indexOf(n)!==-1&&s.push(h)}return s}for(var c in t.audioTagHandler._audio){var h=t.audioTagHandler._audio[c];if(h._data.editorName===e)return h}}return null}t.READY_STATE_NOT_INITIATED=0,t.READY_STATE_INITIATED=1,t.READY_STATE_LOADED=2,t.klangInited=!1,t.readyState=t.READY_STATE_NOT_INITIATED;var m;t.pushToEventQue=e,t.triggerEvent=t.trigger=i,t.getDestinationForEvent=n,t.init=o,t.resumeAudio=function(t){r()},t.initIOS=t.resumeAudio,t.getLoadGroups=a,t.getCoreInstance=function(){return t.core.Core.instance},t.getFileHandlerInstance=function(){return t.core.FileHandler.instance},t.getUtil=u,t.getModel=c,t.schedule=h,t.createObject=l,t.setDebugFlag=p,t.load=_,t.free=d,t.getLoadProgress=f,t.stopAll=g,t.$=y}),e(function(t){function e(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.log("%c["+a()+"] "+e.join(),"color:"+t.Util.LOG_TIME_COLOR):console.log.apply(console,e))}function i(e,i){t.loggingEnabled&&("Chrome"==t.browser?(i||(i="gray"),console.log("%c["+a()+"] "+e,"color:"+i)):console.log(e))}function n(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.warn("%c["+t.getTimeString()+"] "+e.join(),"color:"+t.Util.LOG_WARN_COLOR):console.warn.apply(console,e))}function s(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.warn("%c["+t.getTimeString()+"] "+e.join(),"color:"+t.Util.LOG_ERROR_COLOR):console.warn.apply(console,e))}function o(t,e){for(var i=t.toString();i.length<e;)i="0"+i;return i}function r(t){return o(t.getUTCMinutes(),2)+":"+o(t.getUTCSeconds(),2)+"."+o(t.getUTCMilliseconds(),3)}function a(e){void 0===e&&(e=t.context.currentTime);var i=Math.round(1e3*e),n=Math.floor(i/1e3%60),s=Math.floor(i/6e4%60);return o(Math.floor(i/36e5%24),2)+":"+o(s,2)+":"+o(n,2)+"."+o(i%1e3,3)}function u(){return"flash"===t.engineVersion?null:"audiotag"==t.engineVersion?t.audioTagHandler._events:t.core.Core.instance._eventTable}function c(e){t.core.Core.instance.setCallbacks(e)}function h(e){var i=0,n=setInterval(function(){for(var s=t.context.currentTime,o=e[i];o.time<s;){if(triggerEvent(o.name,o.args),++i==e.length){clearInterval(n);break}o=e[i]}},10)}function l(e,i){t.klangInited=!1,"webaudio"==t.engineVersion?t.core.Core.isInited()&&(t.core.Core.instance.stopAll(),t.core.Core.deinit()):"audiotag"==t.engineVersion&&t.audioTagHandler.stopAll(),t.engineVersion="n/a"}t.log=e,t.logc=i,t.warn=n,t.err=s,t.zeropad=o,t.getTimeStamp=r,t.getTimeString=a,t.getEvents=u,t.debugData={ignoredEvents:{},logToConsole:!0},t.visualWindow,t.setCallbacks=c,t.schedulePredefinedEvents=h,t.deinit=l}),e(function(t){function e(t,e,i){this._currentStep=0,this._targetStep=t,this._process=e,this._args=i}return e.prototype.advance=function(t){this._currentStep+=t},e.prototype.performAction=function(){"string"==typeof this._process?new Function("Core","Model","Util","args",this._process)(t.core.Core,t.Model,t.Util,this._args):this._process.start(this._args)},Object.defineProperty(e.prototype,"finished",{get:function(){return this._currentStep>=this._targetStep},enumerable:!0,configurable:!0}),t.core.SyncCountdown=e}),e(function(t){function e(){this._timers=[]}return e.prototype.addSyncCountdown=function(t){this._timers.push(t)},e.prototype.update=function(t){for(var e=0;e<this._timers.length;e++){var i=this._timers[e];i.advance(t),i.finished&&(i.performAction(),this._timers.splice(e,1),e--)}},t.core.SyncHandler=e}),e(function(){}),e(function(t){function e(e,i){this.data=e,this._name=i,this._type=e.type,this._output=t.context.createGain(),this._volume=void 0!==e.volume?e.volume:1,this._output.gain.setValueAtTime(this._volume,t.context.currentTime),e.destination_name&&(this.destinationName=e.destination_name,t.core.Core.instance.initComplete||t.core.Core.instance.pushToConnectStack(this))}return e.prototype.connect=function(e){return t.warn("Audio: Invocation of abstract method: Audio.connect in",this),this},e.prototype.disconnect=function(){return t.warn("Audio: Invocation of abstract method: Audio.disconnect in",this),this},e.prototype.play=function(e,i){return t.warn("Audio: Invocation of abstract method: Audio.play in",this),this},e.prototype.stop=function(e){return t.warn("Audio: Invocation of abstract method: Audio.stop in",this),this},e.prototype.pause=function(){return t.warn("Audio: Invocation of abstract method: Audio.pause in",this),this},e.prototype.unpause=function(){return t.warn("Audio: Invocation of abstract method: Audio.unpause in",this),this},e.prototype.curvePlaybackRate=function(e,i){return t.warn("Audio: Invocation of abstract method: Audio.curvePlaybackRate in",this),this},e.prototype.fadeInAndPlay=function(t,e){return console.warn("Audio: Invocation of abstract method: Audio.fadeInAndPlay in",this),this},e.prototype.fadeOutAndStop=function(t,e){return console.warn("Audio: Invocation of abstract method: Audio.fadeOutAndStop in",this),this},e.prototype.deschedule=function(){return console.warn("Audio: Invocation of abstract method: Audio.deschedule in",this),this},Object.defineProperty(e.prototype,"playbackRate",{set:function(e){return t.warn("Audio: Invocation of abstract property: Audio.playbackRate in",this),this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return t.warn("Audio: Invocation of abstract property: Audio.playing in",this),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return t.warn("Audio: Invocation of abstract property: Audio.duration in",this),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackState",{get:function(){return t.warn("Audio: Invocation of abstract property: Audio.playbackState in",this),0},enumerable:!0,configurable:!0}),e.prototype.setData=function(e){this._volume=void 0===e.volume?1:e.volume,this._output.gain.value=this._volume,this.destinationName!=e.destination_name&&(this.destinationName=e.destination_name,this.disconnect(),this.connect(t.core.Core.instance.findInstance(this.destinationName).input))},e.prototype.clone=function(){var e=new this.constructor(this.data,this._name);return this.data.panner&&(this.data.panner=new t.Model.Panner(this.data.panner.data)),e.connect(t.core.Core.instance.findInstance(this.destinationName).input),e},t.Model.Audio=e}),e(function(t){t.engines=t.engines||{},t.engines.webAudio={}}),e(function(t){t.audioUtils=t.engines.webAudio.audioUtils={crossfade:function(t,e,i,n,s){void 0===s&&(s="equalpower");var o,r;if("linear"==s)o=function(t){return 1-t},r=function(t){return t};else{if("equalpower"!=s)return;o=function(t){return Math.pow(1-t,.5)},r=function(t){return Math.pow(t,.5)}}i=Math.min(i,t.length),n=Math.min(n,e);for(var a=0;a<t.numberOfChannels;a++){for(var u=t.getChannelData(a),c=i-1,h=e-1,l=n-1;l>=0;l--){var p=(l+1)/(n+1);u[c]=u[c]*o(p)+u[h]*r(p),c--,h--}for(var _=i,d=e;_<t.length;)u[_++]=u[d++]}}}}),e(function(t){var e=function(e){function i(i,n){if(i.streaming&&t.Model.StreamingAudioSource)return new t.Model.StreamingAudioSource(i,n);e.call(this,i,n),this._sources=[],this._startTime=0,this._loopStartTime=0,this._scheduleAhead=.2,this._stopping=!1,this._fading=!1,this._paused=!1,this._pauseTime=-1,this._pauseStartTime=-1,this.editorName=i.editorName,this._fileId=i.file_id,this._playbackRate=i.playback_rate||1,this._endTime=0,this._loop=void 0!==i.loop&&i.loop,this._loopStart=i.loop_start,this._loopEnd=i.loop_end,this._offset=i.offset||0,this._duration=i.duration||0,this._reverse=i.reverse,this._retrig=void 0===i.retrig||i.retrig,this._volumeStartRange=i.volume_start_range,this._volumeEndRange=i.volume_end_range,this._pitchStartRange=i.pitch_start_range,this._pitchEndRange=i.pitch_end_range,this._maxSources=i.max_sources||-1,this.priority,i.panner&&(this._panner=i.panner),t.core.Core.instance.pushToPostLoadInitStack(this)||this.init()}return t.Util.__extends(i,e),i.prototype.init=function(){if(this._fileId&&("string"==typeof this._fileId?this._buffer=t.core.FileHandler.instance.getFile(this._fileId):this._fileId.sampleRate&&(this._buffer=this._fileId)),this._buffer){if(this._duration||(this._duration=this._buffer.duration),"Edge"==t.detector.browser.name&&this._loop&&(this._loopStart=(this._loopStart||0)+.07,this._loopEnd=(this._loopEnd||this.duration)+.07,this.data.xfade=this.data.xfade||.1),this._reverse){for(var e=t.context.createBuffer(this._buffer.numberOfChannels,this._buffer.length,t.context.sampleRate),i=0;i<this._buffer.numberOfChannels;i++)for(var n=this._buffer.getChannelData(i),s=e.getChannelData(i),o=n.length,r=o-1;r>=0;r--)s[o-r]=n[r];this._buffer=e}if(this.data.xfade){for(var a=t.context.createBuffer(this._buffer.numberOfChannels,this._buffer.length,t.context.sampleRate),i=0;i<this._buffer.numberOfChannels;i++)for(var n=this._buffer.getChannelData(i),u=a.getChannelData(i),o=n.length,r=o-1;r>=0;r--)u[r]=n[r];this._buffer=a;var c=t.context.sampleRate,h=this.data.xfade===!0?11025:this.data.xfade*c,l=void 0===this._loopStart?h:Math.round(this._loopStart*c),p=void 0===this._loopEnd?this._buffer.length:Math.round(this._loopEnd*c);t.engines.webAudio.audioUtils.crossfade(this._buffer,l,p,h)}}},i.prototype.setLoopRegion=function(t,e){this._loopStart=t||this._loopStart,this._loopEnd=e||this._loopEnd;for(var i=0,n=this._sources.length;i<n;i++){var s=this._sources[i];s.loopStart=this._loopStart,s.loopEnd=this._loopEnd}return this},i.prototype.connect=function(t,e){return this._destination&&!e||(this._destination=t,this._panner?(this._output.connect(this._panner.input),this._panner.output.connect(t)):this._output.connect(t)),this},i.prototype.disconnect=function(){return this._output.disconnect(),this._destination=null,this._panner&&this._panner.output.disconnect(),this},i.prototype.play=function(e,i,n,s){if(e=e||0,i=i||0,s=!!s,this.removeUnusedSources(),void 0!==this.priority&&t.getCoreInstance().maxSimultaneousSounds){if(!this.checkPriority())return void t.warn("AudioSource: Skipped",this.editorName,"due to priority. Priority:",this.priority,"Max sources:",t.getCoreInstance().maxSimultaneousSounds)}if(this._maxSources>-1&&this._sources.length>this._maxSources)return void t.warn("AudioSource: Max sources reached",this.editorName);if(n||(n=this._loop?9999999999:this._duration),!this._buffer&&(this.init(),!this._buffer))return void t.warn("AudioSource: Buffer not found!",this.editorName);if(0!==(e=e||0)&&e+.01<=t.context.currentTime)return t.warn("AudioSource: Returned, playTime < currentTime",this.editorName),this;if(0===e&&(e=t.context.currentTime),this.output.gain.cancelScheduledValues(e),void 0!==this._volumeStartRange?this.output.gain.setValueAtTime(this._volume*(Math.random()*(this._volumeEndRange-this._volumeStartRange)+this._volumeStartRange),e):this.output.gain.setValueAtTime(this._volume,e),this.paused||(this._pauseStartTime=e),s||(this._pauseTime=0),this._startTime=e,this._loopStartTime=e+this.duration,this._paused=!1,this._stopping&&!this._retrig)return this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this.output.gain.value,e),this.output.gain.linearRampToValueAtTime(this._volume,e+.25),clearTimeout(this._stoppingId),void(this._stopping=!1);if(this._fading,this._fading=!1,this._retrig||this.loop)if(this.loop&&!this._retrig){if(this._endTime==-1||e<this._endTime)return}else{if(this.loop&&this._retrig&&this.playing&&!this._stopping)return;if(this._stopping)this._stopping=!1;else if(Math.round(1e3*this._endTime)/1e3==Math.round(1e3*(e+this._buffer.duration))/1e3)return t.warn("AudioSource: Returned, Doubletrig",this._name),this}else if(e<this._endTime)return;this._endTime=this.loop?-1:e+this._buffer.duration;var o=this.createBufferSource();if(o.buffer=this._buffer,this._loop&&(o.loop=!0,o.loopStart=this._loopStart?this._loopStart:0,o.loopEnd=this._loopEnd?this._loopEnd:this._buffer.duration),this._destination||t.warn("AudioSource: no destination node"),"object"!=typeof this._destination&&t.warn("AudioSource: destination is not an object",this.editorName),o.connect(this._output),i>this._duration&&(i%=this._duration),this._startOffset=this._offset+i,void 0!==this._pitchStartRange){var r=this._playbackRate*(Math.random()*(this._pitchEndRange-this._pitchStartRange)+this._pitchStartRange);o.playbackRate.setValueAtTime(r,t.context.currentTime)}return o.startTime=e,this._loop?o.start(e,this._startOffset):o.start(e,this._startOffset,n||o.buffer.duration),t.core.Core.callbacks&&t.core.Core.callbacks.scheduleAudioSource&&t.core.Core.callbacks.scheduleAudioSource({audio:this,startTime:e}),this},i.prototype.getNumberOfSamples=function(){return this._buffer.length},i.prototype.stop=function(e){void 0===e&&(e=0),this._stopping&&(this._stopping=!1,clearTimeout(this._stoppingId));var i=this._sources.length;if(i>0)if(e=e||t.Util.now(),this._loop&&(this._loopPlaying=!1),this._endTime=e,this._retrig)this._sources[this._sources.length-1].stop(e),this._sources.splice(this._sources.length-1,1);else{for(var n=0;n<i;n++){var s=this._sources[n];s.stop(e),this._endTime=t.Util.now()}this._sources=[]}else this._loopPlaying=!1;return this._startTime=-1,this},i.prototype.deschedule=function(){for(var e=0;e<this._sources.length;e++){var i=this._sources[e];i.startTime>t.context.currentTime&&(i.stop(0),this._sources[e].disconnect(),i.disconnect(),this._sources.splice(e,1),e--)}return this},i.prototype.pause=function(){if(this._endTime>t.Util.now()){this._paused=!0;var e=t.Util.now()-this._startTime;this._pauseTime+=e,this.stop()}return this},i.prototype.unpause=function(){if(this.paused){var t=this._offset;this._offset+=this._pauseTime,this.play(0,0,null,!0),this._offset=t,this._paused=!1}return this},i.prototype.createBufferSource=function(){var e=t.context.createBufferSource();return e.playbackRate.setValueAtTime(this._playbackRate,t.context.currentTime),this._sources.push(e),e},i.prototype.fadeInAndPlay=function(e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=this._duration);var o=t.context.currentTime;if(i||(i=o),(!this.loop||this._retrig||!(this._endTime==-1||i<this._endTime)||this._stopping)&&(!(this.loop&&this._retrig&&this.playing)||this._stopping))return this.output.gain.cancelScheduledValues(i),this._stopping?(clearTimeout(this._stoppingId),this.output.gain.setValueAtTime(this.output.gain.value,i)):(this._fading=!0,this.play(i==o?0:i,n,s),this.output.gain.setValueAtTime(0,i)),this._stopping=!1,this.output.gain.linearRampToValueAtTime(this._volume,i+e),this},i.prototype.fadeOutAndStop=function(e,i){if(this.playing||this.scheduledToPlay()){if(void 0===i&&(i=t.context.currentTime),i<=this._startTime)return this.stop();this._stopping&&clearTimeout(this._stoppingId),this.output.gain.cancelScheduledValues(i),this.output.gain.setValueAtTime(this.output.gain.value||this._volume,i),this.output.gain.linearRampToValueAtTime(0,i+e);var n=this;return this._stoppingId=setTimeout(function(){n._stopping&&(n._stopping=!1,n.loop&&(n._loopPlaying=!1),n.stop(i+e))},(e+(i-t.Util.now())-n._scheduleAhead)/.001),this._stopping=!0,this}},i.prototype.checkPriority=function(){var e=t.getCoreInstance(),i=e.getPlaying(),n=!0;e.maxSimultaneousSounds;return i.length>e.maxSimultaneousSounds&&(i.sort(function(t,e){return parseFloat(t.priority)-parseFloat(e.priority)}),i.length&&(i[0].priority<this.priority?(i[0].fadeOutAndStop(.1),t.warn("AudioSource: Stopped",i[0].editorName,"due to priority. Priority:",i[0].priority,"Max sources:",t.getCoreInstance().maxSimultaneousSounds)):n=!1)),n},i.prototype.removeUnusedSources=function(){for(var e=0;e<this._sources.length;e++){var i=this._sources[e];(!i.buffer||!this.loop&&i.startTime+i.buffer.duration<t.context.currentTime)&&(this._sources[e].disconnect(),this._sources.splice(e,1),e--)}},i.prototype.curvePlaybackRate=function(e,i,n){var s=n?n:t.Util.now(),o=this.playbackRateNode;return o&&(o.cancelScheduledValues(s),o.setValueAtTime(0==o.value?t.Util.EXP_MIN_VALUE:o.value,s),o.exponentialRampToValueAtTime(e,s+i)),this._playbackRate=e,this},Object.defineProperty(i.prototype,"lastSource",{get:function(){var t=this._sources.length;return 0==t?null:this._sources[t-1]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset},set:function(t){"string"==typeof t&&t.indexOf("%")!==-1&&(t=this._duration*parseFloat(t)),this._offset=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){if(!this.playing||!this._duration)return 0;var e=this._duration;(this._loopStart||this._loopEnd)&&(e=(this._loopEnd||e)-(this._loopStart||0));var i=t.Util.now()-this._startTime,n=t.Util.now()+this._startOffset-this._loopStartTime;return this._startOffset+i>this._duration?(this._loopStart||0)+n%e:this._startOffset+i},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){var i=this.playbackRateNode;i&&i.cancelScheduledValues(t.Util.now()),this._playbackRate=e;for(var n=0,s=this._sources.length;n<s;n++)this._sources[n].playbackRate.value=this._playbackRate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextPlaybackRate",{set:function(t){this._playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackRateNode",{get:function(){var t=this.lastSource;return t&&t.playbackRate},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buffer",{get:function(){return this._buffer||(this._buffer=t.core.FileHandler.instance.getFile(this._fileId)),this._buffer},set:function(t){this._buffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){return(this._endTime==-1||this._endTime>t.Util.now())&&this._startTime<=t.Util.now()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackState",{get:function(){var t=this.lastSource;return t?t.playbackState:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"output",{get:function(){return this._panner?this._panner.output:this._output},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panner",{get:function(){return this._panner},enumerable:!0,configurable:!0}),i.prototype.scheduledToPlay=function(){return this._startTime>t.Util.now()},i.prototype.freeBuffer=function(){this._buffer=null;for(var t=0,e=this._sources.length;t<e;t++){try{this._sources[t].stop(0)}catch(t){}this._sources[t].disconnect(),this._sources[t]=null}this._sources=[]},i.prototype.setData=function(t){e.prototype.setData.call(this,t);var i=!1;this._volumeStartRange=t.volume_start_range,this._volumeEndRange=t.volume_end_range,this._pitchEndRange=t.pitch_end_range,this._pitchStartRange=t.pitch_start_range,void 0!==t.file_id&&this._fileId!=t.file_id&&(this._fileId=t.file_id,i=!0),this._playbackRate=void 0===t.playback_rate?1:t.playback_rate,this.playbackRateNode&&(this.playbackRateNode.value=this._playbackRate),this._loop=void 0!==t.loop&&t.loop,this.lastSource&&(this.lastSource.loop=this._loop),this._loop||(this._loopPlaying=!1),this._loopStart=void 0===t.loop_start?0:t.loop_start,this.lastSource&&(this.lastSource.loopStart=this._loopStart),this._loopEnd=void 0===t.loop_end?0:t.loop_end,this.lastSource&&(this.lastSource.loopEnd=this._loopEnd);var n=void 0===t.offset?0:t.offset;this._offset!=n&&(this._offset=n,i=!0);var s=void 0===t.duration?0:t.duration;if(this._duration!=s&&(this._duration=s,i=!0),this._retrig=void 0===t.retrig||t.retrig,void 0===t.reverse&&(t.reverse=!1),this._reverse!=t.reverse&&(this._reverse=t.reverse,i=!0),void 0===t.xfade&&(t.xfade=!1),this.data.xfade!=t.xfade&&(i=!0),this.data=t,i&&this.init(),t.panner)if(this._panner)this._panner.setData(t.panner);else{var o=this._destination;this.disconnect(),this._panner=newPanner(t.panner),this.connect(o)}else if(!t.panner&&this._panner){var o=this._destination;this.disconnect(),this._panner=null,this.connect(o)}},i}(t.Model.Audio);return t.Model.AudioSource=e}),e(function(t){function e(e,s){this._adder=0,this._currentId=0,this._paused=!1,this.data=e,this.editorName=e.editorName,this._name=s,this._type=e.type,this._groupType=void 0!==e.group_type?e.group_type:i.STEP,this._retrig=void 0===e.retrig||e.retrig,this._queue=void 0!==e.queue?e.queue:n.NONE,this._content=e.content||[],t.core.Core.instance.pushToPreLoadInitStack(this)}var i={CONCURRENT:0,STEP:1,RANDOM:2,SHUFFLE:3,BACKWARDS:4},n={NONE:0,ONE:1,INFINITE:2};return e.prototype.init=function(){for(var e=[],i=0,n=this._content.length;i<n;i++)e.push(t.core.Core.instance.findInstance(this._content[i]));this._content=e},e.prototype.play=function(e,s,o){if(this._content.length){var r=!!this.latestPlayed&&this.latestPlayed.playing;if(!o&&!this._retrig&&r)return this._queue!=n.NONE&&(this._queue==n.ONE&&this._latestStartTime>t.context.currentTime?(this.latestPlayed.stop(),this.play(this._latestStartTime,s,!0)):this.play(this._latestStartTime+this.latestPlayed.duration,s,!0)),this;if(this._paused=!1,void 0!==s){var a;"number"==typeof s?a=s:"string"==typeof s?a=this.getIdFromString(s):s._name&&(a=this.getIdFromString(s._name)),this._content[a].play(e),this._latestPlayed=this._content[a]}else{if(this._groupType==i.CONCURRENT)for(var u=0,c=this._content.length;u<c;u++)this._content[u].play(e);else this._currentId=this.getIdToPlay(),this._content[this._currentId].play(e);this._groupType===i.CONCURRENT?this._latestPlayed=this._content[0]:this._latestPlayed=this._content[this._currentId]}return this._latestStartTime=e||t.context.currentTime,this}},e.prototype.getIdToPlay=function(){var e;if(this._groupType==i.STEP)e=this._adder<0?this._content.length-1+this._adder%this._content.length:this._adder%this._content.length,this._adder++;else if(this._groupType==i.RANDOM){var n=Math.floor(Math.random()*(this._content.length-1));this._content.length>1&&n==this._adder&&(n=(n+1)%this._content.length),e=this._adder=n}else this._groupType==i.SHUFFLE?(this._adder%this._content.length==0&&t.Util.shuffle(this._content),e=this._adder%this._content.length,this._adder++):this._groupType==i.BACKWARDS&&(e=this._adder<0?this._content.length-1+this._adder%this._content.length:this._adder%this._content.length,this._adder--);return e},e.prototype.stop=function(t){return this._content[this._currentId].stop(t),this},e.prototype.stopAll=function(t){for(var e=0,i=this._content.length;e<i;e++)this._content[e].stop(t);return this},e.prototype.pause=function(){return this._paused=!0,this._latestPlayed&&this._latestPlayed.pause(),this},e.prototype.unpause=function(){return this._paused=!1,this._latestPlayed&&this._latestPlayed.unpause(),this},e.prototype.fadeInAndPlay=function(t,e){var i=!!this.latestPlayed&&this.latestPlayed.playing;if(this._retrig||!i)return this._currentId=this.getIdToPlay(),this._latestPlayed=this._content[this._currentId],this._content[this._currentId].fadeInAndPlay(t,e),this},e.prototype.fadeOutAndStop=function(e,i){return void 0===i&&(i=t.context.currentTime),this._latestPlayed&&this._latestPlayed.fadeOutAndStop(e,i),this},e.prototype.curvePlaybackRate=function(e,i,n){for(var s=(n||t.Util.now(),0),o=this._content.length;s<o;s++)this._content[s].curvePlaybackRate(e,i,n);return this},e.prototype.deschedule=function(){for(var t=0,e=this._content.length;t<e;t++)this._content[t].deschedule();return this},e.prototype.getIdFromString=function(t){for(var e=0,i=this._content.length;e<i;e++)if(this._content[e]._name==t)return e},Object.defineProperty(e.prototype,"playbackRate",{set:function(t){for(var e=0,i=this._content.length;e<i;e++)this._content[e].playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupType",{get:function(){return this._groupType},set:function(t){this._groupType=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t,this.init()},enumerable:!0,configurable:!0}),e.prototype.addContent=function(t){this._content.push(t)},e.prototype.removeContent=function(t){for(var e=0;e<this._content.length;e++)this._content[e]._name===t&&this._content.splice(e,1)},Object.defineProperty(e.prototype,"playing",{get:function(){return!!this._latestPlayed&&this._latestPlayed.playing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._latestPlayed?this._latestPlayed.duration:this._content[0].duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackState",{get:function(){return this._content[this._currentId].playbackState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latestPlayed",{get:function(){return this._latestPlayed},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this._groupType=void 0===t.group_type?i.STEP:t.group_type,this._retrig=void 0===t.retrig||t.retrig,this._queue=void 0===t.queue?n.NONE:t.queue,t.content&&(this._content=t.content,this.init())},t.Model.AudioGroup=e}),e(function(t){function e(t){this._startValue=t.start_value||0,this._points=t.points||[]}return e.prototype.automate=function(e,i){i=i||t.context.currentTime,e.cancelScheduledValues(i),e.setValueAtTime(this._startValue,i);for(var n=0,s=0,o=this._points.length;s<o;s++){var r=this._points[s];switch(r.curve){case"lin":e.linearRampToValueAtTime(r.value,i+r.time);break;case"exp":e.exponentialRampToValueAtTime(r.value,i+r.time);break;default:if(t.Util.CUSTOM_CURVES[r.curve]){t.warn("Automation: Invalid curve type: "+r.curve);break}e.setValueCurveAtTime(t.Util.CUSTOM_CURVES[r.curve],i+n,r.time-n)}n=r.time}},t.Model.Automation=e}),e(function(t){function e(e,i){this._name=i,this._type=e.type,this._input=t.context.createGain(),this._output=t.context.createGain(),this._effects=e.effects||[],this._data=e;for(var n=0,s=this._effects.length;n<s;n++)e.effects[n].active===!1&&this._effects[n].setActive(!1);var o=void 0!==e.input_vol?e.input_vol:1,r=void 0!==e.output_vol?e.output_vol:1;this._input.gain.setValueAtTime(o,t.context.currentTime),this._output.gain.setValueAtTime(r,t.context.currentTime),e.destination_name&&(this.destinationName=e.destination_name,t.core.Core.instance.pushToConnectStack(this)),t.core.Core.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){for(var t=this._input,e=0,i=this._effects.length;e<i;e++)t.disconnect(),t.connect(this._effects[e].input),t=this._effects[e];t.connect(this._output)},e.prototype.connect=function(t){return this._output.connect(t),this._destination=t,this},e.prototype.disconnect=function(){return this._output.disconnect(),this},e.prototype.refreshAudioNodes=function(){for(var e=0;e<this.effects.length;e++)this.effects[e].disconnect(),this.effects[e].refreshAudioNodes&&this.effects[e].refreshAudioNodes();var i=this._output.gain.value;this._output.gain.cancelScheduledValues(t.context.currentTime),this._output.disconnect(),this._output=t.context.createGain(),this._output.gain.setValueAtTime(i,t.context.currentTime),this.init(),this._destination&&this._output.connect(this._destination)},e.prototype.insertEffect=function(e,i){var n=t.core.Core.instance.createObject(void 0,e,{excludeFromTable:!0});return void 0===i?this._effects.push(n):this._effects.splice(i,0,n),this.init(),this},e.prototype.moveEffect=function(t,e){for(var i=0,n=this._effects.length;i<n;i++)this._effects[i].disconnect();var s=this._effects[t];return this._effects.splice(t,1),this._effects.splice(e,0,s),this.init(),this},
Object.defineProperty(e.prototype,"input",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this._effects},enumerable:!0,configurable:!0}),e.prototype.setData=function(e){if(this._input.gain.value=void 0===e.input_vol?1:e.input_vol,this._output.gain.value=void 0===e.output_vol?1:e.output_vol,e.effects.length<this.effects.length){this.input.disconnect();for(var i=!1,n=0;n<this._effects.length;n++)this._effects[n].disconnect(),i||(void 0===e.effects[n]?(this._effects.splice(n,1),i=!0):this._effects[n]._type!=e.effects[n].type&&(this._effects.splice(n,1),n--,i=!0));this.init()}else if(e.effects.length>this.effects.length)this.insertEffect(e.effects[e.effects.length-1]);else for(var n=0,s=this._effects.length;n<s;n++)this._effects[n].setData(e.effects[n]);this.destinationName!=e.destination_name&&(this.destinationName=e.destination_name,this.disconnect(),"$OUT"==this.destinationName?this.connect(t.core.Core.instance._superMasterOutput):this.connect(t.core.Core.instance.findInstance(this.destinationName).input))},t.Model.Bus=e}),e(function(t){t.audioUtil=t.engines.webAudio.Util={}}),e(function(t){var e={diatonic:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0],dorian:[0,1,0,0,-1,0,1,0,1,0,0,-1],phrygian:[0,0,-1,0,-1,0,1,0,0,-1,0,-1],lydian:[0,1,0,1,0,1,0,0,1,0,1,0],mixolydian:[0,1,0,1,0,0,-1,0,-1,0,0,-1],aeolian:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1],locrian:[0,0,-1,0,-1,0,0,-1,0,-1,0,-1],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],melodicMinor:[0,1,0,0,-1,0,1,0,-1,0,1,0],majorPentatonic:[0,1,0,1,0,-1,1,0,1,0,-1,1],minorPentatonic:[0,-1,1,0,-1,0,1,0,-1,1,0,-1],doubleHarmonic:[0,0,-1,1,0,0,1,0,0,-1,1,0],halfDim:[0,1,0,0,-1,0,0,-1,0,-1,0,-1],chromatic:[0,0,0,0,0,0,0,0,0,0,0,0],custom:[0,0,0,0,0,0,0,0,0,0,0,0]},i=function(t,e,i){var n=t%12-i;return n<0&&(n+=12),this.scales[e][n]},n=function(t,e,i){var n;if(e){var s=t,o=s%12-i;o<0&&(o+=12),n=this.scales[e][o]}return t+n};t.engines.webAudio.Util.getNoteInScale=n,t.engines.webAudio.Util.getTransposeFromScale=i,t.engines.webAudio.Util.scales=e}),e(function(t){function e(t){switch(t){case i.PrePlaying:return"PrePlaying";case i.Playing:return"Playing";case i.PreStopping:return"PreStopping";case i.PostStop:return"PostStop";case i.Stopped:return"Stopped"}}!function(t){t._map=[],t._map[0]="PrePlaying",t.PrePlaying=0,t._map[1]="Playing",t.Playing=1,t._map[2]="PreStopping",t.PreStopping=2,t._map[3]="PostStop",t.PostStop=3,t._map[4]="Stopped",t.Stopped=4}(t.Model.PatternState||(t.Model.PatternState={}));var i=t.Model.PatternState;t.Model.getPatternStateString=e;var n=function(e){function n(n,s){e.call(this,n,s),this._startStep=0,this._totalStep=0,this._currentStep=0,this._syncStep=0,this._stepCount=0,this._fadeTime=0,this._length=2,this._loop=!0,this._tail=!1,this._forceFade=!1,this._activeUpbeat=-1,this._startOffset=0,this._state=i.Stopped,this._beatSubscription=n.beat_subscription||.25,this._length=n.length||0,this._startStep=n.start_step||0,this._loop=void 0===n.loop||n.loop,this._tail=void 0!==n.tail&&n.tail,this._clips=[],this._upbeats=[],this._sequencerName=n.sequencer,this._initData={dummyClips:n.content,dummyUpbeats:n.upbeats},t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(n,e),n.prototype.init=function(){if(this._initData.dummyClips)for(var e=0,i=this._initData.dummyClips.length;e<i;e++){var n=this._initData.dummyClips[e];n.audio?(this._clips.push({audio:t.core.Core.instance.findInstance(n.audio),process:null,args:null,step:n.step}),this._clips[this._clips.length-1].audio._parentType=this._type):this._clips.push({audio:null,process:t.core.Core.instance.findInstance(n.process),args:n.args,step:n.step})}if(this._initData.dummyUpbeats){for(var e=0,s=this._initData.dummyUpbeats.length;e<s;e++){for(var o=this._initData.dummyUpbeats[e],r=[],a=0,u=o.content.length;a<u;a++){var c=o.content[a];c.audio?(r.push({audio:t.core.Core.instance.findInstance(c.audio),process:null,args:null,step:c.step}),this._clips[this._clips.length-1].audio._parentType=this._type):r.push({audio:null,process:t.core.Core.instance.findInstance(c.process),args:c.args,step:c.step})}o.clips=r,this._upbeats.push({length:o.length,clips:r})}this._upbeats.sort(function(t,e){return e.length-t.length})}this._sequencer=t.core.Core.instance.findInstance(this._sequencerName),this._sequencer.registerPattern(this),this._initData=null},n.prototype.connect=function(e){for(var i=0,n=this._clips.length;i<n;i++){var s=this._clips[i].audio;!s||s.destinationName&&"$OUT"!=t.core.Core.instance.findInstance(s.destinationName).destinationName||(s.disconnect(),s.connect(this._output))}return this._output.connect(e),this},n.prototype.disconnect=function(){return this._output.disconnect(),this},n.prototype.changeState=function(e){e!=this._state&&(t.core.Core.callbacks&&t.core.Core.callbacks.changePatternState&&t.core.Core.callbacks.changePatternState({pattern:this,lastState:this._state,newState:e,step:this._sequencer.currentStep}),this._state=e)},n.prototype.prePlaySchedule=function(e,n,s,o,r,a){s=s||!1;var u=t.context.currentTime;if(this._state==i.PreStopping||this._state==i.PostStop)return this._output.gain.cancelScheduledValues(u),this._output.gain.setValueAtTime(this._output.gain.value,u),this._output.gain.linearRampToValueAtTime(this._volume,u+.5),this.changeState(i.Playing),clearTimeout(this._stoppingId),this;if(this._output.gain.value!=this._volume||i.Stopped){var c;c=this._state===i.Stopped&&o?0:this._output.gain.value,this._output.gain.cancelScheduledValues(u),this._output.gain.setValueAtTime(c,u),this._output.gain.linearRampToValueAtTime(this._volume,u+r)}else if(o){var h=this._sequencer.getBeatTime(e);this._output.gain.cancelScheduledValues(h),this._output.gain.setValueAtTime(0,h),this._output.gain.linearRampToValueAtTime(this._volume,h+r)}if(this._state==i.Playing||this._state==i.PrePlaying){if(!s)return this;this._syncStep=n,this.stop(e,!0,0)}if(void 0!==a&&(this._startOffset=a),this._syncStep=n%this._length+this._startStep,e>0||s){this._stepCount=e,this._currentStep=this._startStep,this._totalStep=0,this._activeUpbeat=-1;for(var l=0,p=this._upbeats.length;l<p;l++){var _=this._upbeats[l];_.length<=e&&(this._activeUpbeat==-1||this._upbeats[this._activeUpbeat].length<_.length)&&(this._activeUpbeat=l)}this.changeState(i.PrePlaying)}else this.changeState(i.Playing);return this},n.prototype.play=function(t){return this._state==i.Playing||this._state==i.PrePlaying?this:(this._state!=i.PreStopping&&this._state!=i.PostStop||clearTimeout(this._stoppingId),this._currentStep=this._sequencer.currentStep%this._length+this._startStep,this.changeState(i.Playing),this._sequencer.started||this._sequencer.start(),this)},n.prototype.stop=function(e,n,s,o){if(this._state==i.Stopped)return this;if(this._state===i.PrePlaying)return void this.changeState(i.Stopped);if(void 0===e)return this.changeState(i.Stopped),this._currentStep=0,this;if(void 0===n&&(n=!0),n)this._stepCount=this._sequencer.getStepsToNext(this._sequencer.beatLength*e)||0,this._fadeTime=s,this.changeState(i.PreStopping),o>0&&(this._stepCount+=o);else if(s){var r=s/this._sequencer.getNoteTime(1);this._stepCount=Math.ceil(r),this.changeState(i.Stopped);for(var a=(t.context.currentTime,0);a<this._clips.length;a++)this._clips[a].audio&&this._clips[a].audio.fadeOutAndStop(s,e)}else{this.changeState(i.Stopped),this._currentStep=0;for(var a=0;a<this._clips.length;a++)this._clips[a].audio&&this._clips[a].audio.stop(e+this._sequencer.getNoteTime(this._sequencer.resolution))}return this},n.prototype.pause=function(){for(var t=0,e=this._clips.length;t<e;t++)this._clips[t].audio&&this._clips[t].audio.pause();return this},n.prototype.unpause=function(){for(var t=0,e=this._clips.length;t<e;t++)this._clips[t].audio&&this._clips[t].audio.unpause();return this},n.prototype.playStep=function(t,e){this._currentStep>=this._length+this._startStep&&(this._loop?this._currentStep=this._startStep:this._loop||this.changeState(i.Stopped));for(var n=0,s=this._clips.length;n<s;n++)if(this._clips[n].step==this._currentStep){var o=this._clips[n];o.audio?o.audio.play(e,this._startOffset):o.process.start(o.args)}this._totalStep+=this._beatSubscription,this._currentStep+=this._beatSubscription},n.prototype.update=function(t,e){if(this._state!=i.Stopped&&t%this._beatSubscription==0)switch(this._state){case i.PrePlaying:if(this._activeUpbeat!=-1)for(var n=this._upbeats[this._activeUpbeat],s=0,o=n.clips.length;s<o;s++){var r=n.clips[s];r.step==n.length-this._stepCount&&(r.audio?r.audio.play(e):r.process.start(r.args))}this._stepCount-=this._beatSubscription,this._stepCount<=0&&(this._currentStep=this._startStep+this._syncStep%this._length,this._syncStep=0,this.changeState(i.Playing));break;case i.Playing:this.playStep(t,e);break;case i.PreStopping:this._stepCount-=this._beatSubscription,this._stepCount<=0?!this._tail||this._forceFade?this.stop(e,!1,this._fadeTime):(this.changeState(i.Stopped),this._currentStep=0):this.playStep(t,e);break;case i.PostStop:this.playStep(t,e),this._stepCount-=this._beatSubscription,this._stepCount<=0&&(this._forceFade=!1,this.changeState(i.Stopped),this._currentStep=0)}return this},n.prototype.deschedule=function(e){if(void 0===e&&(e=this._length),this._state!=i.Stopped){e%=this._length;for(var n=0,s=this._clips.length;n<s;n++){var o=this._clips[n];o.audio&&o.audio.deschedule()}if(clearTimeout(this._stoppingId),this._output.gain.cancelScheduledValues(t.Util.now()),this._currentStep=this._currentStep-e,this._currentStep<this._startStep){var r=this._startStep-this._currentStep;this._currentStep=this._startStep+this._length-r}}return this},n.prototype.fadeInAndPlay=function(t,e){return this},n.prototype.fadeOutAndStop=function(e,i){return i=i||t.Util.now(),this.stop(i,!1,e),this},n.prototype.curvePlaybackRate=function(t,e){for(var i=0,n=this._clips.length;i<n;i++)this._clips[i].audio.curvePlaybackRate(t,e);return this},n.prototype.getNextBar=function(t){var e=Math.ceil(this._currentStep/t);return this._currentStep>this._length-t&&(e=0),e},Object.defineProperty(n.prototype,"forceFade",{set:function(t){this._forceFade=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playbackRate",{set:function(t){for(var e=0,i=this._clips.length;e<i;e++)this._clips[e].audio.playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playing",{get:function(){var t=!1;return 1!==this._state&&1!==this._state||(t=!0),t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._length*this._sequencer.getNoteTime(1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playbackState",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentStep",{get:function(){return this._currentStep},enumerable:!0,configurable:!0}),n.prototype.setData=function(t){e.prototype.setData.call(this,t);var i=!1;this._beatSubscription=void 0!==t.beat_subscription?t.beat_subscription:.25,this._length=void 0!==t.length?t.length:0,this._startStep=void 0!==t.start_step?t.start_step:0,this._loop=void 0===t.loop||t.loop,this._tail=void 0!==t.tail&&t.tail,void 0!==t.sequencer&&this._sequencerName!=t.sequencer&&(this._sequencerName=t.sequencer,i=!0),this._initData={dummyClips:null,dummyUpbeats:null},t.content&&(this._initData.dummyClips=t.content,this._clips=[],i=!0),t.upbeats&&(this._initData.dummyUpbeats=t.upbeats,this._upbeats=[],i=!0),i&&(this._sequencer.unregisterPattern(this),this.init())},n}(t.Model.Audio);return t.Model.Pattern=n}),e(function(t){var e=t.Model.PatternState,i=t.engines.webAudio.Util,n=function(n){function s(i,s){if(n.call(this,i,s),this._startStep=0,this._totalStep=0,this._currentStep=0,this._syncStep=0,this._stepCount=0,this._fadeTime=0,this._transpose=0,this._updatedClips=[],this._state=e.Stopped,this._beatSubscription=i.beat_subscription||.25,this._midiFileId=i.file_id,this._midiTrackIx=i.midi_track||0,this._sequencerName=i.sequencer,this._synthName=i.synth,this._loop=void 0===i.loop||i.loop,this._length=i.length||0,this._nextClip=0,this._startStep=i.start_step||0,this._root=i.root||0,this._transpose=this._orgTranspose=i.transpose||0,this._scale=this._orgScale=i.scale,this._rootNote=i.root_note||36,this._activeUpbeat=-1,this._dataClips=i.clips||void 0,i.upbeats){this._upbeats=[],this._upbeatLoopOffset=0;for(var o=0,r=i.upbeats.length;o<r;o++)this._upbeats.push({length:i.upbeats[o].length,step:i.upbeats[o].step,targetStep:i.upbeats[o].target_step,playInLoop:i.upbeats[o].play_in_loop})}t.core.Core.instance.pushToPostLoadInitStack(this)}return t.Util.__extends(s,n),s.prototype.init=function(){this._sequencer=t.core.Core.instance.findInstance(this._sequencerName),this._sequencer.registerPattern(this),"progression"===this._synthName?(this._synth="progression",this._progression=!0,this._currentChord=[]):this._synth=t.core.Core.instance.findInstance(this._synthName),this._midiFile=t.core.FileHandler.instance.getFile(this._midiFileId),this._midiFile?this.setupFile():this._dataClips?this._clips=this._dataClips:this._clips=[]},s.prototype.setupFile=function(){this._midiTrack=this._midiFile.tracks[this._midiTrackIx],void 0===this._midiTrack&&t.warn("MidiPattern: midi track out of bounds: "+this._midiTrackIx),this.recalculateBPM(this._sequencer.bpm);var e=this._midiFile.header.ticksPerBeat,i=0;this._clips=[];for(var n=0,s=this._midiTrack.length;n<s;n++){var o=this._midiTrack[n];i+=o.deltaTime;var r=i/e%this._sequencer.resolution,a=i/e-r;this._clips.push({event:o,step:a,offset:i%(e*this._sequencer.resolution)})}return this},s.prototype.connect=function(t){return this._output.connect(t),this},s.prototype.disconnect=function(){return this._output.disconnect(),this},s.prototype.changeState=function(e){e!=this._state&&(t.core.Core.callbacks&&t.core.Core.callbacks.changePatternState&&t.core.Core.callbacks.changePatternState({pattern:this,lastState:this._state,newState:e,step:this._sequencer.currentStep}),this._state=e)},s.prototype.prePlaySchedule=function(i,n,s){if(this._midiFile||(this._midiFile=t.core.FileHandler.instance.getFile(this._midiFileId),this._midiFile?this.setupFile():t.log("MidiPattern: midifile not found: "+this._name+". Playing without midifile.")),s=s||!1,this._state==e.Playing){if(!s)return this;this._syncStep=n,this.stop(i,!0)}var o=this._sequencer._scheduleTime+i*this._sequencer.getNoteTime(.25);if(this.trigger("start",o),this._syncStep=n%this._length,this._currentStep=this._startStep,this.findNextClip(this._currentStep),i>0){if(this._stepCount=i,this._currentStep+=this._syncStep,this._syncStep=0,this._totalStep=0,this.changeState(e.PrePlaying),this._upbeats){this._activeUpbeat=-1;for(var r=0,a=this._upbeats.length;r<a;r++){var u=this._upbeats[r];u.length<=i&&(this._activeUpbeat==-1||this._upbeats[this._activeUpbeat].length<u.length)&&(this._activeUpbeat=r)}this._activeUpbeat!=-1&&this._upbeats[this._activeUpbeat].playInLoop&&(this._upbeatLoopOffset=this._upbeats[this._activeUpbeat].length)}this.findNextClip(this._activeUpbeat==-1?this._currentStep:this._upbeats[this._activeUpbeat].step)}else this.changeState(e.Playing);return this._patternStartTime=t.Util.now(),this},s.prototype.play=function(i){if(this._midiFile||(this._midiFile=t.core.FileHandler.instance.getFile(this._midiFileId),this._midiFile?this.setupFile():t.log("MidiPattern: midifile not found: "+this._name+". Playing without midifile.")),this._state==e.Playing)return this;if(i&&0!=i){var n=this._output.gain.value;this._output.gain.setValueAtTime(0,0),this._output.gain.setValueAtTime(n,i)}return this._currentStep=this._sequencer.currentStep%this._length+this._startStep,this.changeState(e.Playing),this.findNextClip(this._currentStep),this._sequencer.started||this._sequencer.start(),this},s.prototype.restart=function(){return this._currentStep=this._startStep,this._nextClip=0,this},s.prototype.stop=function(t,i){return this.trigger("stop",t),this._synth.deschedule&&this._sequencer._scheduleAheadTime>.5&&this._synth.deschedule(),void 0===t||this._state==e.Stopped?(this.changeState(e.Stopped),this):(void 0===i&&(i=!0),i?(this._stepCount=this._sequencer.getStepsToNext(this._sequencer.beatLength*t),this.changeState(e.PreStopping)):(this.changeState(e.Stopped),"progression"!==this._synth&&this._synth._loopedSamples&&this._synth.stop(t)),this)},s.prototype.pause=function(){return this},s.prototype.unpause=function(){return this},s.prototype.sendMidiEvents=function(e,n,s){if(this._clips.length){for(var o=this._nextClip;this._clips[this._nextClip].step==e;){var r=this._clips[this._nextClip];if(this._progression){if("noteOn"===r.event.subtype)this._currentChord.push(r.event.noteNumber);else if("noteOff"===r.event.subtype){var a=this._currentChord.indexOf(r.event.noteNumber);a>-1&&this._currentChord.splice(a,1)}}else{var u=0;if(r.event.noteNumber&&(this._scale&&(u=i.getTransposeFromScale(r.event.noteNumber,this._scale,this._root)),0!=this._transpose&&(u+=this._transpose)),!s||"noteOn"!==r.event.subtype){var c=this._midiFile?r.offset*this._secPerTick:r.offset;if(this._synth.handleMidiEvent(r.event,n+c,u),"undefined"!=r.duration){var h=t.Util.cloneObject(r.event);h.subtype="noteOff";var l=r.duration*(4*this._sequencer.getNoteTime(.25));this._synth.handleMidiEvent(h,n+l+c,u)}}}if(this._nextClip++,this._nextClip==this._clips.length&&(this._nextClip=0),this._nextClip===o){t.log("MidiPattern",this._name,"got stuck, check if you're playing the correct midi track.");break}}if(this._progression&&this._currentChord.length){this._currentChord.sort(function(t,e){return t-e});var p=this._currentChord[0],_=p%12,u=0;_!=this._root&&(u=p-this._rootNote);for(var d=[0,0,0,0,0,0,0,0,0,0,0,0],f=[],g=0;g<this._currentChord.length;g++){var y=this._currentChord[g]%12-_;y<0&&(y+=12),f.push(y)}f.sort(function(t,e){return t-e});for(var m=0;m<d.length;m++){var v=this.getClosestValues(f,m);void 0!==v&&(d[m]=v-m)}this._sequencer.customScale=d,this._sequencer.transpose=u,this._rootNote=p}}},s.prototype.getClosestValues=function(t,e){for(var i=-1,n=t.length;n-i>1;){var s=Math.round((i+n)/2);t[s]<=e?i=s:n=s}var o;return t[i]==e&&(o=n=i),o=Math.abs(e-n)>Math.abs(e-i)?i:Math.abs(e-n)<Math.abs(e-i)?n:i,t[o]},s.prototype.findNextClip=function(t){for(var e=0,i=this._clips.length;e<i;e++)if(this._clips[e].step>=t)return this._nextClip=e,e},s.prototype.playStep=function(t,i){var n=!0;if(this._currentStep>=this._length+this._startStep&&(this.sendMidiEvents(this._length,i,!0),this._currentStep=this._startStep,this.findNextClip(this._currentStep),this._loop||(this.changeState(e.Stopped),n=!1),this._updatedClips.length)){var s=this._clips.concat(this._updatedClips);s.sort(function(t,e){return t.step-e.step}),this._clips=s,this._updatedClips=[]}n&&this.sendMidiEvents(this._currentStep,i,!1),this._totalStep+=this._beatSubscription,this._currentStep+=this._beatSubscription},s.prototype.update=function(t,i){if(this._state!=e.Stopped&&t%this._beatSubscription==0)switch(this._upbeats&&this._activeUpbeat!=-1&&this._upbeats[this._activeUpbeat].playInLoop&&this._state==e.Playing&&this._currentStep>=this._length+this._startStep-this._upbeatLoopOffset&&(this._upbeatLoopOffset>0&&(this._stepCount=this._upbeatLoopOffset,this.changeState(e.PrePlaying)),this.sendMidiEvents(this._currentStep,i,!0),this._currentStep=this._startStep,this.findNextClip(this._upbeats[this._activeUpbeat].step)),this._state){case e.PrePlaying:if(this._activeUpbeat!=-1){var n=this._upbeats[this._activeUpbeat],s=n.length-this._stepCount;s>=0&&this.sendMidiEvents(n.step+s,i,!1)}this._stepCount-=this._beatSubscription,this._stepCount<=0&&(this._activeUpbeat!=-1&&n.targetStep&&(this._currentStep=n.targetStep),this.findNextClip(this._currentStep),this.changeState(e.Playing));break;case e.Playing:this.playStep(t,i);break;case e.PreStopping:this._stepCount-=this._beatSubscription,this._stepCount<=0?this.stop(i,!1):this.playStep(t,i);break;case e.PostStop:}return this},s.prototype.recalculateBPM=function(t){var e=this._midiFile.header.ticksPerBeat,i=6e7/t,n=i/1e6;this._secPerTick=n/e},s.prototype.getNextBar=function(t){var e=Math.ceil(this._currentStep/t);return this._currentStep>this._length-t&&(e=0),e},s.prototype.fadeInAndPlay=function(e,i){return this.play(i),this.output.gain.value=0,t.Util.curveParamLin(this.output.gain,1,e,i),this},s.prototype.fadeOutAndStop=function(e,i){return void 0===i&&(i=t.context.currentTime),this.output.gain.cancelScheduledValues(i),t.Util.curveParamLin(this.output.gain,0,e,i),t.Util.setParam(this.output.gain,this._volume,i+e),this.stop(i+e),this},s.prototype.deschedule=function(t){if(void 0===t&&(t=this._length),this._synth.deschedule&&this._synth.deschedule(),this._state!=e.Stopped){if(t%=this._length,this._currentStep=this._currentStep-t,this._currentStep<this._startStep){var i=this._startStep-this._currentStep;this._currentStep=this._startStep+this._length-i}for(var n=0,s=this._clips.length;n<s;n++)if(this._clips[n].step>=this._currentStep){this._nextClip=n;break}}return this},s.prototype.resetTranspose=function(){this._transpose=this._orgTranspose},Object.defineProperty(s.prototype,"length",{get:function(){return this._length},set:function(t){this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"startStep",{set:function(t){this._startStep=t,this._currentStep=this._sequencer.currentStep%this._length+this._startStep;for(var e=0,i=this._clips.length;e<i;e++)if(this._clips[e].step>=this._currentStep){this._nextClip=e;break}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"scale",{set:function(t){this._progression||(this._scale="reset"===t?this._orgScale:t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"customScale",{set:function(e){this._progression||(t.audioUtil.scales.custom=e,this._scale="custom")},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"transpose",{get:function(){return this._transpose},set:function(t){this._transpose=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"playing",{get:function(){var t=!1;return 1!==this._state&&1!==this._state||(t=!0),t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"duration",{get:function(){return this._length*this._sequencer.getNoteTime(1)},enumerable:!0,configurable:!0}),s.prototype.getNoteInScale=function(e){return t.audioUtil.getNoteInScale(e,this._scale,this._root)},s.prototype.getPositionInPattern=function(){var e=this.length,i=this._sequencer.getNoteTime(e),n=(t.Util.now()-this._patternStartTime)%i,s=this._sequencer.getNoteTime(.25),o=n/s,r=Math.floor(o);return{step:r/4-.25,offset:s*(o-r)}},s.prototype.addNote=function(t,e,i,n,s){this.addSingleEvent("noteOn",t,e,i,s);var o=i+n;o>this.length&&(o-=this.length),this.addSingleEvent("noteOff",t,e,o,s)},s.prototype.addSingleEvent=function(t,e,i,n,s){this._updatedClips.push({event:{type:"channel",subtype:t,noteNumber:e,velocity:i},step:n,offset:s||0}),this._updatedClips.sort(function(t,e){return t.step-e.step})},s.prototype.setData=function(t){n.prototype.setData.call(this,t);var e=!1;if(this._beatSubscription=void 0===t.beat_subscription?.25:t.beat_subscription,this._midiFile!=t.file_id&&(this._midiFile=t.file_id),this._midiTrackIx!=t.midi_track&&(this._midiTrackIx=t.midi_track),void 0!==t.sequener&&this._sequencerName!=t.sequencer&&(this._sequencerName=t.sequencer,e=!0),void 0!==t.synth&&this._synthName!=t.synth&&(this._synthName=t.synth,e=!0),t.clips&&(this._clips=t.clips),this._loop=void 0!==t.loop&&t.loop,this._length=void 0===t.length?0:t.length,this._root=void 0===t.root?0:t.root,this._orgTranspose=void 0===t.transpose?0:t.transpose,this._transpose=this._orgTranspose,this._orgScale=void 0===t.scale?0:t.scale,this._scale=this._orgScale,this._rootNote=void 0===t.root_note?36:t.root_note,this._activeUpbeat=-1,t.upbeats){this._upbeats=[],this._upbeatLoopOffset=0;for(var i=0,s=t.upbeats.length;i<s;i++)this._upbeats.push({length:t.upbeats[i].length,step:t.upbeats[i].step,targetStep:t.upbeats[i].target_step,playInLoop:t.upbeats[i].play_in_loop});e=!0}e&&(this._sequencer.unregisterPattern(this),this.init())},s}(t.Model.Audio);return t.Model.MidiPattern=n}),e(function(t){function e(e){this.active=!0,this._type=e.type,this._output&&this.disconnect(),this._input=t.context.createGain(),this._output=t.context.createGain(),e.active===!1&&(this.active=!1)}return e.prototype.connect=function(t){return this._output.connect(t),this},e.prototype.disconnect=function(){return this._output.disconnect(),this},e.prototype.setActive=function(e){return t.warn("Effect: Invocation of abstract method: Effect.setActive in",this),this},Object.defineProperty(e.prototype,"input",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),t.Model.Effect=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._wet=t.context.createGain(),this._wet.gain.setValueAtTime(i.wet,t.context.currentTime),this._input.connect(this._wet),this._input.connect(this._output),this.destinationName=i.destination_name,t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){var e=t.core.Core.instance.findInstance(this.destinationName);e&&this._wet.connect(e.input)},i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._wet),this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"wet",{get:function(){return this._wet.gain},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.wet&&(this.wet.value=t.wet),t.destination_name!=this.destinationName&&(this.destinationName=t.destination_name,this._wet.disconnect(),this.init())},i}(t.Model.Effect);return t.Model.EffectSend=e}),e(function(t){var e=function(e){function i(i){if(e.call(this,i),this._filters=[],"Firefox"==t.detector.browser.name)return void this._input.connect(this._output);if(0==i.bands.length)t.warn("Equalizer: No bands specified"),this._input.connect(this.output);else{for(var n=0,s=i.bands.length;n<s;n++){var o=i.bands[n],r=t.context.createBiquadFilter();o.filter_type&&(r.type=t.Util.safeFilterType(o.filter_type)),o.frequency&&(r.frequency.value=o.frequency),o.gain&&(r.gain.value=o.gain),o.Q&&(r.Q.value=o.Q),0==n?this._input.connect(r):this._filters[n-1].connect(r),this._filters.push(r)}this._filters[this._filters.length-1].connect(this._output)}}return t.Util.__extends(i,e),i.prototype.addFilter=function(e,i,n,s){var o=t.context.createBiquadFilter();o.type=e,o.frequency.value=i,o.gain.value=s,o.Q.value=n,0==this._filters.length?(this._input.disconnect(),this._input.connect(o)):(this._filters[this._filters.length-1].disconnect(),this._filters[this._filters.length-1].connect(o)),o.connect(this.output),this._filters.push(o)},i.prototype.removeFilter=function(t){this._filters[t].disconnect(),0==t&&this._filters.length>1?(this._input.disconnect(),this._input.connect(this._filters[1])):0==t?(this._input.disconnect(),this._input.connect(this._output)):t==this._filters.length-1?(this._filters[t-1].disconnect(),this._filters[t-1].connect(this._output)):(this._filters[t-1].disconnect(),this._filters[t-1].connect(this._filters[t+1])),this._filters.splice(t,1)},i.prototype.setActive=function(t){return this._input.disconnect(),t?0==this._filters.length?this._input.connect(this._output):this._input.connect(this._filters[0]):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"filters",{get:function(){return this._filters},enumerable:!0,configurable:!0}),i.prototype.setData=function(e){for(var i=0,n=this._filters.length;i<n;i++){var s=e.bands[i],o=this._filters[i];if(o&&s){o.frequency.value=s.frequency,o.Q.value=s.Q,o.gain.value=s.gain;var r=t.Util.safeFilterType(s.filter_type);o.type!=r&&(o.type=r)}}},i}(t.Model.Effect);return t.Model.Equalizer=e}),e(function(t){var e=function(e){function i(t){e.call(this,t),this.init(t)}return t.Util.__extends(i,e),i.prototype.init=function(e){this._data=e,this._filter=t.context.createBiquadFilter(),this._filter.type=t.Util.safeFilterType(e.filter_type),this._input.connect(this._filter),this._filter.connect(this._output);var i=void 0!==e.frequency?e.frequency:1e3;this._filter.frequency.setValueAtTime(i,t.context.currentTime);var n=void 0!==e.Q?e.Q:1;this._filter.Q.setValueAtTime(n,t.context.currentTime);var s=void 0!==e.gain?e.gain:0;this._filter.gain.setValueAtTime(s,t.context.currentTime)},i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._filter):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"frequency",{get:function(){return this._filter.frequency},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Q",{get:function(){return this._filter.Q},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gain",{get:function(){return this._filter.gain},enumerable:!0,configurable:!0}),i.prototype.refreshAudioNodes=function(){var e=this._filter.frequency.value,i=this._filter.Q.value,n=this._filter.gain.value;this._filter.frequency.cancelScheduledValues(t.context.currentTime),this._filter.Q.cancelScheduledValues(t.context.currentTime),this._filter.gain.cancelScheduledValues(t.context.currentTime),this._filter.disconnect(),this.init(this._data),this._filter.frequency.value=e,this._filter.Q.value=i,this._filter.gain.value=n},i.prototype.setData=function(e){void 0===e.filter_type&&(e.filter_type="lowpass"),this._filter.type!=e.filter_type&&(this._filter.type=t.Util.safeFilterType(e.filter_type)),this._filter.frequency.value=void 0===e.frequency?1e3:e.frequency,this._filter.Q.value=void 0===e.Q?1:e.Q,this._filter.gain.value=void 0===e.gain?0:e.gain},i}(t.Model.Effect);return t.Model.BiquadFilter=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._pro=t.context.createScriptProcessor(i.buffer_size||4096,2,2);var n=this;this._pro.onaudioprocess=function(t){for(var e=t.inputBuffer,i=t.outputBuffer,s=e.getChannelData(0),o=e.getChannelData(1),r=i.getChannelData(0),a=i.getChannelData(1),u=Math.pow(.5,n._bits),c=e.length,h=0,l=0,p=0,_=0;_<c;++_)(h+=n._reduction)>=1&&(h--,l=u*Math.floor(s[_]/u),p=u*Math.floor(o[_]/u)),r[_]=l,a[_]=p},this._bits=i.bits||4,this._reduction=i.reduction||.2,this._input.connect(this._pro),this._pro.connect(this._output)}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._pro),this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"bits",{get:function(){return this._bits},set:function(t){this._bits=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._reduction},set:function(t){this._reduction=t},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){this._bits=void 0!==t.bits?t.bits:4,this._reduction=void 0!==t.reduction?t.reduction:.2},i}(t.Model.Effect);return t.Model.Bitcrusher=e}),e(function(t){var e=function(e){function i(i){if(e.call(this,i),this._bypass=i.bypass,t.isMobile)return void this._input.connect(this._output);this._dynamicsCompressor=t.context.createDynamicsCompressor(),this._makeUpGain=t.context.createGain(),
this._input.connect(this._dynamicsCompressor),this._dynamicsCompressor.connect(this._makeUpGain),this._makeUpGain.connect(this._output),this._bypass&&(this._input.connect(this._output),this._makeUpGain.gain.value=0),this._dynamicsCompressor.threshold.value=i.threshold||this._dynamicsCompressor.threshold.value,this._dynamicsCompressor.knee.value=i.knee||this._dynamicsCompressor.knee.value,this._dynamicsCompressor.ratio.value=i.ratio||this._dynamicsCompressor.ratio.value,this._dynamicsCompressor.attack.value=i.attack||this._dynamicsCompressor.attack.value,this._dynamicsCompressor.release.value=i.release||this._dynamicsCompressor.release.value,this._makeUpGain.gain.value=i.make_up_gain||this._makeUpGain.gain.value}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._dynamicsCompressor),this._bypass&&this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"threshold",{get:function(){return this._dynamicsCompressor.threshold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"knee",{get:function(){return this._dynamicsCompressor.knee},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._dynamicsCompressor.ratio},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"attack",{get:function(){return this._dynamicsCompressor.attack},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"release",{get:function(){return this._dynamicsCompressor.release},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._dynamicsCompressor.reduction},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"makeUpGain",{get:function(){return this._makeUpGain.gain},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.threshold&&(this.threshold.value=t.threshold),void 0!==t.knee&&(this.knee.value=t.knee),void 0!==t.ratio&&(this.ratio.value=t.ratio),void 0!==t.attack&&(this.attack.value=t.attack),void 0!==t.release&&(this.release.value=t.release),void 0!==t.make_up_gain&&(this.makeUpGain.value=t.make_up_gain)},i}(t.Model.Effect);return t.Model.Compressor=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._soundName=i.sound,this._convolver=t.context.createConvolver(),this._wetGain=t.context.createGain(),this._dryGain=t.context.createGain(),this._wetGain.gain.value=1,this._dryGain.gain.value=0,this._wetGain.connect(this._convolver),this._dryGain.connect(this._output),this._input.connect(this._wetGain),this._input.connect(this._dryGain),this._convolver.connect(this._output),t.core.Core.instance.pushToPostLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.dryWet=function(t){t=Math.max(0,Math.min(1,t)),this._wetGain.gain.value=t,this._dryGain.gain.value=1-t},i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._convolver):this._input.connect(this._output),this},i.prototype.init=function(){var e=t.core.Core.instance.findInstance(this._soundName);this._convolver.buffer=e.buffer},i.prototype.setData=function(t){t.sound&&t.sound!=this._soundName&&(this._soundName=t.sound,this.init())},i}(t.Model.Effect);return t.Model.Convolver=e}),e(function(t){var e=function(e){function i(t){e.call(this,t),this._sync=t.sync}return t.Util.__extends(i,e),i.prototype.init=function(){if(this._sync){var e=t.core.Core.instance.findInstance(this._sync);this.updateSync(e.bpm),e.registerBPMSync(this)}},i.prototype.setSync=function(t,e){return t?(this._sync=t,this._syncResolution=e||1,this.init()):(this._sync=null,this._syncResolution=null),this},i.prototype.setSyncRate=function(e){return this._sync&&(this._syncResolution=e,this.updateSync(t.core.Core.instance.findInstance(this._sync).bpm)),this},i.prototype.updateSync=function(e){return t.warn("DelayBase: Invocation of abstract method: DelayBase.updateSync in",this),this},Object.defineProperty(i.prototype,"sync",{get:function(){return this._sync},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"syncResolution",{get:function(){return this._syncResolution},set:function(t){this._syncResolution=t},enumerable:!0,configurable:!0}),i}(t.Model.Effect);return t.Model.DelayBase=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._feedback=t.context.createGain(),this._delay=t.context.createDelay(),i.filter?(this._filter=t.context.createBiquadFilter(),this._input.connect(this._filter),this._filter.connect(this._delay),this._filter.type=t.Util.safeFilterType(i.filter.filter_type),this._filter.frequency.value=i.filter.frequency||1e3,this._filter.Q.value=i.filter.Q||4,this._filter.gain.value=i.filter.gain||1):this._input.connect(this._delay),this._delay.connect(this._feedback),this._delay.connect(this._output),this._feedback.connect(this._delay),this.sync?(t.core.Core.instance.pushToPreLoadInitStack(this),this.syncResolution=i.delay_time||1):this._delay.delayTime.value=i.delay_time||.125,this._feedback.gain.value=i.feedback||.3,this._output.gain.value=i.output_vol||i.wet||1}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._delay):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._delay.delayTime.value=60/t*this.syncResolution,this},Object.defineProperty(i.prototype,"delayTime",{get:function(){return this._delay.delayTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"feedback",{get:function(){return this._feedback.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),i.prototype.setData=function(e){e.feedback&&(this._feedback.gain.value=e.feedback),e.sync?this.setSync(e.sync,e.delay_time):e.delay_time&&(this._delay.delayTime.value=e.delay_time),e.filter?(this._filter||(this.input.disconnect(),this._filter=t.context.createBiquadFilter(),this.input.connect(this._filter),this._filter.connect(this._delay)),void 0!==e.filter.filter_type&&(this._filter.type=t.Util.safeFilterType(e.filter.filter_type)),void 0!==e.filter.frequency&&(this._filter.frequency.value=e.filter.frequency),void 0!==e.filter.Q&&(this._filter.Q.value=e.filter.Q),void 0!==e.filter.gain&&(this._filter.gain.value=e.filter.gain)):this._filter&&(this.input.disconnect(),this._filter.disconnect(),this.input.connect(this._delay),this._filter=null)},i}(t.Model.DelayBase);return t.Model.Delay=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this.sync&&(i.left.sync=this.sync,i.right.sync=this.sync),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._leftDelay=t.context.createDelay(),this._rightDelay=t.context.createDelay(),this._input.connect(this._splitter),this._splitter.connect(this._leftDelay,0,0),this._splitter.connect(this._rightDelay,0,0),this._splitter.connect(this._rightDelay,1,0),this._leftDelay.connect(this._merger,0,0),this._rightDelay.connect(this._merger,0,1),this._merger.connect(this._output)}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._leftDelay.updateSync(t),this._rightDelay.updateSync(t),this},Object.defineProperty(i.prototype,"leftDelay",{get:function(){return this._leftDelay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightDelay",{get:function(){return this._rightDelay},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){this._leftDelay.setData(t.left),this._rightDelay.setData(t.right)},i}(t.Model.DelayBase);return t.Model.StereoDelay=e}),e(function(t){var e=function(e){function i(i){if(e.call(this,i),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._mono=t.context.createGain(),this._leftDelay=t.context.createDelay(),this._rightDelay=t.context.createDelay(),this._feedback=t.context.createGain(),i.filter?(this._filter=t.context.createBiquadFilter(),this._mono.connect(this._filter),this._filter.connect(this._leftDelay),this._feedback.connect(this._filter),this._filter.type=t.Util.safeFilterType(i.filter.filter_type),this._filter.frequency.value=i.filter.frequency||1e3,this._filter.Q.value=i.filter.Q||4,this._filter.gain.value=i.filter.gain||1):(this._mono.connect(this._leftDelay),this._feedback.connect(this._leftDelay)),this._input.connect(this._splitter),this._splitter.connect(this._mono,0,0),this._splitter.connect(this._mono,1,0),this._leftDelay.connect(this._rightDelay),this._rightDelay.connect(this._feedback),this._leftDelay.connect(this._merger,0,0),this._rightDelay.connect(this._merger,0,1),this._merger.connect(this._output),this.sync)t.core.Core.instance.pushToPreLoadInitStack(this),this.syncResolution=i.delay_time||1;else{var n=i.delay_time||.125;this._leftDelay.delayTime.setValueAtTime(n,t.context.currentTime),this._rightDelay.delayTime.setValueAtTime(n,t.context.currentTime)}var s=i.feedback||.3;this._feedback.gain.setValueAtTime(s,t.context.currentTime);var o=i.output_vol||i.wet||1;this._output.gain.setValueAtTime(o,t.context.currentTime)}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._leftDelay.delayTime.value=60/t*this.syncResolution,this._rightDelay.delayTime.value=this._leftDelay.delayTime.value,this},Object.defineProperty(i.prototype,"delay_time",{set:function(t){this._leftDelay.delayTime.value=t,this._rightDelay.delayTime.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"feedback",{get:function(){return this._feedback.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),i.prototype.setData=function(e){e.feedback&&(this._feedback.gain.value=e.feedback),e.sync?this.setSync(e.sync,e.delay_time):e.delay_time&&(this._leftDelay.delayTime.value=e.delay_time,this._rightDelay.delayTime.value=e.delay_time),e.filter?(this._filter||(this._mono.disconnect(),this._feedback.disconnect(),this._filter=t.context.createBiquadFilter(),this._mono.connect(this._filter),this._filter.connect(this._leftDelay),this._feedback.connect(this._filter)),void 0!==e.filter.filter_type&&(this._filter.type=t.Util.safeFilterType(e.filter.filter_type)),void 0!==e.filter.frequency&&(this._filter.frequency.value=e.filter.frequency),void 0!==e.filter.Q&&(this._filter.Q.value=e.filter.Q),void 0!==e.filter.gain&&(this._filter.gain.value=e.filter.gain)):this._filter&&(this._mono.disconnect(),this._feedback.disconnect(),this._filter.disconnect(),this._mono.connect(this._leftDelay),this._feedback.connect(this._leftDelay),this._filter=null)},i}(t.Model.DelayBase);return t.Model.PingPongDelay=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._compressor=t.context.createDynamicsCompressor(),this._preGain=t.context.createGain(),this._postGain=t.context.createGain(),this._input.connect(this._preGain),this._preGain.connect(this._compressor),this._compressor.connect(this._postGain),this._postGain.connect(this._output),this._compressor.threshold.value=i.threshold||0,this._compressor.knee.value=0,this._compressor.ratio.value=100,this._compressor.attack.value=0,this._compressor.release.value=0,this._preGain.gain.value=void 0===i.pre_gain?1:i.pre_gain,this._postGain.gain.value=void 0===i.post_gain?1:i.post_gain}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._preGain):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"threshold",{get:function(){return this._compressor.threshold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"preGain",{get:function(){return this._preGain.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"postGain",{get:function(){return this._postGain.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._compressor.reduction},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.threshold&&(this._compressor.threshold.value=t.threshold),void 0!==t.pre_gain&&(this._preGain.gain.value=t.pre_gain),void 0!==t.post_gain&&(this._postGain.gain.value=t.post_gain)},i}(t.Model.Effect);return t.Model.Limiter=e}),e(function(t){var e=function(e){function i(n){e.call(this,n),this.data=n,this._name=n.name,this._panner=t.context.createPanner(),this._input.connect(this._panner),this._panner.connect(this._output),void 0!==n.panning_model&&(this._panner.panningModel=n.panning_model),void 0!==n.distance_model&&(this._panner.distanceModel=n.distance_model),void 0!==n.ref_distance&&(this._panner.refDistance=n.ref_distance),void 0!==n.max_distance&&(this._panner.maxDistance=n.max_distance),void 0!==n.rolloff_factor&&(this._panner.rolloffFactor=n.rolloff_factor),void 0!==n.cone_inner_angle&&(this._panner.coneInnerAngle=n.cone_inner_angle),void 0!==n.cone_outer_angle&&(this._panner.coneOuterAngle=n.cone_outer_angle),void 0!==n.cone_outer_gain&&(this._panner.coneOuterGain=n.cone_outer_gain),void 0!==n.position&&this._panner.setPosition(n.position[0],n.position[1],n.position[2]),void 0!==n.orientation&&this._panner.setOrientation(n.position[0],n.position[1],n.position[2]),i.panners[this._name]=this}return t.Util.__extends(i,e),i.panners={},i._scale=1,i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._panner):this._input.connect(this._output),this},i.prototype.setPosition=function(t,e,n){this._panner.setPosition(t*i.scale,e*i.scale,n*i.scale)},i.prototype.setOrientation=function(t,e,i){this._panner.setOrientation(t,e,i)},i.prototype.setVelocity=function(e,i,n){t.warn("setVelocity is removed from Klang and the WebAudio API")},i.prototype.setData=function(t){this._panner.setPosition(t.position[0],t.position[1],t.position[2]),this._panner.setOrientation(t.position[0],t.position[1],t.position[2]),void 0!==t.panning_model&&(this._panner.panningModel=t.panning_model),void 0!==t.distance_model&&(this._panner.distanceModel=t.distance_model),void 0!==t.ref_distance&&(this._panner.refDistance=t.ref_distance),void 0!==t.max_distance&&(this._panner.maxDistance=t.max_distance),void 0!==t.rolloff_factor&&(this._panner.rolloffFactor=t.rolloff_factor),void 0!==t.cone_inner_angle&&(this._panner.coneInnerAngle=t.cone_inner_angle),void 0!==t.cone_outer_angle&&(this._panner.coneOuterAngle=t.cone_outer_angle),void 0!==t.cone_outer_gain&&(this._panner.coneOuterGain=t.cone_outer_gain)},Object.defineProperty(i,"listener",{get:function(){return t.context.listener},enumerable:!0,configurable:!0}),i.setListenerPosition=function(e,n,s){t.context.listener.setPosition(e*i.scale,n*i.scale,s*i.scale)},i.setListenerOrientation=function(e,i,n,s,o,r){t.context.listener.setOrientation(e,i,n,s,o,r)},i.setListenerVelocity=function(e,i,n){t.warn("setListenerVelocity is removed from Klang and the WebAudio API")},i.setDopplerFactor=function(e){t.warn("setDopplerFactor is removed from Klang and the WebAudio API")},i.setSpeedOfSound=function(e){t.context.listener.speed=e},i.setListenerData=function(t){t&&(i.scale=t.scale,i.setListenerPosition(t.position[0],t.position[1],t.position[2]),i.setListenerOrientation(t.orientation[0],t.orientation[1],t.orientation[2],t.orientation_up[0],t.orientation_up[1],t.orientation_up[2]),i.setSpeedOfSound(t.speed_of_sound))},i.get=function(t){return i.panners[t]},Object.defineProperty(i,"scale",{get:function(){return i._scale},set:function(t){i._scale=t},enumerable:!0,configurable:!0}),i}(t.Model.Effect);return t.Model.Panner=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._source=i.source,this._gain=t.context.createGain(),this._processor=t.context.createScriptProcessor(i.buffer_size||0);var n=this,s="number"!=typeof this._source.reduction;this._processor.onaudioprocess=function(){var t=s?n._source.reduction.value:n._source.reduction;n._gain.gain.value=0===t?1:Math.pow(10,t/20)},this._input.connect(this._gain),this._input.connect(this._processor),this._processor.connect(t.context.destination),this._gain.connect(this._output),t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){this._source&&this._source.bus&&void 0!==this._source.index||t.warn("Sidechain: No source specified");var e=t.core.Core.instance.findInstance(this._source.bus);this._source=e._effects[this._source.index]},i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._gain),this._input.connect(this._processor)):this._input.connect(this._output),this},i}(t.Model.Effect);return t.Model.Sidechain=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._left=t.context.createGain(),this._right=t.context.createGain(),this._input.connect(this._splitter),this._splitter.connect(this._left,0,0),this._splitter.connect(this._right,1,0),this._left.connect(this._merger,0,0),this._right.connect(this._merger,0,1),this._merger.connect(this._output),this.pan=i.pan}return t.Util.__extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.getGainValue=function(t){return(t+1)/2},i.prototype.setPanTo=function(t,e){var i=this.getGainValue(t);return this._left.gain.setValueAtTime(1-i,e||0),this._right.gain.setValueAtTime(i,e||0),this},i.prototype.linPanTo=function(e,i,n){n=n||t.context.currentTime;var s=this.getGainValue(e);return this._left.gain.setValueAtTime(this._left.gain.value,n),this._left.gain.linearRampToValueAtTime(1-s,n+i),this._right.gain.setValueAtTime(this._right.gain.value,n),this._right.gain.linearRampToValueAtTime(s,n+i),this},i.prototype.expPanTo=function(e,i,n){n=n||t.context.currentTime;var s=this.getGainValue(e);return this._left.gain.setValueAtTime(0==this._left.gain.value?t.Util.EXP_MIN_VALUE:this._left.gain.value,n),this._left.gain.exponentialRampToValueAtTime(1-s,n+i),this._right.gain.setValueAtTime(0==this._right.gain.value?t.Util.EXP_MIN_VALUE:this._right.gain.value,n),this._right.gain.exponentialRampToValueAtTime(s,n+i),this},Object.defineProperty(i.prototype,"pan",{get:function(){return this._right.gain.value},set:function(t){var e=this.getGainValue(t);this._left.gain.value=1-e,this._right.gain.value=e},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.pan&&(this.pan=t.pan)},i}(t.Model.Effect),i=function(i){function n(e){i.call(this,e),this._panner=t.context.createStereoPanner(),this._panner.pan.setValueAtTime(e.pan,t.context.currentTime),this._input.connect(this._panner),this._panner.connect(this._output)}return window.AudioContext&&void 0===window.AudioContext.prototype.createStereoPanner?e:(t.Util.__extends(n,i),n.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},n.prototype.getGainValue=function(t){return t},n.prototype.setPanTo=function(e,i){return i=Math.max(i||0,t.context.currentTime),this._panner.pan.cancelScheduledValues(i),this._panner.pan.setValueAtTime(e,i),this},n.prototype.linPanTo=function(e,i,n){return n=Math.max(n||0,t.context.currentTime),this._panner.pan.cancelScheduledValues(n),this._panner.pan.setValueAtTime(this._panner.pan.value,n),this._panner.pan.linearRampToValueAtTime(e,n+i),this},n.prototype.expPanTo=function(e,i,n){return n=n||t.context.currentTime,e=t.Util.clamp(e,-.99,.99),this._panner.pan.setValueAtTime(0==this._panner.pan.value?t.Util.EXP_MIN_VALUE:this._panner.pan.value,n),this._panner.pan.exponentialRampToValueAtTime(e,n+i),this},n.prototype.refreshAudioNodes=function(){var e=this._panner.pan.value;this._panner.pan.cancelScheduledValues(t.context.currentTime),this._panner.disconnect(),this._panner=t.context.createStereoPanner(),this._panner.pan.value=e,this._input.connect(this._panner),this._panner.connect(this._output)},Object.defineProperty(n.prototype,"pan",{get:function(){return this._panner.pan.value},set:function(t){this._panner.pan.value=t},enumerable:!0,configurable:!0}),n.prototype.setData=function(t){void 0!==t.pan&&(this.pan=t.pan)},n)}(t.Model.Effect);return t.Model.StereoPanner=i}),e(function(t){var e=function(e){function i(i,n){e.call(this,i),i.sync&&(this._sync=i.sync,this._rate=i.rate||.25),this._oscillator=t.context.createOscillator(),this._amplitude=t.context.createGain(),this._input.connect(this._output),this._oscillator.connect(this._amplitude),this._amplitude.connect(this._output.gain),this._oscillator.frequency.value=i.frequency||10,this._oscillator.type=i.wave||0,this._amplitude.gain.value=i.amplitude||1,this._oscillator.start(n),t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){if(this._sync){var e=t.core.Core.instance.findInstance(this._sync);this.updateSync(e.bpm),e.registerBPMSync(this)}},i.prototype.setActive=function(t){return t?this._amplitude.connect(this._output.gain):this._amplitude.disconnect(),this},i.prototype.updateSync=function(t){return this._oscillator.frequency.value=t/60/this._rate,this},Object.defineProperty(i.prototype,"frequency",{get:function(){return this._oscillator.frequency},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"amplitude",{get:function(){return this._amplitude.gain},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.amplitude&&(this.amplitude.value=t.amplitude),void 0!==t.wave&&(this._oscillator.type=t.wave),t.sync?(this._sync=t.sync,this._rate=t.rate||.25,this.init()):void 0!==t.frequency&&(this.frequency.value=t.frequency)},i}(t.Model.Effect);return t.Model.Tremolo=e}),e(function(t){var e=function(e){function i(i){e.call(this,i),this._samples=8192,this._distortionType=i.distortion_type||0,this._amount=i.amount||.7,this._samples=8192,this._waveshaper=t.context.createWaveShaper(),this._inputDrive=t.context.createGain(),this._outputDrive=t.context.createGain(),this._input.connect(this._inputDrive),this._inputDrive.connect(this._waveshaper),this._waveshaper.connect(this._outputDrive),this._outputDrive.connect(this._output),this._ws_table=new Float32Array(this._samples),this.createWSCurve(this._distortionType,this._amount),this._inputDrive.gain.value=i.drive||.5,this._outputDrive.gain.value=i.outputGain||.5}return t.Util.__extends(i,e),i.prototype.createWSCurve=function(t,e){switch(t){case 0:var i,n,e=Math.min(e,.9999),s=2*e/(1-e);for(i=0;i<this._samples;i++)n=2*i/this._samples-1,this._ws_table[i]=(1+s)*n/(1+s*Math.abs(n));break;case 1:var i,n,o;for(i=0;i<this._samples;i++)n=2*i/this._samples-1,o=(.5*Math.pow(n+1.4,2)-1)*o>=0?5.8:1.2,this._ws_table[i]=this.tanh(o);break;case 2:var i,n,o,r=1-e;for(i=0;i<this._samples;i++)n=2*i/this._samples-1,o=n<0?-Math.pow(Math.abs(n),r+.04):Math.pow(n,r),this._ws_table[i]=this.tanh(2*o);break;case 3:var i,n,o,a,r=1-e>.99?.99:1-e;for(i=0;i<this._samples;i++)n=2*i/this._samples-1,a=Math.abs(n),a<r?o=a:a>r?o=r+(a-r)/(1+Math.pow((a-r)/(1-r),2)):a>1&&(o=a),this._ws_table[i]=this.sign(n)*o*(1/((r+1)/2));break;case 4:var i,n;for(i=0;i<this._samples;i++)n=2*i/this._samples-1,this._ws_table[i]=n<-.08905?-.75*(1-Math.pow(1-(Math.abs(n)-.032857),12)+1/3*(Math.abs(n)-.032847))+.01:n>=-.08905&&n<.320018?n*n*-6.153+3.9375*n:.630035;break;case 5:var i,n,r=2+Math.round(14*e),u=Math.round(Math.pow(2,r-1));for(i=0;i<this._samples;i++)n=2*i/this._samples-1,this._ws_table[i]=Math.round(n*u)/u}this._waveshaper.curve=this._ws_table},i.prototype.tanh=function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},i.prototype.sign=function(t){return 0===t?1:Math.abs(t)/t},i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._inputDrive):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t,this.createWSCurve(this._distortionType,this._amount)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"distortionType",{get:function(){return this._distortionType},set:function(t){this._distortionType=t,this.createWSCurve(this._distortionType,this._amount)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drive",{get:function(){return this._inputDrive.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outputGain",{get:function(){return this._outputDrive.gain},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){void 0!==t.amount&&(this.amount=t.amount),void 0!==t.distortion_type&&(this.distortionType=t.distortion_type),void 0!==t.drive&&(this._inputDrive.gain.value=t.drive),void 0!==t.outputGain&&(this._outputDrive.gain.value=t.outputGain)},i}(t.Model.Effect);return t.Model.Distortion=e}),e(function(t){function e(e,i){this._arpCounter=0,this._arpNoteLength=.5,this._arpPattern=[],this._arpPatternStep=0,this._name=i,this._type=e.type,this._output=t.context.createGain(),this._output.gain.value=e.volume||1,e.destination_name&&(this.destinationName=e.destination_name,t.core.Core.instance.initComplete||t.core.Core.instance.pushToConnectStack(this)),e.arp?(this._arpMode=e.arp.arp_mode||"off",this._octaves=e.arp.octaves||1,this._sync=e.arp.sync,this._arpPattern=e.arp.arp_pattern||[]):this._arpMode="off",this._activeVoices=[],this._arpVoices=[],this._beatSubscription=e.beat_subscription||.25,this.data=e}return e.prototype.connect=function(t){return this._output.connect(t),this},e.prototype.disconnect=function(){return this._output.disconnect(),this},e.prototype.handleMidiEvent=function(e,i,n,s){return t.warn("Synth: Invocation of abstract method: Synth.handleMidiEvent in",this),this},e.prototype.stop=function(){t.warn("Synth: Invocation of abstract method: Synth.stop in",this)},e.prototype.handleArpModes=function(e){if(this._arpVoices=[],this._octaves>1){for(var i=[],n=0;n<this._octaves-1;n++)for(var s=0;s<this._activeVoices.length;s++){var o=this._activeVoices[s].midiEvent,r=o.noteNumber,a={type:"channel",subtype:o.subtype,noteNumber:r+=12*(n+1),velocity:o.velocity,deltaTime:o.deltaTime};i.push({midiEvent:a,transpose:this._activeVoices[s].transpose})}this._arpVoices=this._activeVoices.concat(i)}else this._arpVoices=this._activeVoices;if("up"===this._arpMode)this._arpVoices=this._arpVoices.sort(this.sortVoices);else if("down"===this._arpMode)this._arpVoices=this._arpVoices.sort(this.sortVoices),this._arpVoices.reverse();else if("up-down"===this._arpMode){var u=this._arpVoices.slice(0);u.sort(this.sortVoices);var c=this._arpVoices.slice(0);c.sort(this.sortVoices),c.reverse(),this._arpVoices=u.concat(c),this._arpVoices.length>1&&(this._arpVoices.splice(this._arpVoices.length/2,1),this._arpVoices.pop())}else"random"===this._arpMode&&(this._arpVoices=t.Util.shuffle(this._arpVoices))},e.prototype.sortVoices=function(t,e){return t.midiEvent.noteNumber<e.midiEvent.noteNumber?-1:t.midiEvent.noteNumber>e.midiEvent.noteNumber?1:0},e.prototype.arpActive=function(e){if(e){if(this._sync){var i=t.core.Core.instance.findInstance(this._sync);i.registerSynth(this),i._started||i.start()}}else if(this._arpMode="off",this._sync){var i=t.core.Core.instance.findInstance(this._sync);i.unregisterSynth(this)}},e.prototype.update=function(t,e){if(t%this._beatSubscription==0){if(this._arpPatternStep=4*t%this._arpPattern.length,0===this._arpVoices.length)return;if(this._arpPattern.length&&!this._arpPattern[4*t%this._arpPattern.length])return;if(this._arpCounter++,this._arpCounter=this._arpCounter%this._arpVoices.length,this._arpCounter<this._arpVoices.length){var i=this._fixedVelocities?this._fixedVelocities[this._arpCounter]:this._arpVoices[this._arpCounter].midiEvent.velocity;this._arpVoices[this._arpCounter].midiEvent.velocity=i,this.handleMidiEvent(this._arpVoices[this._arpCounter].midiEvent,e,this._arpVoices[this._arpCounter].transpose,!0);var n={type:"channel",subtype:"noteOff",noteNumber:this._arpVoices[this._arpCounter].midiEvent.noteNumber,velocity:this._arpVoices[this._arpCounter].midiEvent.velocity,deltaTime:this._arpVoices[this._arpCounter].midiEvent.deltaTime};this.handleMidiEvent(n,e+this._arpNoteLength,this._arpVoices[this._arpCounter].transpose,!0)}}},e.prototype.deschedule=function(){return t.warn("Synth: Invocation of abstract method: Synth.deschedule in",this),this},Object.defineProperty(e.prototype,"arpCounter",{get:function(){return this._arpCounter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arpLength",{get:function(){return this._arpVoices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arpPattern",{get:function(){return this._arpPattern},set:function(t){this._arpPattern=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arpPatternStep",{get:function(){return this._arpPatternStep},enumerable:!0,configurable:!0}),e.prototype.setData=function(e){if(void 0!==e.volume&&(this.output.gain.value=e.volume),this.destinationName!=e.destination_name&&(this.destinationName=e.destination_name,this.disconnect(),this.connect(t.core.Core.instance.findInstance(this.destinationName).input)),e.arp){if(this._sync=e.arp.sync,this._octaves=e.arp.octaves,this._arpPattern=e.arp.arp_pattern,"off"==this._arpMode){var i=t.core.Core.instance.findInstance(this._sync);i.registerSynth(this),i._started||i.start()}this._arpMode=e.arp.arp_mode}else if(this._arpMode="off",this._sync){var i=t.core.Core.instance.findInstance(this._sync);i.unregisterSynth(this)}this.data=e},t.Model.Synth=e}),e(function(t){function e(e,i){i=i||0,this._targets=e.targets,this._sync=e.sync,this._rate=e.rate||1,this._phaseVal=e.phase||0,this._oscillator=t.context.createOscillator(),this._oscillator.type=e.wave||"sine",this._oscillator.frequency.value=this._rate,this._amplitude=t.context.createGain(),this._amplitude.gain.value=e.amplitude||1,this._phase=t.context.createDelay(),this._phase.delayTime.value=this._phaseVal*(1/this._oscillator.frequency.value),this._oscillator.connect(this._phase),this._phase.connect(this._amplitude),this._oscillator.start(i),t.core.Core.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){if(this._sync){var e=t.core.Core.instance.findInstance(this._sync);this.updateSync(e.bpm),e.registerBPMSync(this)}for(var i=0,n=this._targets.length;i<n;i++){var s=this._targets[i],o=t.core.Core.instance.findInstance(s.bus),r=o.effects[s.effect];r||t.warn("LFO: Effect index out of bounds: "+s.effect),r[s.param]||t.warn("LFO: Parameter not recognized: "+s.param),this._amplitude.connect(r[s.param])}},e.prototype.updateSync=function(t){return this._oscillator.frequency.value=t/60/this._rate,this._phase.delayTime.value=this._phaseVal*(1/this._oscillator.frequency.value),this},e.prototype.setData=function(t){this._oscillator.type=t.wave,this._oscillator.frequency.value=t.rate,this._phase.delayTime.value=t.phase*(1/this._oscillator.frequency.value),this._amplitude.gain.value=t.amplitude||1,t.targets&&(this._targets=t.targets,this.init()),this._sync!=t.sync&&(this._sync=t.sync,this.init())},t.Model.LFO=e}),e(function(t){var e=function(e,i){(i<0||i>3)&&t.warn("Synth: Invalid noise algorithm: "+i);var n=e||65536,s=t.context.createBuffer(1,n,t.context.sampleRate),o=s.getChannelData(0);i||(i=0);for(var r=0;r<n;r++)switch(i){case 0:o[r]=2*Math.random()-1;break;case 1:o[r]=Math.random();break;case 2:o[r]=Math.random()-1;break;case 3:o[r]=r/n}return s};t.engines.webAudio.Util.generateNoiseBuffer=e}),e(function(t){
var e=t.engines.webAudio.Util,i=function(){function e(e,i,n,s,o){this.filterStartFreq=-1,this._filterEnabled=!0,this.voiceType=i,this.active=!1,this.activatedNote=-1,this._enabled=!0,this._detune=e.detune||0,this._wave=e.wave||"sine",this._frames=e.frames,this._algorithm=e.algorithm,o&&(this._noiseBuffer=o),this.gain=t.context.createGain(),n||(n={frequency:22050,Q:1,filter_type:"lowpass"},this.filterEnabled=!1),this._filterData=n}return e.prototype.noteOn=function(e,i,n,s,o,r,a){if(this.enabled){if("noise"!==this._wave?(this.source=t.context.createOscillator(),this.source.type=this._wave,this.source.detune.value=this._detune):"noise"==this._wave&&(this.source=t.context.createBufferSource(),this.source.buffer=this._noiseBuffer,this.source.loop=!0),this._envelope=t.context.createGain(),this._filterData?(this.filter=t.context.createBiquadFilter(),this.filter.type=t.Util.safeFilterType(this._filterData.filter_type),this.filter.frequency.value=void 0===this._filterData.frequency?t.Util.NYQUIST_FREQUENCY:this._filterData.frequency,this.filter.detune&&(this.filter.detune.value=this._filterData.detune||0),this.filter.Q.value=this._filterData.Q||this.filter.Q.value,this.filter.gain.value=this._filterData.gain||this.filter.gain.value,this.filterTargetFreq=this.filter.frequency.value,this.source.connect(this.filter),this.filter.connect(this._envelope),this._envelope.connect(this.gain)):(this.source.connect(this._envelope),this._envelope.connect(this.gain)),1==this.voiceType&&this.filterAmplitudeGainNode.connect(this.filter.frequency),n<t.Util.now()&&(n=t.Util.now()),this.active=!0,this.activatedNote=e,"noise"!==this._wave){var u=t.Util.midiNoteToFrequency(e+a);if(r){var c=-1;r.contour>0?c=u*(1-r.contour):r.contour<0&&(c=(t.Util.NYQUIST_FREQUENCY-u)*-r.contour+u),this.source.frequency.cancelScheduledValues(n),c!=-1?(this.source.frequency.setValueAtTime(c,n),t.safari?this.source.frequency.setTargetValueAtTime(u,n,r.decay):this.source.frequency.setTargetAtTime(u,n,r.decay)):this.source.frequency.setValueAtTime(u,n)}else this.source.frequency.setValueAtTime(u,n)}o&&(this.filterStartFreq=-1,o.contour<0?this.filterStartFreq=this.filterTargetFreq*(1+o.contour)+1:o.contour>0&&(this.filterStartFreq=(t.Util.NYQUIST_FREQUENCY-this.filterTargetFreq)*o.contour+this.filterTargetFreq),this.filterStartFreq!=-1&&(this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(this.filterStartFreq,n+1e-4),this.filter.frequency.exponentialRampToValueAtTime(this.filterTargetFreq,n+o.attack),t.safari?this.filter.frequency.setTargetValueAtTime(this.filterTargetFreq*o.sustain,n+o.attack,o.decay):this.filter.frequency.setTargetAtTime(this.filterTargetFreq*o.sustain,n+o.attack+1e-4,o.decay)));var h;h="linear"===s.volumeCurve?i/128:"exponential"===s.volumeCurve?Math.abs(1-Math.exp(i/128)):1,s?(this.gain.gain.cancelScheduledValues(n),this._envelope.gain.setValueAtTime(0,n),this._envelope.gain.linearRampToValueAtTime(h,n+s.attack),t.safari?this._envelope.gain.setTargetValueAtTime(h*s.sustain,n+s.attack,s.decay):this._envelope.gain.setTargetAtTime(h*s.sustain,n+s.attack+1e-4,s.decay)):this._envelope.gain.setValueAtTime(h,n),this.source.startTime=n,t.safari?this.source.noteOn(n):this.source.start(n)}},e.prototype.noteOff=function(e,i,n,s){this.enabled&&(i<t.Util.now()&&(i=t.Util.now()),this.active=!1,s&&this.filterStartFreq!=-1&&(this.filter.frequency.cancelScheduledValues(i),i!=t.Util.now()?this.filter.frequency.setTargetAtTime(this.filterTargetFreq*s.sustain,i,.1):this.filter.frequency.setValueAtTime(this.filter.frequency.value,i),t.safari?this.filter.frequency.setTargetValueAtTime(this.filterStartFreq,i,s.release):this.filter.frequency.setTargetAtTime(this.filterStartFreq,i,s.release)),n?(this._envelope.gain.cancelScheduledValues(i),i!=t.Util.now()?this._envelope.gain.setTargetAtTime(n.sustain,i,.1):this._envelope.gain.setValueAtTime(this._envelope.gain.value,i),t.safari?this._envelope.gain.setTargetValueAtTime(0,i,n.release):this._envelope.gain.setTargetAtTime(0,i,n.release)):this._envelope.gain.setValueAtTime(0,i),this.source.offTime=i,t.safari?this.source.noteOff(i+5*n.release):this.source.stop(i+5*n.release))},e.prototype.stop=function(){this.filter.frequency.cancelScheduledValues(0),this._envelope.gain.cancelScheduledValues(0),this._envelope.gain.setValueAtTime(0,0),t.safari?this.source.noteOff(0):this.source.stop(0),this.source.disconnect(),this.filter&&this.filter.disconnect(),this._envelope&&this._envelope.disconnect()},e.prototype.stopSoft=function(e,i,n){this.active=!1,this._envelope.gain.cancelScheduledValues(e),t.safari?this._envelope.gain.setTargetValueAtTime(0,e,i.release):this._envelope.gain.setTargetAtTime(0,e,i.release);var s=e+5*i.release;t.safari?this.source.noteOff(s):this.source.stop(s);var o=this;setTimeout(function(){o.source.disconnect(),o.filter&&o.filter.disconnect(),o._envelope&&o._envelope.disconnect()},1e3*(s-t.Util.now()))},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterEnabled",{get:function(){return this._filterEnabled},set:function(t){this._filterEnabled=t,this.source&&(t?(this.source.disconnect(),this.source.connect(this.filter),this.filter.connect(this._envelope)):(this.source.disconnect(),this.filter.disconnect(),this.source.connect(this._envelope)))},enumerable:!0,configurable:!0}),e}(),n=function(){function n(i,n,s,o){this._enabled=!0,this.nextVoice=0,this.octave=i.octave||0,this.output=t.context.createGain(),this.output.gain.value=void 0===i.volume?1:i.volume,this._data=i,this._poly=n,this._filterData=s,this.voices=[],this._noiseBuffer=e.generateNoiseBuffer(this._data._frames,this._data._algorithm)}return n.prototype.noteOn=function(t,e,n,s,o,r,a){if(this.enabled){this.voices.length==this._poly&&(this.voices[0].noteOff(t,n,s,o),this.voices.splice(0,1)),t+=12*this.octave;var u;u="noise"==this._data.wave?new i(this._data,0,this._filterData,n,this._noiseBuffer):new i(this._data,0,this._filterData,n,null),u.gain.connect(this.output),u.noteOn(t,e,n,s,o,r,a),this.lfoPitchGainNode&&"noise"!=this._data.wave&&this.lfoPitchGainNode.connect(u.source.frequency),this.filterAmplitude&&u.filter&&this.filterAmplitude.connect(u.filter.frequency),this.voices.push(u)}},n.prototype.noteOff=function(t,e,i,n){if(this.enabled){t+=12*this.octave;for(var s=0;s<this.voices.length;s++)if(this.voices[s].active&&this.voices[s].activatedNote==t){this.voices[s].noteOff(t,e,i,n),this.voices.splice(s,1);break}}},n.prototype.stopSoft=function(t,e,i){for(var n=0;n<this.voices.length;n++)this.voices[n].stopSoft(t,e,i);this.voices=[]},n.prototype.stop=function(){for(var t=0,e=this.voices.length;t<e;t++)this.voices[t].stop();this.voices=[]},n.prototype.deschedule=function(){for(var e=0,i=this.voices.length;e<i;e++)if(this.voices[e]){var n=this.voices[e].source;(1==n.playbackState||n.startTime>t.context.currentTime)&&(this.voices[e].stop(),this.voices.splice(e,1),e--)}},n.prototype.setDetune=function(t,e){if(this._data){this._data.detune=t;for(var i=0,n=this.voices.length;i<n;i++)this.voices[i].source.detune.setValueAtTime(t,e)}},Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"detune",{get:function(){return this._detune},enumerable:!0,configurable:!0}),n}(),s=function(){function e(e,i){this.osc=t.context.createOscillator(),this.phaseDelay=t.context.createDelay(),this.osc.type=e.wave||"sine",this.osc.frequency.value=e.rate||1,this.phase=e.phase||0,this.phaseDelay.delayTime.value=this.phase*(1/this.osc.frequency.value),this.sync=e.sync,this.syncResolution=e.rate,this.osc.connect(this.phaseDelay),this.oscVolumeAmplitude=t.context.createGain(),this.oscVolumeAmplitude.gain.value=e.osc_volume_amount,this.phaseDelay.connect(this.oscVolumeAmplitude),this.pitchAmplitude=t.context.createGain(),this.pitchAmplitude.gain.value=e.pitch_amount,this.phaseDelay.connect(this.pitchAmplitude),this.filterAmplitude=t.context.createGain(),this.filterAmplitude.gain.value=e.filter_amount,this.phaseDelay.connect(this.filterAmplitude),t.safari?this.osc.noteOn(i):this.osc.start(i)}return e.prototype.updateSync=function(t){return this.osc.frequency.value=t/60/this.syncResolution,this.phaseDelay.delayTime.value=this.phase*(1/this.osc.frequency.value),this},e}(),o=function(e){function i(i,o){e.call(this,i,o),this.bendRange=400;var r=t.context.currentTime+t.Util.OSC_START_DELAY;this._gainEG=i.gain_eg,this._filterEG=i.filter_eg,this._pitchEG=i.pitch_eg;var a=0;i.oscillators[0]||(i.oscillators.push({wave:"sine",detune:0,volume:1,octave:0}),a++),i.oscillators[1]||(i.oscillators.push({wave:"sine",detune:0,volume:1,octave:0}),a++),this._oscs=[],this._poly=i.poly;for(var u=0,c=i.oscillators.length;u<c;u++){var h=new n(i.oscillators[u],i.poly,i.filter,r);h.output.connect(this.output),this._oscs.push(h)}if(1==a?this._oscs[1].enabled=!1:2==a&&(this._oscs[0].enabled=!1,this._oscs[1].enabled=!1),i.LFO){this._LFO=new s(i.LFO,r);for(var u=0,c=this._oscs.length;u<c;u++){var l=this._oscs[u];this._LFO.oscVolumeAmplitude&&this._LFO.oscVolumeAmplitude.connect(l.output.gain),this._LFO.pitchAmplitude&&(l.lfoPitchGainNode=this._LFO.pitchAmplitude),this._LFO.filterAmplitude&&(l.filterAmplitude=this._LFO.filterAmplitude)}this._LFO.sync&&t.core.Core.instance.pushToPreLoadInitStack(this)}this._sync&&t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){if(this._LFO&&this._LFO.sync){var e=t.core.Core.instance.findInstance(this._LFO.sync);this._LFO.updateSync(e.bpm),e.registerBPMSync(this._LFO)}if(this._sync){var e=t.core.Core.instance.findInstance(this._sync);e.registerSynth(this),e.started||e.start()}},i.prototype.handleMidiEvent=function(e,i,n,s){if(i=i||t.context.currentTime,s=s||!1,n=n||0,"channel"==e.type)if("noteOn"==e.subtype){if("off"!=this._arpMode&&!s)return this._activeVoices.push({midiEvent:e,transpose:n}),void this.handleArpModes(e);for(var o=0,r=this._oscs.length;o<r;o++)this._oscs[o].noteOn(e.noteNumber,e.velocity,i,this._gainEG,this._filterEG,this._pitchEG,n)}else if("noteOff"==e.subtype){if("off"!=this._arpMode&&!s){for(var a=0;a<this._activeVoices.length;a++)e.noteNumber===this._activeVoices[a].midiEvent.noteNumber&&this._activeVoices.splice(a,1);return void this.handleArpModes(e)}for(var o=0,r=this._oscs.length;o<r;o++)this._oscs[o].noteOff(e.noteNumber,i,this._gainEG,this._filterEG)}else if("pitchBend"==e.subtype){var u;void 0!==e.value?u=e.value:void 0!==e.velocity&&(u=e.velocity);for(var c=(u-8192)/16384*this.bendRange,a=0;a<this._oscs.length;a++)this._oscs[a].setDetune(c,i)}return this},i.prototype.glideTo=function(e,i,n,s){var o=t.Util.now();i=i||o,void 0===n&&(n=.5),s=s||0;for(var r=0,a=this._oscs.length;r<a;r++)for(var u=this._oscs[r],c=Math.min(e.length,u.voices.length),h=0;h<c;h++){var l=u.voices[h],p=t.Util.midiNoteToFrequency(e[h]+s+12*u.octave);l.source.frequency&&l.source.frequency.linearRampToValueAtTime(p,i+n)}return this},i.prototype.stop=function(e){e=e||t.Util.now();for(var i=0,n=this._oscs.length;i<n;i++)this._oscs[i].stopSoft(e,this._gainEG,this._filterEG);this._activeVoices.length&&(this._activeVoices=[]),this._arpVoices=[]},i.prototype.deschedule=function(){for(var t=0,e=this._oscs.length;t<e;t++)this._oscs[t].deschedule();return this},Object.defineProperty(i.prototype,"filterFrequency",{set:function(t){for(var e=0,i=this._oscs.length;e<i;e++){var n=this._oscs[e];n._filterData.frequency=t;for(var s=0,o=n.voices.length;s<o;s++){var r=n.voices[s];r.filterTargetFreq=t,this._filterEG&&0!=this._filterEG.contour||(r.filter.frequency.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterQ",{set:function(t){for(var e=0,i=this._oscs.length;e<i;e++){var n=this._oscs[e];n._filterData.Q=t;for(var s=0,o=n.voices.length;s<o;s++){var r=n.voices[s];r.filterTargetFreq=t,this._filterEG&&0!=this._filterEG.contour||(r.filter.Q.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterType",{set:function(t){for(var e=0,i=this._oscs.length;e<i;e++){var n=this._oscs[e];n._filterData.filter_type=t;for(var s=0,o=n.voices.length;s<o;s++){n.voices[s].filter.type=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Wave",{set:function(t){var e=this._oscs[0];e._data.wave=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.type&&"4"!==t&&(s.source.type=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Vol",{set:function(t){this._oscs[0].output.gain.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Detune",{set:function(t){var e=this._oscs[0];e._detune=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.detune&&(s.source.detune.value=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Octave",{set:function(t){this._oscs[0].octave=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Wave",{set:function(t){if(!(this._oscs.length<2)){var e=this._oscs[1];e._data.wave=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.type&&"4"!==t&&(s.source.type=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Vol",{set:function(t){if(!(this._oscs.length<2)){this._oscs[1].output.gain.value=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Detune",{set:function(t){if(!(this._oscs.length<2)){var e=this._oscs[1];e._detune=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.detune&&(s.source.detune.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Octave",{set:function(t){if(!(this._oscs.length<2)){this._oscs[1].octave=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchDecay",{set:function(t){this._pitchEG&&(this._pitchEG.decay=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchContour",{set:function(t){this._pitchEG&&(this._pitchEG.contour=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoWave",{set:function(t){this._LFO&&(this._LFO.osc.type=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoRate",{set:function(t){this._LFO&&(this._LFO.osc.frequency.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoPhase",{set:function(t){this._LFO&&(this._LFO.phase=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoOscVol",{set:function(t){this._LFO&&(this._LFO.oscVolumeAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoPitch",{set:function(t){this._LFO&&(this._LFO.pitchAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoFilter",{set:function(t){this._LFO&&(this._LFO.filterAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"arpMode",{set:function(t){this._arpMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"arpOctaves",{set:function(t){this._octaves=t},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){e.prototype.setData.call(this,t),this._poly=t.poly,this._gainEG=t.gain_eg?t.gain_eg:void 0,this._filterEG=t.filter_eg?t.filter_eg:void 0,this._pitchEG=t.pitch_eg?t.pitch_eg:void 0,this._oscs[0].enabled=!!t.oscillators[0],this._oscs[1].enabled=!!t.oscillators[1];for(var i=0,n=this._oscs.length;i<n;i++){var s=this._oscs[i];s._data=t.oscillators[i],s._filterData=t.filter,s._poly=this._poly;for(var o=0,r=s.voices.length;o<r;o++){var a=s.voices[o];t.filter?(a.filterEnabled||(a.filterEnabled=!0),this._filterEG&&0!=this._filterEG.contour||(a.filter.frequency.value=t.filter.frequency),a.filter.Q.value=t.filter.Q,a.filterTargetFreq=t.filter.frequency,a.filter.type=t.filter.filter_type):a.filterEnabled&&(a.filterEnabled=!1),t.oscillators&&t.oscillators[i]&&0==a.voiceType&&(a.source.type&&4!==t.oscillators[0].wave&&(a.source.type=t.oscillators[i].wave),a.source.detune&&(a.source.detune.value=t.oscillators[i].detune))}t.oscillators[i]&&(s.output.gain.value=t.oscillators[i].volume,s.octave=t.oscillators[i].octave)}t.LFO?(this._LFO.osc.type=t.LFO.wave,this._LFO.osc.frequency.value=t.LFO.rate,this._LFO.phase=t.LFO.phase,this._LFO.phaseDelay.delayTime.value=t.LFO.phase*(1/this._LFO.osc.frequency.value),this._LFO.oscVolumeAmplitude.gain.value=t.LFO.osc_volume_amount,this._LFO.pitchAmplitude.gain.value=t.LFO.pitch_amount,this._LFO.filterAmplitude.gain.value=t.LFO.filter_amount):(this._LFO.oscVolumeAmplitude.gain.value=0,this._LFO.pitchAmplitude.gain.value=0,this._LFO.filterAmplitude.gain.value=0)},i}(t.Model.Synth);return t.Model.Symple=o}),e(function(t){var e=(t.engines.webAudio.Util,function(e){function i(i,n){e.call(this,i,n);t.context.currentTime,t.Util.OSC_START_DELAY;this._gainEG=i.gain_eg,this._pitchEG=i.pitch_eg,this._osc=null,this._sync&&t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){if(this._sync){var e=t.core.Core.instance.findInstance(this._sync);e.registerSynth(this),e.started||e.start()}},i.prototype.trigger=function(e){var i={noteNumber:e,when:t.context.currentTime};this.noteOn(i.noteNumber,i.when),this.noteOff(i.noteNumber,i.when)},i.prototype.noteOn=function(e,i,n,s){n=Math.max(n||0,t.context.currentTime),s=s||0,this._osc||(this._osc=t.context.createOscillator(),this._oscGain=t.context.createGain(),this._osc.connect(this._oscGain),this._oscGain.connect(this.output),this._osc.start(n),this._oscGain.gain.value=0,this._osc.type=this.data.oscillators[0].wave);var o=t.Util.midiNoteToFrequency(e+s+12*this.data.oscillators[0].octave),r=this._oscGain.gain.value,a=this._osc.frequency.value;this._oscGain.gain.cancelScheduledValues(n),this._osc.frequency.cancelScheduledValues(n),this._osc.frequency.setValueAtTime(a,n),this._oscGain.gain.setValueAtTime(r,n),this._oscGain.gain.linearRampToValueAtTime(0,n+.02),this._osc.frequency.linearRampToValueAtTime(o,n+.02),this.smoothingTime=.02;var u=.02+this._gainEG.attack+.01;this._oscGain.gain.linearRampToValueAtTime(1,n+u);var c=u+this._gainEG.decay;return this._oscGain.gain.linearRampToValueAtTime(this._gainEG.sustain,n+c),this._adEndTime=n+c,this},i.prototype.noteOff=function(t,e){e=Math.max(e||0,this._adEndTime+1e-4);var i=this.smoothingTime+this._gainEG.attack+.01,n=i+this.smoothingTime+this._gainEG.release;this._oscGain.gain.linearRampToValueAtTime(0,e+n)},i.prototype.handleMidiEvent=function(e,i,n,s){if(i=i||t.context.currentTime,n=n||0,"channel"==e.type)if("noteOn"==e.subtype)this.noteOn(e.noteNumber,e.velocity,i,n);else if("noteOff"==e.subtype)this.noteOff(e.noteNumber,i,this._gainEG);else if("pitchBend"==e.subtype){var o;void 0!==e.value?o=e.value:void 0!==e.velocity&&(o=e.velocity);for(var r=(o-8192)/16384*this.bendRange,a=0;a<this._oscs.length;a++)this._oscs[a].setDetune(r,i)}return this},i.prototype.glideTo=function(e,i,n,s){var o=t.Util.now();i=i||o,void 0===n&&(n=.5),s=s||0;for(var r=0,a=this._oscs.length;r<a;r++)for(var u=this._oscs[r],c=Math.min(e.length,u.voices.length),h=0;h<c;h++){var l=u.voices[h],p=t.Util.midiNoteToFrequency(e[h]+s+12*u.octave);l.source.frequency&&l.source.frequency.linearRampToValueAtTime(p,i+n)}return this},i.prototype.stop=function(e){e=e||t.Util.now(),this._osc.stop(),this._osc.disconnect(),this._oscGain.disconnect(),this._osc=null},i.prototype.deschedule=function(){},Object.defineProperty(i.prototype,"osc1Wave",{set:function(t){var e=this._oscs[0];e._data.wave=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.type&&"4"!==t&&(s.source.type=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Vol",{set:function(t){this._oscs[0].output.gain.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Detune",{set:function(t){var e=this._oscs[0];e._detune=t;for(var i=0,n=e.voices.length;i<n;i++){var s=e.voices[i];s.source.detune&&(s.source.detune.value=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Octave",{set:function(t){this._oscs[0].octave=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchDecay",{set:function(t){this._pitchEG&&(this._pitchEG.decay=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchContour",{set:function(t){this._pitchEG&&(this._pitchEG.contour=t)},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){e.prototype.setData.call(this,t),this._poly=t.poly,this._gainEG=t.gain_eg?t.gain_eg:void 0,this._pitchEG=t.pitch_eg?t.pitch_eg:void 0,this._osc&&(this._osc.type=t.oscillators[0].wave)},i}(t.Model.Synth));return t.Model.MonoSynth=e}),e(function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._content=[],this._playingVoices=[],this._allVoices=[],this._hasNoteOffSamples=!1,this._hasSustainOnSamples=!1,this._hasSustainOffSamples=!1,this._useEnvelope=!0,this._pitchBendRange=.25,this._pedalOnTime=-1,this._sustained=[],this._maxNotes=20,this._stopFactor=5,this._content=t.Util.cloneObject(i.content),this._volumeCurve=i.volume_curve||"none",this._gainEG=i.eg_gain||{attack:0,decay:0,sustain:1,release:.005},this._currentPitch=1,t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(i,e),i.prototype.init=function(){this._envelope=t.context.createGain();for(var e=0,i=this._content.length;e<i;e++){"noteOff"===this._content[e].value&&(this._hasNoteOffSamples=!0),"sustainOn"===this._content[e].value&&(this._hasSustainOnSamples=!0),"sustainOff"===this._content[e].value&&(this._hasSustainOffSamples=!0);for(var n=0;n<this._content[e].samples.length;n++)this._content[e].samples[n].source=t.core.Core.instance.findInstance(this._content[e].samples[n].source),this._content[e].samples[n].source||t.warn("SamplePlayer: audio source not found"),this._content[e].samples[n].source._parentType="SamplePlayer",this._content[e].samples[n].source.loop&&(this._loopedSamples=!0)}if(this._sync){var s=t.core.Core.instance.findInstance(this._sync);s.registerSynth(this),s.started}},i.prototype.handleMidiEvent=function(e,i,n,s,o){if(i=i||t.Util.now(),s=s||!1,n=n||0,"channel"==e.type)if("noteOn"==e.subtype){if("off"!=this._arpMode&&!s)return this._activeVoices.push({midiEvent:e,transpose:n}),void this.handleArpModes(e);this.noteOn(i,e.noteNumber,n,e.velocity,e.subtype,!1,o),this._callback&&this._callback(e,i)}else if("noteOff"==e.subtype){if("off"!=this._arpMode&&!s){for(var r=0;r<this._activeVoices.length;r++)e.noteNumber===this._activeVoices[r].midiEvent.noteNumber&&this._activeVoices.splice(r,1);return void this.handleArpModes(e)}this.noteOff(i,e.noteNumber,e.velocity,e.subtype),this._callback&&this._callback(e,i)}else if("pitchBend"==e.subtype){var a=e.value;this._currentPitch=1+(a-64)/127;for(var r=0;r<this._playingVoices.length;r++)this._playingVoices[r].source.playbackRateNode.setValueAtTime(this._currentPitch,i)}else if("controller"==e.subtype){var u=e.controllerType||e.noteNumber,c=void 0===e.value?e.velocity:e.value;switch(u){case 1:break;case 64:c<64?(this.pedalRelease(i),i>this._pedalOnTime&&(this._pedalOnTime=-1),this._hasSustainOffSamples&&this.noteOn(i,0,0,127,"sustainOff")):c>64&&(this._pedalOnTime=i,this._hasSustainOnSamples&&this.noteOn(i,0,0,127,"sustainOn"))}}return this},i.prototype.noteOn=function(e,i,n,s,o,r,a){for(var u=0;u<this._allVoices.length;u++){var c=this._allVoices[u];0!=c.source._sources.length&&3!=c.source.lastSource.playbackState||(this._allVoices.splice(u,1),u--)}var h=this.getNote(i+n,s,o),l=t.Util.midiNoteToFrequency(i+n),p=t.Util.midiNoteToFrequency(h.root),_=l/p;h.root===-1&&(_=1);var d=new t.Model.AudioSource(h.source.data,i.toString());if("noteOn"===o){var f={source:d,time:e,velocity:s,note:i,transpose:n};this._playingVoices.push(f),this._allVoices.push(f)}a?d.connect(a.input):this.destinationName?d.connect(t.core.Core.instance.findInstance(this.destinationName).input):d.connect(t.core.Core.instance.findInstance(d.destinationName).input),e=e<t.Util.now()?t.Util.now():e;var g=0;if(r?g=r*s/128:"linear"===this._volumeCurve?g=s/128:"exponential"===this._volumeCurve?g=Math.abs(1-Math.exp(s/128)):"none"===this._volumeCurve&&(g=1),g*=d.output.gain.value,d.output.gain.cancelScheduledValues(e),d.nextPlaybackRate=_*this._currentPitch,d.play(e),this._useEnvelope){var y=Math.max(e+1e-4,e+this._gainEG.attack);d.output.gain.setValueAtTime(0,e),d.output.gain.linearRampToValueAtTime(g,y),d.output.gain.setTargetAtTime?d.output.gain.setTargetAtTime(g*this._gainEG.sustain,y,this._gainEG.decay||.01):d.output.gain.setTargetValueAtTime&&d.output.gain.setTargetValueAtTime(g*this._gainEG.sustain,y,this._gainEG.decay)}else d.output.gain.setValueAtTime(g,e),d.output.gain.value=g},i.prototype.adsr=function(t,e,i,n){var s=this._gainEG;return 0===arguments.length?{attack:s.attack,decay:s.decay,sustain:s.sustain,release:s.release}:(s.attack=void 0===arguments[0]?s.attack:arguments[0],s.decay=void 0===arguments[1]?s.decay:arguments[1],s.sustain=void 0===arguments[2]?s.sustain:arguments[2],s.release=void 0===arguments[3]?s.release:arguments[3],this)},i.prototype.noteOff=function(e,i,n,s){for(var o=(this.getNote(i,n,"noteOn"),0);o<this._playingVoices.length;o++)if(!i||i.toString()===this._playingVoices[o].source._name)if(e>this._pedalOnTime&&this._pedalOnTime>0)this._sustained.length>this._maxNotes&&(this._sustained[0].source.stop(e+this._gainEG.release*this._stopFactor),this._sustained.splice(0,1)),this._sustained.push(this._playingVoices[o]),this._playingVoices.splice(o,1);else{if(e<t.Util.now()&&(e=t.Util.now()),this._useEnvelope){var r=this._playingVoices[o].source.output.gain.value;this._playingVoices[o].source.output.gain.cancelScheduledValues(e),e!=t.Util.now()||"Firefox"==t.detector.browser.name?this._playingVoices[o].source.output.gain.setValueAtTime(this._gainEG.sustain,e):this._playingVoices[o].source.output.gain.setValueAtTime(r,e),this._playingVoices[o].source.stop(e+this._gainEG.release*this._stopFactor),this._playingVoices[o].source.output.gain.setTargetAtTime(0,e,this._gainEG.release)}else this._playingVoices[o].source.fadeOutAndStop(this._gainEG.release,e);if(this._hasNoteOffSamples){var a=t.Util.now()-this._playingVoices[o].time,u=Math.min(Math.exp(-a)/3,1);this.noteOn(e,i,this._playingVoices[o].transpose,this._playingVoices[o].velocity,s,u)}this._playingVoices.splice(o,1)}},i.prototype.stop=function(e){var e=e||t.Util.now();this.pedalRelease(e);for(var i=0;i<this._playingVoices.length;i++){e<t.Util.now()&&(e=t.Util.now());var n=this._playingVoices[i].source.output.gain.value;this._playingVoices[i].source.output.gain.cancelScheduledValues(e),this._playingVoices[i].source.output.gain.setValueAtTime(n,e),this._playingVoices[i].source.stop(e+this._gainEG.release*this._stopFactor),this._playingVoices[i].source.output.gain.setTargetAtTime(0,e,this._gainEG.release)}return this._playingVoices=[],this._arpVoices=[],this},i.prototype.deschedule=function(){for(var t=0;t<this._allVoices.length;t++)this._allVoices[t].source.deschedule();return this},i.prototype.pedalRelease=function(e){for(var i=0;i<this._sustained.length;i++)if(e<t.Util.now()&&(e=t.Util.now()),"Firefox"!=t.detector.browser.name){if(this._sustained[i].source.output.gain.setTargetAtTime(0,e,this._gainEG.release),this._hasNoteOffSamples){var n=t.Util.now()-this._sustained[i].time,s=Math.min(Math.exp(-n)/3,1);this.noteOn(e,this._sustained[i].note,this._sustained[i].transpose,this._sustained[i].velocity,"noteOff",s)}}else this._sustained[i].source.output.gain.linearRampToValueAtTime(0,e+.3),this._sustained[i].source.stop(e+this._gainEG.release*this._stopFactor);this._sustained=[]},i.prototype.getNote=function(t,e,i){var n=0;for(this._content[n].value;e>this._content[n].highVelocity||i!==this._content[n].value;)n++;for(var s=n,o=0;t<this._content[s].samples[o].startRange||t>this._content[s].samples[o].endRange;)o++;return this._content[s].samples[o]},Object.defineProperty(i.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t,this.init()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"callbackFunction",{set:function(t){this._callback=t},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){e.prototype.setData.call(this,t),t.eg_gain&&(this._gainEG=t.eg_gain),t.content&&(this._content=t.content,this.init()),t.volumeCurve&&(this._volumeCurve=t.volumeCurve)},i}(t.Model.Synth);return t.Model.SamplePlayer=e}),e(function(t){!function(t){t._map=[],t._map[0]="Restart",t.Restart=0,t._map[1]="Playing",t.Playing=1,t._map[2]="All",t.All=2,t._map[3]="Continue",t.Continue=3}(t.Model.SyncType||(t.Model.SyncType={}))}),e(function(t){var e=t.Model.SyncType,i=function(i){function n(e,n){i.call(this),this._scheduler=null,this._started=!1,this._bpm=120,this._barLength=4,this._beatLength=1,this._resolution=.25,this._currentStep=0,this._paused=!1,this._maxSwing=.08,this._swingFactor=0,this._lastBeat=-1,this._name=n,this._type=e.type,this._bpm=e.bpm||120,this._barLength=e.bar_length||4,this._beatLength=e.beat_length||1,this._registeredPatterns=[],this._registeredSynths=[],this._syncHandler=new t.core.SyncHandler,this._syncedObjects=[],this._swingFactor=e.swing_factor||0,t.core.Core.instance.pushToPreLoadInitStack(this)}return t.Util.__extends(n,i),n.prototype.init=function(){this._lookahead=t.core.Core.settings.sequencer_lookahead||50,this._scheduleAheadTime=t.core.Core.settings.sequencer_schedule_ahead||.2,t.isIOS&&(this._scheduleAheadTime=t.core.Core.settings.sequencer_schedule_ahead_ios||5),this._resolution=t.core.Core.settings.sequencer_resolution||.25},n.prototype.startScheduler=function(){if(!this._paused&&0!==t.context.currentTime)for(this._lastScheduleLoopTime=t.context.currentTime;this._scheduleTime<t.context.currentTime+this._scheduleAheadTime;){for(var e=0,i=this._registeredPatterns.length;e<i;e++)this._registeredPatterns[e].update(this._currentStep,this._scheduleTime);for(var n=0,i=this._registeredSynths.length;n<i;n++)this._registeredSynths[n].update(this._currentStep,this._scheduleTime);var s=this.currentStep,o=Math.floor(s);o!==this._lastBeat&&this.trigger("beforeNextBeat",o,this.getBeatTime(0)-this._scheduleTime,this._scheduleTime),this._lastBeat=o,this.trigger("progress",this._currentStep,this.getBeatTime(0)-this._scheduleTime,this._scheduleTime),this._currentStep+=this._resolution,this._syncHandler.update(this._resolution),this._swingFactor>0?4*this._currentStep%2?this._scheduleTime+=(.25+this._maxSwing*this._swingFactor)*(60/this._bpm):this._scheduleTime+=(.25-this._maxSwing*this._swingFactor)*(60/this._bpm):this._scheduleTime+=60/this._bpm*this._resolution}var r=this;this._scheduler=setTimeout(function(){r.startScheduler()},r._lookahead)},n.prototype.start=function(e){return e=e||0,this._started||(this._started=!0,this._scheduleTime=t.context.currentTime+e,this._scheduleAheadTime<=.2&&(this._scheduleTime+=.3),clearTimeout(this._scheduler),this.startScheduler(),t.core.Core.callbacks&&t.core.Core.callbacks.startSequencer&&t.core.Core.callbacks.startSequencer({name:this._name}),this.trigger("start")),this},n.prototype.pause=function(){this._paused=!0,this._pauseOffset=this._scheduleTime-t.Util.now();for(var e=0,i=this._registeredPatterns.length;e<i;e++)this._registeredPatterns[e].pause();return this.trigger("pause"),this},n.prototype.unpause=function(){this._paused=!1,this._scheduleTime=t.Util.now()+this._pauseOffset;for(var e=0,i=this._registeredPatterns.length;e<i;e++)this._registeredPatterns[e].unpause();return this},n.prototype.reschedule=function(){clearTimeout(this._scheduler);var e=this._scheduleTime-t.context.currentTime,i=this.getNoteTime(this._resolution),n=e>this._scheduleAheadTime?e-this._scheduleAheadTime:e-(this._scheduleAheadTime-i),s=(e-e%i)/i/(this._beatLength/this._resolution),o=this._scheduleAheadTime/i/(this._beatLength/this._resolution);this._scheduleTime=t.context.currentTime+n,
s<o&&(this._scheduleTime-=i),this._currentStep-=o,(isNaN(this._currentStep)||this._currentStep<0)&&(this._currentStep=0);for(var r=0,a=this._registeredPatterns.length;r<a;r++)this._registeredPatterns[r].deschedule(o);return this.startScheduler(),this},n.prototype.stop=function(){return this._started=!1,clearTimeout(this._scheduler),this._scheduler=null,this._started=!1,t.core.Core.callbacks&&t.core.Core.callbacks.stopSequencer&&t.core.Core.callbacks.stopSequencer({name:this._name}),this},n.prototype.stopAll=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];for(var n=void 0!==t.beat?t.beat:4,s=void 0===t.fadeTime?0:t.fadeTime,o=t.forceFade||!1,r=t.wait||0,a=0,u=this._registeredPatterns.length;a<u;a++)e.indexOf(this._registeredPatterns[a])==-1&&(this._registeredPatterns[a].forceFade=o,this._registeredPatterns[a].stop(n,!0,s,r));return this},n.prototype.restart=function(){return this._currentStep=0,this},n.prototype.registerPattern=function(t){return this._registeredPatterns.push(t),this},n.prototype.unregisterPattern=function(t){var e=this._registeredPatterns.indexOf(t);return this._registeredPatterns.splice(e,1),this},n.prototype.registerSynth=function(t){return this._registeredSynths.indexOf(t)==-1&&this._registeredSynths.push(t),this},n.prototype.unregisterSynth=function(t){var e=this._registeredPatterns.indexOf(t);return this._registeredSynths.splice(e,1),this},n.prototype.sync=function(t,e,i){return this.syncInSteps(t,this.getStepsToNext(this.beatLength*e),i)},n.prototype.syncInSteps=function(t,e,i){this._started||this.start();var n=this.getNoteTime(e)+this._scheduleTime;return i?i.length&&i.push(n):i=[n],this._syncHandler.addSyncCountdown(new SyncCountdown(e,t,i)),this},n.prototype.quantizeDuration=function(t,e){var i=this.bpm,n=60/i,s=i/60;return Math.floor(t/n)*s},n.prototype.syncCallback=function(t,e,i,n){n=n||0,i=i||0,e=e||1;var s=this,o=function(r,a,u){r%e===i&&n<=0&&(s.off("beforeNextBeat",o),t(r,u)),n--};this._syncCallbackContext=this._syncCallbackContext||{ctx:this},this.on("beforeNextBeat",o,this._syncCallbackContext)},n.prototype.cancelCallbacks=function(){this._syncCallbackContext&&this.off("beforeNextBeat",null,this._syncCallbackContext)},n.prototype.syncPattern=function(i){for(var n=[],s=0;s<arguments.length-1;s++)n[s]=arguments[s+1];var o,r,a=i.beat||0,u=i.fadeIn||!1,c=i.duration||1,h=void 0!==i.absolute&&i.absolute,l=void 0!==i.syncType?i.syncType:3,p=i.offset,_=i.wait||0;this._started||(this._currentStep=0,this.start(),o=a=0,r=!0);var d,f=!1;if(l===e.Restart)d=0,f=!0;else if(l===e.Playing){for(var g=0,y=-1,m=0,v=n.length;m<v;m++)1===n[m].state&&n[m].length>g&&(g=n[m].length,y=m);var b=0;y>-1&&(b=n[y].getNextBar(a)),d=b*a,b>0&&_>0&&(d+=_)}else if(l===e.All){for(var g=0,y=-1,m=0,v=this._registeredPatterns.length;m<v;m++)1!==this._registeredPatterns[m].state&&2!==this._registeredPatterns[m].state||this._registeredPatterns[m].length>g&&(g=this._registeredPatterns[m].length,y=m);var T=0;y>-1&&(T=this._currentStep+this.getStepsToNext(a)),d=T}else l===e.Continue&&(d=0,f=!!r);0!=h?o="number"==typeof h?this.getStepsToNext(this.beatLength*h)+this.beatLength*a:this.beatLength*a:a>0?o=this.getStepsToNext(this.beatLength*a):0==a&&(o=0),_>0&&(o+=_);for(var m=0,v=n.length;m<v;m++)void 0!==p&&(p=this.getNoteTime(p)),n[m].prePlaySchedule(o,d,f,u,c,p);if(r){var S=this._scheduleTime-t.context.currentTime,P=this.getNoteTime(this._resolution),O=S>this._scheduleAheadTime?S-this._scheduleAheadTime:S-(this._scheduleAheadTime-P);this._scheduleTime=t.context.currentTime+O,this._currentStep=f?n[0]._currentStep-this._resolution:n[0]._currentStep,r=!1}else this._scheduleAheadTime>.5&&this.reschedule();return this},n.prototype.registerBPMSync=function(t){return this._syncedObjects.indexOf(t)==-1&&this._syncedObjects.push(t),this},n.prototype.unregisterBPMSync=function(t){var e=this._syncedObjects.indexOf(t);return e!=-1&&this._syncedObjects.splice(e,1),this},n.prototype.getStepsToNext=function(t){return 0==t?0:t-this._currentStep%t},n.prototype.getNoteTime=function(t){return void 0===t&&(t=1),60/this._bpm*t},n.prototype.getBeatTime=function(t){return this.getNoteTime(this.getStepsToNext(t))+this._scheduleTime},Object.defineProperty(n.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bpm",{get:function(){return this._bpm},set:function(t){this._bpm=t;for(var e=0,i=this._registeredPatterns.length;e<i;e++)"MidiPattern"==this._registeredPatterns[e]._type&&this._registeredPatterns[e].recalculateBPM(this._bpm);for(var e=0,i=this._syncedObjects.length;e<i;e++)this._syncedObjects[e].updateSync(this._bpm)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{set:function(t){for(var e=0,i=this._registeredPatterns.length;e<i;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(this._registeredPatterns[e].scale=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"customScale",{set:function(t){for(var e=0,i=this._registeredPatterns.length;e<i;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(this._registeredPatterns[e].customScale=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"transpose",{set:function(t){for(var e=0,i=this._registeredPatterns.length;e<i;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(0===t?this._registeredPatterns[e].resetTranspose():this._registeredPatterns[e].transpose+=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"resolution",{get:function(){return this._resolution},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"barLength",{get:function(){return this._barLength},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"beatLength",{get:function(){return this._beatLength},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentStep",{get:function(){return this._currentStep},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"swingFactor",{set:function(t){this._swingFactor=t},enumerable:!0,configurable:!0}),n.prototype.setData=function(t){this._bpm=t.bpm||120,this._barLength=t.measure_length||4,this._beatLength=t.beat_length||1,this._swingFactor=t.swing_factor||0},n}(t.core.EventEmitter);return t.Model.Sequencer=i}),e(function(t){var e=function(){function e(e){this._vars=e.vars,t.core.Core.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){for(var e=0,i=this._vars.length;e<i;e++){var n=this._vars[e];this._destination=this._actionData[n]=t.core.Core.instance.findInstance(n)}this._vars=null},e.prototype.start=function(e){t.warn("Process: Invocation of abstract method")},e.prototype.destination=function(){return this._destination},e.prototype.execute=function(e,i,n){if("function"!=typeof e)return this._func&&!n||(this._func=new Function("Core","Model","Util","me","args","vars",e)),this._func(t.core.Core,t.Model,t.Util,this._actionData,i,t.Util.vars);e(t.core.Core,t.Model,t.Util,this._actionData,i,t.Util.vars)},e}();return t.core.Process=e}),e(function(t){var e=function(e){function i(t,i){e.call(this,t),this._name=i,this.data=t,this._type=t.type,this._action=t.action,this._actionData={}}return t.Util.__extends(i,e),i.prototype.start=function(t){this.execute(this._action,t)},i.prototype.setData=function(t){this._action=t.action,this._vars=t.vars,this.init(),this._func=new Function("Core","Model","Util","me","args","vars",this._action)},i}(t.core.Process);t.Model.SimpleProcess=e;var i=function(e){function i(i,n){if(e.call(this,i),this._nextStartTime=0,this._waitOffset=0,this.SCHEDULE_AHEAD_TIME=.2,this._lastTime=0,this._name=n,this._type=i.type,this._preAction=i.pre_action||null,this._actions=i.actions,this._currentAction=0,this._started=!1,this._loop=void 0!==i.loop&&i.loop,this._loopTime=i.loopTime||-1,this._actionData={process:this},this._loop){for(var s=!1,o=0,r=this._actions.length;o<r;o++)if("wait"==this._actions[o].operation){s=!0;break}s||t.warn("Process: Infinite loop found in process '"+this._name+"'")}}return t.Util.__extends(i,e),i.prototype.start=function(e){if(!t.isIOS){if(this._args=e,this._currentAction=0,this._execTime=0,this._startTime=t.context.currentTime,this._nextStartTime=this._startTime,this._preAction)if("exec"==this._preAction.operation)this.execute(this._preAction.script,this._args);else if("wait"==this._preAction.operation)return this._execTime=this.execute(this._preAction.script,this._args),this._waitOffset+=this._execTime,void(this._execTime>=this.SCHEDULE_AHEAD_TIME?t.core.TimeHandler.instance.registerMethodCallback(this,"cont",this._execTime-this.SCHEDULE_AHEAD_TIME/2):this.cont());this._started=!0,this.cont()}},i.prototype.cont=function(){this._actionData.execTime=this._nextStartTime+this._waitOffset;for(var e=this._actions.length;this._currentAction<e;this._currentAction++){if(!this._started)return;var i=this._actions[this._currentAction];if("exec"==i.operation)this.execute(i.script,this._args,!0),this._execTime=0;else if("wait"==i.operation)return this._execTime=this.execute(i.script,this._args,!0),this._waitOffset+=this._execTime,this._execTime>=this.SCHEDULE_AHEAD_TIME?t.core.TimeHandler.instance.registerMethodCallback(this,"cont",this._execTime-this.SCHEDULE_AHEAD_TIME/2):this._waitOffset>this.SCHEDULE_AHEAD_TIME?this.scheduleLoop(this._waitOffset):(this._currentAction++,this.cont()),void this._currentAction++}this._loop&&(this._loopTime>0?this.scheduleLoop(this._loopTime):(this._waitOffset=0,this._currentAction=0,this.cont()))},i.prototype.scheduleLoop=function(e){if(this._started){this._nextStartTime+=e;var i=this._nextStartTime-t.context.currentTime,n=this;setTimeout(function(){n._waitOffset=0,n._currentAction=0,n.cont()},1e3*(i-this.SCHEDULE_AHEAD_TIME/2))}},i.prototype.stop=function(){this._started=!1,t.core.TimeHandler.instance.removeMethodCallback(this,"cont")},Object.defineProperty(i.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),i.prototype.setData=function(t){this._actions=t.actions,this._vars=t.vars,this.init()},i}(t.core.Process);return t.Model.AdvancedProcess=i}),e(function(t){t.engines.webAudio.Util.createAudioContext=function(t){var e=window.AudioContext||window.webkitAudioContext;t="number"==typeof t?t:44100;var i=new e;if(/(iPhone|iPad)/i.test(navigator.userAgent)&&i.sampleRate!==t){var n=i.createBuffer(1,1,t),s=i.createBufferSource();s.buffer=n,s.connect(i.destination),s.start(0),s.disconnect(),i.close(),i=new e}return i}}),e(function(t){}),e(function(t){function e(e,i,n,s){if(this._loadedFiles=0,t.audioTagHandler=this,this._audioFiles={},this._limitSounds=t.isMobile||"Opera"==t.detector.browser.name,"string"==typeof e){var o=this;t.network.request({url:e},function(e){try{o.init(JSON.parse(e),i,n,s)}catch(e){t.engineVersion="n/a",i&&i(!1)}},null,function(e){t.err(e)})}else"object"==typeof e?this.init(e,i,n,s):t.err("Klang exception: unrecognized config type: "+typeof e)}var i=function(){function t(e,i){this._url=e,this.data=i,this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._waitForReadyState=this._waitForReadyState.bind(this),this.state=t.STATE_NOT_LOADED}return t.STATE_NOT_LOADED=0,t.STATE_LOADING=1,t.STATE_LOADED=2,t.prototype._onCanPlayThrough=function(){this.audioElement.removeEventListener("canplaythrough",this._onCanPlayThrough,!1),this._waitForReadyState(function(){this.ready=!0,this.state=this.state=t.STATE_LOADED,this._readyCallback&&this._readyCallback(),this.audioElement.pause()}.bind(this))},t.prototype._waitForReadyState=function(t){var e=this;!function i(){e.audioElement.readyState?t&&t():setTimeout(i,100)}()},t.prototype.load=function(e){if(this.state===t.STATE_NOT_LOADED){this.state=t.STATE_LOADING;var i=this.audioElement=new Audio;i.src=this._url,i.addEventListener("canplaythrough",this._onCanPlayThrough,!1),i.volume=0,i.play()}this._readyCallback=e},t.prototype.clone=function(){var e=new t(this._url,this.data);return e.state=this.state,e.audioElement=new Audio,e.ready=!!this.ready,e.audioElement.src=this._url,e.audioElement.volume=0,e.audioElement.play(),e},t}();t.ATAudioFile=i;var n=function(){function e(t,i){this._xLoopTimer=0,this.state=e.STATE_STOPPED,this._data=t,this._currentFile=i,this._retrig=void 0===t.retrig||t.retrig,this._loopStart=t.loop_start||0,this._loopEnd=t.loop_end||0,this._destination_name=t.destination_name,this._currentFile&&(this._priority=this._currentFile.data.audio_tag,this._loop=!!this._data.loop,this._gain=new o(t.volume,this),this._loop&&(this._files=[this._currentFile,this._currentFile.clone()]),this.beforeEnding=this.beforeEnding.bind(this))}return e.STATE_PLAYING=3,e.STATE_STOPPING=3,e.STATE_STOPPED=4,e.prototype.beforeEnding=function(){if(this._playing&&this._loop){var t=this._currentFile;this._currentFile=t===this._files[0]?this._files[1]:this._files[0],this._currentFile.currentTime=this._loopStart,this._currentFile.audioElement.currentTime=this._loopStart,t.audioElement.pause(),this.update(),this._currentFile.audioElement.play(),clearTimeout(this._xLoopTimer),this._xLoopTimer=setTimeout(this.beforeEnding,1e3*(this._currentFile.audioElement.duration-this._loopStart-(this._loopEnd?this._currentFile.audioElement.duration-this._loopEnd:0)))}},e.prototype.play=function(t,i,n,s,o){if(t=t||0,!this._currentFile.ready)return this;if(this._playing&&!this._retrig&&this.state!==e.STATE_STOPPING)return this;if(t>0){var r=this;this._playTimeout=setTimeout(function(){r.doPlay(i,n,s,o)},1e3*t)}else this.doPlay(i,n,s,o)},e.prototype.doPlay=function(t,i,n,s){return t=t||0,this.state!=e.STATE_STOPPING||this._retrig?(this.update(),this._currentFile.audioElement.currentTime=t,this._currentFile.audioElement.play(),this._playing=!0,this._loop&&(clearTimeout(this._xLoopTimer),this._xLoopTimer=setTimeout(this.beforeEnding,1e3*(this._currentFile.audioElement.duration-t-this._loopStart-(this._loopEnd?this._currentFile.audioElement.duration-this._loopEnd:0)))),this.state=e.STATE_PLAYING,this):(this.getOutput().fadeVolume(this.getOutput().getVolume(),.5),void(this.state=e.STATE_PLAYING))},e.prototype.fadeInAndPlay=function(t,e,i,n){if((i=i||0)>0){var s=this;this._playTimeout=setTimeout(function(){s.doFadeInAndPlay(s.getOutput().getVolume(),e)},1e3*i)}else this.doFadeInAndPlay(this.getOutput().getVolume(),e);return this},e.prototype.doFadeInAndPlay=function(t,i){return this._gain.setVolume(this.state==e.STATE_PLAYING?this._gain.getVolume():0),this.play(0,0,!1,!0),this._gain.fadeVolume(t,i),this},e.prototype.stop=function(t){return this._playTimeout&&clearTimeout(this._playTimeout),this.state=e.STATE_STOPPED,this._currentFile.audioElement.pause(),this._playing=!1,clearTimeout(this._xLoopTimer),this},e.prototype.fadeOutAndStop=function(t,i){if(this.state==e.STATE_PLAYING){this._playTimeout&&clearTimeout(this._playTimeout);var n=this;return this._gain.fadeVolume(0,t,function(){n.state==e.STATE_STOPPING&&n.stop()}),this.state=e.STATE_STOPPING,this}},e.prototype.setVolume=function(e){return e=void 0===e?this.getOutput().getVolume():e*this.getOutput().getVolume(),e=Math.max(0,Math.min(1,e*t.audioTagHandler.getGlobalVolume()*t.audioTagHandler.getFocusBlurVolume())),this._currentFile.audioElement&&isFinite(e)&&(this._currentFile.audioElement.volume=e),this},e.prototype.update=function(){this.setVolume(this._destination.calcVolume())},e.prototype.connect=function(t){this._destination=t,t.addConnected(this),this.update()},e.prototype.getOutput=function(){return this._gain},Object.defineProperty(e.prototype,"position",{get:function(){return this.playing?this._currentFile.audioElement.currentTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!0,configurable:!0}),e}();t.ATAudioSource=n;var s=function(){function e(t,e){this._data=t,this._content=[];for(var i in this._data.content){var n=e.getObject(this._data.content[i]);n&&this._content.push(n)}}return e.prototype.play=function(e,i,n){var s="number"==typeof i?i:t.Util.random(this._content.length-1,0);return this._content[s]&&this._content[s].play(e),this},e.prototype.stop=function(){for(var t in this._content)this._content[t]&&this._content[t].stop();return this},Object.defineProperty(e.prototype,"playing",{get:function(){var t=!1;for(var e in this._content)this._content[e]._playing&&(t=!0);return t},enumerable:!0,configurable:!0}),e.prototype.update=function(){},e.prototype.connect=function(t){},e}();t.ATAudioGroup=s;var o=function(){function t(t,e){this._currentVolume=this._volume=void 0!==t?t:1,this._currentVolume=Math.max(0,Math.min(this._currentVolume,1)),this._owner=e}return t.prototype.getVolume=function(){return this._volume},t.prototype.setVolume=function(t){return t=Math.max(0,Math.min(1,t)),this._currentVolume=t,this._owner&&this._owner.setVolume&&this._owner.setVolume(this._currentVolume),this},t.prototype.fadeVolume=function(t,e,i){this._fadeTimer&&clearInterval(this._fadeTimer);var n=this;return this._fadeSteps=Math.round(1e3*e)/10,this._volumeStep=(this._currentVolume-t)/this._fadeSteps,this._fadeTimer=setInterval(function(){n.setVolume(n._currentVolume-n._volumeStep),--n._fadeSteps<=0&&(clearInterval(n._fadeTimer),i&&i())},10),this},t.prototype.resetVolume=function(t){var e=t?this._currentVolume:this._volume;return clearInterval(this._fadeTimer),this.setVolume(e),this},t}();t.ATGainNode=o;var r=function(){function t(t,e,i){this._isMaster=!1,this._connected=[],this._isMaster=i,this._data=t,this._name=e,this._output=new o(void 0!==t.output_vol?t.output_vol:1,this),this._volume=void 0!==t.output_vol?t.output_vol:1,this._destination_name=t.destination_name}return t.prototype.getVolume=function(){return this._isMaster,this._volume},t.prototype.calcVolume=function(t){return void 0===t&&(t=1),t*=this._volume,this._destination?this._destination.calcVolume(t):t},t.prototype.setVolume=function(t){this._volume=t;for(var e=0;e<this._connected.length;e++)this._connected[e].update()},t.prototype.update=function(){for(var t=0;t<this._connected.length;t++)this._connected[t].update()},t.prototype.getOutput=function(){return this._output},t.prototype.addConnected=function(t){this._connected.push(t)},t.prototype.connect=function(t){this._destination=t,t.addConnected(this)},t}();t.ATBus=r;var a=function(){function e(t,e,i){this._data=t,this._name=e,this._vars=i,"copy"===this._data.at_action&&(this._data.at_action=this._data.action)}return e.prototype.start=function(e){try{"function"==typeof this._data.at_action?this._data.at_action(t.Util,this._vars,e):new Function("Util","me","args",this._data.at_action)(t.Util,this._vars,e)}catch(e){t.err("Klang: error in process '"+this._name+"': "+e.name+": "+e.message)}},e}();return t.ATProcess=a,e.prototype.init=function(e,o,u,c){this._globalVolume=1,this._focusBlurVolume=1,this._readyCallback=o,this._progressCallback=u,this._events=e.events;var h,l=parseInt(e.settings.relative_path),p=e.settings.file_path||"";l&&c.lastIndexOf("/")!=-1?(h=c.substring(0,c.lastIndexOf("/")),"/"!==h.charAt(h.length-1)&&(h+="/"),h+=p):h=p;var _=".mp3";"Firefox"!=t.detector.browser.name&&"Chrome"!=t.detector.browser.name||(_=".ogg");for(var d in e.files){var f=e.files[d],g=f.audio_tag;!g||this._limitSounds&&1!=g||(this._audioFiles[f.id]=new i(h+f.url+_,f))}this._masterBus=e.masterBus,this._busses={};for(var y in e.busses)this._busses[y]=new r(e.busses[y],y,y==this._masterBus);this._audio={};for(var m in e.audio)if(e.audio.hasOwnProperty(m)){var v=e.audio[m];if("AudioSource"==v.type){if(this._audioFiles[v.file_id]){this._audioFiles[v.file_id];this._audio[m]=new n(v,this._audioFiles[v.file_id])}}else"AudioGroup"==v.type&&(this._audio[m]=new s(v,this))}for(var b in this._busses)b!=this._masterBus&&this._busses[b].connect(this._busses[this._busses[b]._destination_name]);for(var T in this._audio)"AudioSource"==this._audio[T]._data.type&&this._audio[T].connect(this._busses[this._audio[T]._destination_name]);this._processes={};for(var d in e.processes){var S=e.processes[d];if(S.at_action){var P={};for(var O in S.vars){var A=S.vars[O];P[A]=this._audio[A]||this._busses[A]}this._processes[d]=new a(S,d,P)}}if(this.loadSoundFiles(["auto","autotag"],o,u),e.settings.blur_fade_time!=-1){this._blurFadeOut=!0;e.settings.blur_fade_time;if(this.getHiddenProp()){document.addEventListener("visibilitychange",this.visChange.bind(this))}}},e.prototype.visChange=function(){this.isHidden()?this._blurFadeOut&&this.setFocusBlurVolume(0):this.setFocusBlurVolume(1)},e.prototype.fadeBusVolume=function(t,e,i){this._busses[t._name].getOutput().fadeVolume(e,i)},e.prototype.isHidden=function(){var t=this.getHiddenProp();return!!t&&document[t]},e.prototype.getHiddenProp=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null},e.prototype.resumeAudio=function(){if(t.isIOS||t.isMobile)for(var e in this._audioFiles)this._audioFiles[e].load()},e.prototype.loadSoundFiles=function(t,e,n,s){e&&(this._readyCallback=e),n&&(this._progressCallback=n),"string"==typeof t&&(t=[t]),this._loadedFiles=0,this._numFiles=0;var o=this;for(var r in this._audioFiles)if(this._audioFiles.hasOwnProperty(r)){var a=this._audioFiles[r],u=a.data.load_group;void 0!==t&&t.indexOf(u)==-1||a.state===i.STATE_NOT_LOADED&&(this._numFiles++,a.load(function(){o.loadProgress()}))}0==this._numFiles&&this._readyCallback&&this._readyCallback(!0)},e.prototype.getLoadGroups=function(){var t,e=this._audioFiles||[],i={},n=[];for(t in e){var s=e[t];i[s.data.load_group]=s.data.load_group}for(t in i)n.push(t);return n},e.prototype.loadProgress=function(){if(this._loadedFiles++,this._progressCallback&&this._progressCallback(this._loadedFiles/this._numFiles*100),this._readyCallback&&this._loadedFiles==this._numFiles){var t=this;setTimeout(function(){t._readyCallback(!0)},200)}},e.prototype.triggerEvent=function(e,i){for(var n="",s=0;s<i.length;s++)n+=i[s]+", ";if("sound_position"!=e){i&&i[0]}if(this._events)try{var o=this._events[e];if("string"==typeof o){var r=this._processes[o];r&&r.start(i)}else if(o)for(var a=0,u=o.length;a<u;a++){var c=o[a],r=this._processes[c];r&&r.start(i)}}catch(i){t.err("Klang: error when triggering event '"+e+"': "+i.name+": "+i.message)}},e.prototype.getFocusBlurVolume=function(){return this._focusBlurVolume},e.prototype.setFocusBlurVolume=function(t){t=Math.max(0,Math.min(t,1)),this._focusBlurVolume=t;for(var e in this._audio){var i=this._audio[e];if(i&&i.setVolume&&i.getOutput()){var n=i.getOutput();n&&i.setVolume(n.getVolume())}}},e.prototype.getGlobalVolume=function(){return this._globalVolume},e.prototype.setGlobalVolume=function(t){t=Math.max(0,Math.min(t,1)),this._globalVolume=t;for(var e in this._audio){var i=this._audio[e];if(i&&i.setVolume&&i.getOutput){var n=i.getOutput();n&&i.setVolume(n.getVolume())}}},e.prototype.fadeGlobalVolume=function(t,e){t=Math.max(0,Math.min(t,1)),this._globalFadeTimer&&clearInterval(this._globalFadeTimer);var i=this,n=Math.round(1e3*e)/10,s=(this._globalVolume-t)/n;this._globalFadeTimer=setInterval(function(){i._globalVolume=i._globalVolume-s,n--;for(var t in i._audio){var e=i._audio[t];e&&e.setVolume&&e.getOutput&&e.setVolume()}n<=0&&clearInterval(i._globalFadeTimer)},10)},e.prototype.getLimitSounds=function(){return this._limitSounds},e.prototype.stopAll=function(t){for(var e in this._audio)void 0!==t&&this._audio[e]._priority!=t||this._audio[e].stop();return this.stopPeriodic(),this},e.prototype.getObject=function(t){return this._audioFiles[t]||this._audio[t]},e.prototype.playPeriodic=function(e,i,n){clearTimeout(this._periodicTimer);var s=this;this._periodicTimer=setTimeout(function(){e.play(),s.playPeriodic(e,i,n)},t.Util.random(1e3*i,1e3*n))},e.prototype.stopPeriodic=function(){clearTimeout(this._periodicTimer)},t.AudioTagHandler=e}),e(function(t){var e=function(){function e(e,i){t.Model.Audio.call(this,e,i),this._startTime=0,this._loopStartTime=0,this._scheduleAhead=.2,this._stopping=!1,this._fading=!1,this._paused=!1,this._pauseTime=-1,this._connected=!1,this._durationTimeout=0,this._pauseStartTime=-1,this.data=e,this.editorName=e.editorName,this._fileId=e.file_id,this._playbackRate=e.playback_rate||1,this._endTime=0,this._loop=void 0!==e.loop&&e.loop,this._loopStart=e.loop_start,this._loopEnd=e.loop_end,this._offset=e.offset||0,this._duration=e.duration||0,this._reverse=e.reverse,this._retrig=void 0===e.retrig||e.retrig,this._lockPlaybackrate=void 0!==e.lock_playback_rate&&e.lock_playback_rate,this._volumeStartRange=e.volume_start_range,this._volumeEndRange=e.volume_end_range,e.panner&&(this._panner=e.panner),t.core.Core.instance.pushToPostLoadInitStack(this)||this.init(),t.core.internalEventBus.on("INIT_IOS",this.initIOS.bind(this))}return t.Util.__extends(e,t.Model.Audio),e.prototype.init=function(){var e,i=this;if(this._audioElement=new Audio,this._mediaElementSource=t.context.createMediaElementSource(this._audioElement),this._mediaElementSource.connect(this._output),this._audioElement.crossOrigin="anonymous",this._fileId){if("string"==typeof this._fileId){var n=t.core.FileHandler.instance.getFileInfo(this._fileId);e=(n.external?"":t.core.FileHandler.instance._baseURL)+n.url}}else e=this.data.url;var s=".mp3";"Firefox"!==t.detector.browser.name&&"Chrome"!==t.detector.browser.name||(s=".ogg"),this._audioElement.src=e+s,this._duration||this._audioElement.addEventListener("loadedmetadata",function t(e){i._duration=i._audioElement.duration,i._audioElement.removeEventListener("loadedmetadata",t,!1)},!1)},e.prototype.setLoopRegion=function(t,e){return this._loopStart=t||this._loopStart,this._loopEnd=e||this._loopEnd,this._audioElement.loopStart=this._loopStart,this._audioElement.loopEnd=this._loopEnd,this},e.prototype.connect=function(t,e){return this._destination&&!e||(this._destination=t,this._panner?(this._output.connect(this._panner.input),this._panner.output.connect(t)):this._output.connect(t)),this},e.prototype.disconnect=function(){return this._output.disconnect(),this._destination=null,this._panner&&this._panner.output.disconnect(),this},e.prototype.play=function(e,i,n,s){var o=t.context.currentTime;if(clearTimeout(this._stopTimeout),t.log("StreamingAudioSource.play. Playing: "+this._playing),this._playing&&this.stop(e),e=e||0,i=i||0,s=!0,this.removeUnusedSources(),n||(n=this._loop?9999999999:this._duration),this._audioElement||this.init(),0!==e&&e+.01<=o)return t.warn("StreamingAudioSource: Returned, playTime < currentTime",this._name),this;if(0==e&&(e=o),this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this._volume,e),this.paused||(this._pauseStartTime=e),s||(this._pauseTime=0),this._startTime=e,this._loopStartTime=e+this.duration,this._paused=!1,this._stopping&&!this._retrig)return this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this.output.gain.value,e),this.output.gain.linearRampToValueAtTime(this._volume,e+.25),clearTimeout(this._stoppingId),void(this._stopping=!1);if(this._fading=!1,this._retrig||this.loop){if(this.loop&&this._retrig&&this.playing&&!this._stopping)return;if(this._stopping)this._stopping=!1;else if(Math.round(1e3*this._endTime)/1e3==Math.round(1e3*(e+this._duration))/1e3)return t.warn("StreamingAudioSource: Returned, Doubletrig",this._name),this}else if(e<this._endTime)return;return this._endTime=this.loop?-1:e+this._duration,this._loop&&(this._audioElement.loop=!0,this._audioElement.loopStart=this._loopStart?this._loopStart:0,this._audioElement.loopEnd=this._loopEnd?this._loopEnd:this._duration),this._destination||t.warn("StreamingAudioSource: no destination node"),"object"!=typeof this._destination&&t.warn("StreamingAudioSource: destination is not an object",this._name),i>this._duration&&(i%=this._duration),this._startOffset=this._offset+i,this._playing=!0,t.log("AudioElement.play"),this._playTimeout=setTimeout(function(){this._audioElement.play()}.bind(this),1e3*Math.max(0,e-t.Util.now())),this},e.prototype.getNumberOfSamples=function(){return this._duration*t.context.sampleRate},e.prototype.stop=function(e){void 0===e&&(e=0),clearTimeout(this._playTimeout),clearTimeout(this._durationTimeout),this._stopping&&(this._stopping=!1,clearTimeout(this._stoppingId));var i=e-t.context.currentTime;return i>0?(this._stopTimeout=setTimeout(function(){this._audioElement.pause(),this._audioElement.currentTime=0,this._stopping=!1}.bind(this),1e3*i),this._stopping=!0,this._endTime=e):(this._audioElement.pause(),this._audioElement.currentTime=0,this._endTime=t.Util.now()),this._playing=!1,this},e.prototype.deschedule=function(){return this._audioElement.pause(),this},e.prototype.pause=function(){if(this._endTime>t.Util.now()){this._paused=!0;var e=t.Util.now()-this._startTime;this._pauseTime+=e,this.stop()}return this},e.prototype.unpause=function(){if(this.paused){var t=this._offset;this._offset+=this._pauseTime,this.play(0,0,null,!0),this._offset=t,this._paused=!1}return this},e.prototype.createMediaElementSource=function(){if(this._connected)var e=this._source;else{var e=t.context.createMediaElementSource(this._audioElement);this._source=e}return e},e.prototype.initIOS=function(){this._audioElement||this.init(),this._audioElement.play(),this._audioElement.pause()},e.prototype.fadeInAndPlay=function(e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=this._duration);var o=t.context.currentTime;if(i||(i=o),(!this.loop||this._retrig||!(this._endTime==-1||i<this._endTime)||this._stopping)&&(!(this.loop&&this._retrig&&this.playing)||this._stopping))return this.output.gain.cancelScheduledValues(i),this._stopping&&!this._retrig?(clearTimeout(this._stoppingId),this.output.gain.setValueAtTime(this.output.gain.value,i)):(this._fading=!0,this.play(i==o?0:i,n,s),this.output.gain.setValueAtTime(0,i)),this._stopping=!1,this.output.gain.linearRampToValueAtTime(this._volume,i+e),this},e.prototype.fadeOutAndStop=function(e,i){if(this.playing){void 0===i&&(i=t.context.currentTime),this._stopping&&clearTimeout(this._stoppingId),this.output.gain.cancelScheduledValues(i),this.output.gain.setValueAtTime(this.output.gain.value||this._volume,i),this.output.gain.linearRampToValueAtTime(0,i+e);var n=this;return this._stoppingId=setTimeout(function(){n._stopping&&(n._stopping=!1,n.loop&&(n._loopPlaying=!1),n.stop(i+e))},1e3*(e+(i-t.Util.now())-n._scheduleAhead)),this._stopping=!0,this}},e.prototype.removeUnusedSources=function(){},e.prototype.curvePlaybackRate=function(e,i,n){if(!this._lockPlaybackrate){var s=n?n:t.Util.now(),o=this.playbackRateNode;return o&&(o.cancelScheduledValues(s),o.setValueAtTime(0==o.value?t.Util.EXP_MIN_VALUE:o.value,s),o.exponentialRampToValueAtTime(e,s+i)),this._playbackRate=e,this}},Object.defineProperty(e.prototype,"lastSource",{get:function(){return this._audioElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(t){"string"==typeof t&&t.indexOf("%")!==-1&&(t=this._duration*parseFloat(t)),this._offset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){if(!this.playing||!this._duration)return 0;var e=this._duration;(this._loopStart||this._loopEnd)&&(e=(this._loopEnd||e)-(this._loopStart||0));var i=t.Util.now()-this._startTime,n=t.Util.now()+this._startOffset-this._loopStartTime;return this._startOffset+i>this._duration?this._loopStart+n%e:this._startOffset+i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){
return this._playbackRate},set:function(e){if(!this._lockPlaybackrate){var i=this.playbackRateNode;i&&i.cancelScheduledValues(t.Util.now()),this._playbackRate=e;for(var n=0,s=this._sources.length;n<s;n++)this._sources[n].playbackRate.value=this._playbackRate}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextPlaybackRate",{set:function(t){this._lockPlaybackrate||(this._playbackRate=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRateNode",{get:function(){var t=this.lastSource;return t&&t.playbackRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return null},set:function(t){console.error("can't set buffer on a streaming source")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._endTime==-1||this._endTime>t.Util.now()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackState",{get:function(){var t=this.lastSource;return t?t.playbackState:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._panner?this._panner.output:this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panner",{get:function(){return this._panner},enumerable:!0,configurable:!0}),e.prototype.freeBuffer=function(){},e.prototype.setData=function(e){t.Model.Audio.prototype.setData.call(this,e);var i=!1;this._volumeStartRange=e.volume_start_range,this._volumeEndRange=e.volume_end_range,void 0!==e.file_id&&this._fileId!=e.file_id&&(this._fileId=e.file_id,i=!0),this._playbackRate=void 0===e.playback_rate?1:e.playback_rate,this.playbackRateNode&&(this.playbackRateNode.value=this._playbackRate),this._loop=void 0!==e.loop&&e.loop,this.lastSource&&(this.lastSource.loop=this._loop),this._loop||(this._loopPlaying=!1),this._loopStart=void 0===e.loop_start?0:e.loop_start,this.lastSource&&(this.lastSource.loopStart=this._loopStart),this._loopEnd=void 0===e.loop_end?0:e.loop_end,this.lastSource&&(this.lastSource.loopEnd=this._loopEnd);var n=void 0===e.offset?0:e.offset;this._offset!=n&&(this._offset=n,i=!0);var s=void 0===e.duration?0:e.duration;if(this._duration!=s&&(this._duration=s,i=!0),this._retrig=void 0===e.retrig||e.retrig,void 0===e.reverse&&(e.reverse=!1),this._reverse!=e.reverse&&(this._reverse=e.reverse,i=!0),this.data.xfade!=e.xfade&&(i=!0),this.data=e,i&&this.init(),e.panner)if(this._panner)this._panner.setData(e.panner);else{var o=this._destination;this.disconnect(),this._panner=newPanner(e.panner),this.connect(o)}else if(!e.panner&&this._panner){var o=this._destination;this.disconnect(),this._panner=null,this.connect(o)}},e}();return t.Model.StreamingAudioSource=e}),e(function(t){return window.Klang=t,window.Klang}),window.Klang=i,"function"==typeof define&&define.amd?define("Klang",function(){return window.Klang}):"object"==typeof module&&(module.exports=window.Klang)}();